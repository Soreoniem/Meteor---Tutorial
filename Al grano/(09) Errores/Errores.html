<!DOCTYPE html>
<!-- saved from url=(0045)http://es.discovermeteor.com/chapters/errors/ -->
<html class="no-js wf-klavikaweb-n3-active wf-klavikaweb-n6-active wf-sourcesanspro-n4-active wf-sourcesanspro-n7-active wf-sourcesanspro-i7-active wf-sourcesanspro-i4-active wf-sourcesanspro-n3-active wf-sourcesanspro-i3-active wf-sourcecodepro-n7-active wf-sourcecodepro-n4-active wf-active" lang="es"><!-- <![endif] --><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    
    <!-- Set the viewport width to device width for mobile -->
    <meta content="width=device-width, initial-scale=1.0" name="viewport">
    <title>Errores - Descubriendo Meteor</title>
    <!-- Included CSS Files -->
    <link href="./Errores_files/screen.css" rel="stylesheet">
    <link href="./Errores_files/print.css" media="print" rel="stylesheet">
    <!-- %link{:href => "http://fonts.googleapis.com/css?family=Source+Sans+Pro:200,400,700,400italic", :rel => "stylesheet"} -->
    <!-- %link{:href => "http://fonts.googleapis.com/css?family=Source+Code+Pro:400,700", :rel => "stylesheet"} -->
    <link href="http://es.discovermeteor.com/images/favicon.ico" rel="shortcut icon">
    <script async="" src="./Errores_files/analytics.js.descarga"></script><script src="./Errores_files/jquery.min.js.descarga"></script><style type="text/css">
:root .adsbox
{ display: none !important; }</style>
    <script src="./Errores_files/rcr2ohz.js.descarga"></script>
    <style type="text/css">.tk-klavika-web{font-family:"klavika-web",sans-serif;}.tk-source-sans-pro{font-family:"source-sans-pro",sans-serif;}.tk-source-code-pro{font-family:"source-code-pro",sans-serif;}</style><style type="text/css">@font-face{font-family:klavika-web;src:url(https://use.typekit.net/af/5401fe/00000000000000003b9acdf2/27/l?subset_id=2&fvd=n3&v=3) format("woff2"),url(https://use.typekit.net/af/5401fe/00000000000000003b9acdf2/27/d?subset_id=2&fvd=n3&v=3) format("woff"),url(https://use.typekit.net/af/5401fe/00000000000000003b9acdf2/27/a?subset_id=2&fvd=n3&v=3) format("opentype");font-weight:300;font-style:normal;}@font-face{font-family:klavika-web;src:url(https://use.typekit.net/af/835e90/00000000000000003b9acdf6/27/l?subset_id=2&fvd=n6&v=3) format("woff2"),url(https://use.typekit.net/af/835e90/00000000000000003b9acdf6/27/d?subset_id=2&fvd=n6&v=3) format("woff"),url(https://use.typekit.net/af/835e90/00000000000000003b9acdf6/27/a?subset_id=2&fvd=n6&v=3) format("opentype");font-weight:600;font-style:normal;}@font-face{font-family:source-sans-pro;src:url(https://use.typekit.net/af/b0088d/00000000000000003b9acb59/27/l?subset_id=2&fvd=n4&v=3) format("woff2"),url(https://use.typekit.net/af/b0088d/00000000000000003b9acb59/27/d?subset_id=2&fvd=n4&v=3) format("woff"),url(https://use.typekit.net/af/b0088d/00000000000000003b9acb59/27/a?subset_id=2&fvd=n4&v=3) format("opentype");font-weight:400;font-style:normal;}@font-face{font-family:source-sans-pro;src:url(https://use.typekit.net/af/c55ca5/00000000000000003b9acb5c/27/l?subset_id=2&fvd=n7&v=3) format("woff2"),url(https://use.typekit.net/af/c55ca5/00000000000000003b9acb5c/27/d?subset_id=2&fvd=n7&v=3) format("woff"),url(https://use.typekit.net/af/c55ca5/00000000000000003b9acb5c/27/a?subset_id=2&fvd=n7&v=3) format("opentype");font-weight:700;font-style:normal;}@font-face{font-family:source-sans-pro;src:url(https://use.typekit.net/af/7e0c18/00000000000000003b9acb5d/27/l?subset_id=2&fvd=i7&v=3) format("woff2"),url(https://use.typekit.net/af/7e0c18/00000000000000003b9acb5d/27/d?subset_id=2&fvd=i7&v=3) format("woff"),url(https://use.typekit.net/af/7e0c18/00000000000000003b9acb5d/27/a?subset_id=2&fvd=i7&v=3) format("opentype");font-weight:700;font-style:italic;}@font-face{font-family:source-sans-pro;src:url(https://use.typekit.net/af/c42064/00000000000000003b9acb58/27/l?subset_id=2&fvd=i4&v=3) format("woff2"),url(https://use.typekit.net/af/c42064/00000000000000003b9acb58/27/d?subset_id=2&fvd=i4&v=3) format("woff"),url(https://use.typekit.net/af/c42064/00000000000000003b9acb58/27/a?subset_id=2&fvd=i4&v=3) format("opentype");font-weight:400;font-style:italic;}@font-face{font-family:source-sans-pro;src:url(https://use.typekit.net/af/b35fa2/00000000000000003b9acb56/27/l?subset_id=2&fvd=n3&v=3) format("woff2"),url(https://use.typekit.net/af/b35fa2/00000000000000003b9acb56/27/d?subset_id=2&fvd=n3&v=3) format("woff"),url(https://use.typekit.net/af/b35fa2/00000000000000003b9acb56/27/a?subset_id=2&fvd=n3&v=3) format("opentype");font-weight:300;font-style:normal;}@font-face{font-family:source-sans-pro;src:url(https://use.typekit.net/af/a6c785/00000000000000003b9acb57/27/l?subset_id=2&fvd=i3&v=3) format("woff2"),url(https://use.typekit.net/af/a6c785/00000000000000003b9acb57/27/d?subset_id=2&fvd=i3&v=3) format("woff"),url(https://use.typekit.net/af/a6c785/00000000000000003b9acb57/27/a?subset_id=2&fvd=i3&v=3) format("opentype");font-weight:300;font-style:italic;}@font-face{font-family:source-code-pro;src:url(https://use.typekit.net/af/b8b49b/0000000000000000000179d5/27/l?subset_id=2&fvd=n7&v=3) format("woff2"),url(https://use.typekit.net/af/b8b49b/0000000000000000000179d5/27/d?subset_id=2&fvd=n7&v=3) format("woff"),url(https://use.typekit.net/af/b8b49b/0000000000000000000179d5/27/a?subset_id=2&fvd=n7&v=3) format("opentype");font-weight:700;font-style:normal;}@font-face{font-family:source-code-pro;src:url(https://use.typekit.net/af/953e9e/0000000000000000000179cf/27/l?subset_id=2&fvd=n4&v=3) format("woff2"),url(https://use.typekit.net/af/953e9e/0000000000000000000179cf/27/d?subset_id=2&fvd=n4&v=3) format("woff"),url(https://use.typekit.net/af/953e9e/0000000000000000000179cf/27/a?subset_id=2&fvd=n4&v=3) format("opentype");font-weight:400;font-style:normal;}</style><script>
      try{Typekit.load();}catch(e){}
    </script>
  <script type="text/javascript" async="" src="./Errores_files/embed.js.descarga"></script><script async="" type="text/javascript" src="./Errores_files/count.js.descarga"></script><style type="text/css">
:root *[fjm3y6y][hidden] { display: none !important; }</style><script src="./Errores_files/count-data.js.descarga"></script><link rel="preload" as="style" href="https://c.disquscdn.com/next/embed/styles/lounge.2d848eddee1b8c12749b72a04b2b33dc.css"><link rel="preload" as="script" href="https://c.disquscdn.com/next/embed/common.bundle.845ead53749f15d0bd8a5ee344c8f06e.js"><link rel="preload" as="script" href="https://c.disquscdn.com/next/embed/lounge.bundle.8241ae5fc761eb94635acdc63f5fd29f.js"><link rel="preload" as="script" href="https://disqus.com/next/config.js"><script src="./Errores_files/alfie.f51946af45e0b561c60f768335c9eb79.js.descarga" async="" charset="UTF-8"></script></head>
  <body style="zoom: 1;" cz-shortcut-listen="true">
    <header>
      <h1>
        <a href="http://es.discovermeteor.com/">
          <span>Descubriendo</span>
          <strong>Meteor</strong>
        </a>
      </h1>
    </header>
    <div class="main">
      <div class="row">
        <div class="toc sidebar">
          <a class="sidebar-toggle" href="javascript:void(0)">Toggle Table of Contents</a>
          <div class="sidebar-inner">
            <ul>
              <li>
                <span class="number">
                  1
                </span>
                <a href="http://es.discovermeteor.com/chapters/introduction/">
                  Introducción
                </a>
              </li>
              <li>
                <span class="number">
                  2
                </span>
                <a href="http://es.discovermeteor.com/chapters/getting-started/">
                  Empezando
                </a>
              </li>
              <li class="sidebar-chapter">
                <span class="number">
                  2.5
                </span>
                <a href="http://es.discovermeteor.com/chapters/deploying/">
                  Despliegue
                </a>
              </li>
              <li>
                <span class="number">
                  3
                </span>
                <a href="http://es.discovermeteor.com/chapters/templates/">
                  Plantillas
                </a>
              </li>
              <li class="sidebar-chapter">
                <span class="number">
                  3.5
                </span>
                <a href="http://es.discovermeteor.com/chapters/github/">
                  Usando Git y GitHub
                </a>
              </li>
              <li>
                <span class="number">
                  4
                </span>
                <a href="http://es.discovermeteor.com/chapters/collections/">
                  Colecciones
                </a>
              </li>
              <li class="sidebar-chapter">
                <span class="number">
                  4.5
                </span>
                <a href="http://es.discovermeteor.com/chapters/publications-and-subscriptions/">
                  Publicaciones y suscripciones
                </a>
              </li>
              <li>
                <span class="number">
                  5
                </span>
                <a href="http://es.discovermeteor.com/chapters/routing/">
                  Enrutando
                </a>
              </li>
              <li class="sidebar-chapter">
                <span class="number">
                  5.5
                </span>
                <a href="http://es.discovermeteor.com/chapters/the-session/">
                  La sesión
                </a>
              </li>
              <li>
                <span class="number">
                  6
                </span>
                <a href="http://es.discovermeteor.com/chapters/adding-users/">
                  Añadiendo usuarios
                </a>
              </li>
              <li class="sidebar-chapter">
                <span class="number">
                  6.5
                </span>
                <a href="http://es.discovermeteor.com/chapters/reactivity/">
                  Reactividad
                </a>
              </li>
              <li>
                <span class="number">
                  7
                </span>
                <a href="http://es.discovermeteor.com/chapters/creating-posts/">
                  Creando posts
                </a>
              </li>
              <li class="sidebar-chapter">
                <span class="number">
                  7.5
                </span>
                <a href="http://es.discovermeteor.com/chapters/latency-compensation/">
                  Compensación de la latencia
                </a>
              </li>
              <li>
                <span class="number">
                  8
                </span>
                <a href="http://es.discovermeteor.com/chapters/editing-posts/">
                  Editando posts
                </a>
              </li>
              <li class="sidebar-chapter">
                <span class="number">
                  8.5
                </span>
                <a href="http://es.discovermeteor.com/chapters/allow-and-deny/">
                  Permitir y Denegar
                </a>
              </li>
              <li class="active">
                <span class="number">
                  9
                </span>
                <a href="http://es.discovermeteor.com/chapters/errors/">
                  Errores
                </a>
              </li>
              <li class="sidebar-chapter">
                <span class="number">
                  9.5
                </span>
                <a href="http://es.discovermeteor.com/chapters/creating-a-meteor-package/">
                  Creando un paquete Meteor
                </a>
              </li>
              <li>
                <span class="number">
                  10
                </span>
                <a href="http://es.discovermeteor.com/chapters/comments/">
                  Comentarios
                </a>
              </li>
              <li class="sidebar-chapter">
                <span class="number">
                  10.5
                </span>
                <a href="http://es.discovermeteor.com/chapters/denormalization/">
                  Denormalización
                </a>
              </li>
              <li>
                <span class="number">
                  11
                </span>
                <a href="http://es.discovermeteor.com/chapters/notifications/">
                  Notificaciones
                </a>
              </li>
              <li class="sidebar-chapter">
                <span class="number">
                  11.5
                </span>
                <a href="http://es.discovermeteor.com/chapters/advanced-reactivity/">
                  Reactividad avanzada
                </a>
              </li>
              <li>
                <span class="number">
                  12
                </span>
                <a href="http://es.discovermeteor.com/chapters/pagination/">
                  Paginación
                </a>
              </li>
              <li>
                <span class="number">
                  13
                </span>
                <a href="http://es.discovermeteor.com/chapters/voting/">
                  Votos
                </a>
              </li>
              <li class="sidebar-chapter">
                <span class="number">
                  13.5
                </span>
                <a href="http://es.discovermeteor.com/chapters/advanced-publications/">
                  Publicaciones avanzadas
                </a>
              </li>
              <li>
                <span class="number">
                  14
                </span>
                <a href="http://es.discovermeteor.com/chapters/animations/">
                  Animaciones
                </a>
              </li>
              <li>
                <span class="number">
                  14.5
                </span>
                <a href="http://es.discovermeteor.com/chapters/going-further/">
                  Ir más lejos
                </a>
              </li>
              <li>
                <span class="number">
                  14.5
                </span>
                <a href="http://es.discovermeteor.com/chapters/meteor-vocabulary/">
                  Vocabulario
                </a>
              </li>
              <li>
                <span class="number">
                  99
                </span>
                <a href="http://es.discovermeteor.com/chapters/changelog/">
                  Changelog
                </a>
              </li>
            </ul>
          </div>
        </div>
        <div class="vocabulary sidebar">
          <a class="sidebar-toggle" href="http://es.discovermeteor.com/chapters/errors/#">Toggle Vocabulary</a>
          <div class="sidebar-inner">
            <div class="sidebar-content">
              <h3>Vocabulary</h3>
              <h4>Cliente</h4>
              
              <p style="display: none;">Cuando hablamos del Cliente, nos referimos al código que se ejecuta en el navegador de los usuarios, ya sea uno tradicional, como Firefox o Safari, o algo tan complejo como un UIWebView en una aplicación nativa para el iPhone.</p>
              
              <h4>Colección</h4>
              
              <p style="display: none;">Una colección es el almacén de datos que se sincroniza automáticamente entre el cliente y el servidor. Las colecciones tienen un nombre (como <code>posts</code>), y por lo general existen tanto en el cliente como en el servidor. Si bien se comportan de forma distinta, tienen una API común basada en la API de Mongo.</p>
              
              <h4>Computación</h4>
              
              <p style="display: none;">Una computación es un bloque de código que se ejecuta cada vez que cambia una de las fuentes de datos reactivos de las que depende. Si tienes una fuente reactiva (por ejemplo, una variable de sesión) y quieres responder reactivamente a ella, tendrás que crear una computación.</p>
              
              <h4>Cursor</h4>
              
              <p style="display: none;">Un cursor es el resultado de ejecutar una consulta en una colección Mongo. En el lado del cliente, un cursor no es tan sólo un conjunto de resultados, sino que es un objeto <em>reactivo</em> desde el que se puede observar (con <code>observe()</code>) los cambios (añadir, eliminar o actualizar) en la colección correspondiente.</p>
              
              <h4>DDP</h4>
              
              <p style="display: none;">El DDP es el Protocolo de Datos Distribuidos que utiliza Meteor para sincronizar colecciones y efectuar llamadas a métodos. DDP pretende ser un protocolo genérico, que toma el relevo a HTTP para aplicaciones en tiempo real con gran carga de datos.</p>
              
              <h4>Deps</h4>
              
              <p style="display: none;">Deps es el sistema reactivo de Meteor. Deps se utiliza entre bastidores para sincronizar automáticamente el  HTML con el modelo de datos subyacente.</p>
              
              <h4>Documento</h4>
              
              <p style="display: none;">Mongo es un almacén de datos basado en documentos y a los objetos que salen de las colecciones se les llama “documentos”. Son objetos JavaScript sin formato (aunque no pueden contener funciones) con una única propiedad especial, el ’_id’, que Meteor utiliza para realizar un seguimiento de sus propiedades en el DDP.</p>
              
              <h4>Ayudantes</h4>
              
              <p style="display: none;">Cuando una plantilla necesita mostrar cosas más complejas que una simple propiedad de un documento, ésta puede hacer uso de su ayudante, una función que se utiliza para procesar los datos que se muestran en ella.</p>
              
              <h4>Compensación de la latencia</h4>
              
              <p style="display: none;">Es una técnica que permite simular llamadas a métodos en el cliente para evitar retrasos mientras se espera la respuesta del servidor.</p>
              
              <h4>Meteor Development Group (MDG)</h4>
              
              <p style="display: none;">La empresa que desarrolla Meteor.</p>
              
              <h4>Método</h4>
              
              <p style="display: none;">Un método en Meteor es una llamada desde el cliente, a un procedimiento remoto en el servidor, con un poco de lógica añadida que permite realizar un seguimiento de los cambios en los datos además de compensar la latencia de la llamada.</p>
              
              <h4>MiniMongo</h4>
              
              <p style="display: none;">La colección del lado del cliente es un almacén de datos en memoria que ofrece una API tipo Mongo. La librería que se utiliza se llama “MiniMongo”, para indicar que es una versión más pequeña de Mongo que se ejecuta por completo en la memoria del navegador.</p>
              
              <h4>Paquete</h4>
              
              <p style="display: none;">Un paquete Meteor puede ser: código JavaScript que se ejecuta en el servidor, código JavaScript que se ejecuta en el cliente, instrucciones para procesar recursos (como SASS a CSS), o recursos que deben ser  procesados​​. <br> Un paquete es como una librería con superpoderes. Meteor incluye una gran cantidad de paquetes (<code>meteor list</code>). También existe <a href="http://atmosphere.meteor.com/">Atmosphere</a>, que es una colección de paquetes de terceros mantenida por la comunidad (<code>mrt add ...</code>).</p>
              
              <h4>Publicación</h4>
              
              <p style="display: none;">Una publicación es un conjunto de datos con nombre que se personaliza para cada usuario que se suscribe a ella. Se configuran en el servidor.</p>
              
              <h4>Servidor</h4>
              
              <p style="display: none;">El servidor Meteor es un servidor HTTP y DDP ejecutados vía Node.js. Se compone de todas las librerías y del código JavaScript del lado del servidor. Cuando se inicia el servidor, se conecta a una base de datos Mongo (que configura por si mismo en el primer arranque).</p>
              
              <h4>Sesión</h4>
              
              <p style="display: none;">La sesión en Meteor es una fuente de datos reactiva que usa tu aplicación para hacer un seguimiento del estado del usuario.</p>
              
              <h4>Suscripción</h4>
              
              <p style="display: none;">Una suscripción es una conexión a una publicación desde un cliente específico. La suscripción es el código que ejecuta el navegador y que utiliza para comunicarse con una publicación del servidor y que, además, mantiene los datos sincronizados.</p>
              
              <h4>Plantilla</h4>
              
              <p style="display: none;">Una plantilla es una forma de generar código HTML desde JavaScript. Por defecto, Meteor sólo soporta el sistema Spacebars, pero hay planes para incluir más.</p>
              
              <h4>Contexto de datos de una plantilla</h4>
              
              <p style="display: none;">Cuando se muestra un plantilla, lo que se representa es un objeto JavaScript que proporciona datos específicos para esta representación en particular. Por lo general, este tipo de objetos son, de tipo POJO (plain-old-JavaScript-objects), a menudo son documentos de una colección, aunque pueden ser más complejos e incluir funciones.</p>
            </div>
          </div>
        </div>
        <div class="post">
          <div class="top-nav">
            <div class="post-nav">
              <a class="prev" href="http://es.discovermeteor.com/chapters/allow-and-deny/" title="Previous Post: Permitir y Denegar">
                «
                Permitir y Denegar
              </a>
              <a class="next" href="http://es.discovermeteor.com/chapters/creating-a-meteor-package/" title="next Post: Creando un paquete Meteor">
                Creando un paquete Meteor
                »
              </a>
            </div>
          </div>
          <div class="post-content">
            <div class="chapter-heading">
              <h2 class="chapter-title">Errores</h2>
              <span class="chapter-number">9</span>
            </div>
            <input id="paragraphs" type="hidden" value="31">
            <div class="chapter-summary note chapter">
			<style>
				*{transition:ease all 0.1s;}
				.arriba{position:fixed;bottom:0px;left:0px;margin:2px;padding:2px 7px;background-color:rgba(64, 64, 64, 0.2);border-radius:50%;box-shadow:0px 0px 5px rgba(0, 0, 0, 0.4);}
			</style>
			  <a href="#men" class="arriba">▲</a>
			  <h3 id="men">En este capítulo:</h3>
              <ul>
				  <li><a href="#men-ilcl">Introduciendo las colecciones locales.</a></li>
				  <li><a href="#men-me">Mostrando errores.</a></li>
				  <li><a href="#men-ce">Creando errores.</a></li>
				  <li><a href="#men-ebdlv">En busca de las validaciones.</a></li>
				  <li><a href="#men-veelds">Validaciones en el lado del servidor.</a></li>
				  <li><a href="#men-vae">Validación al editar.</a></li>
			  </ul>
            </div>
			
			<p>Vamos a mejorar el <code>alert()</code> que es bastante simple.</p>
			
			<p>Mostraremos mensajes de error al usuario sin tener que romper su flujo de trabajo.</p>
			
			<p>Vamos a implementar algo similar a la popular aplicación <a href="http://www.growl.info/" target="_blank">Growl</a> de MacOS.</p>
			
            <h3 id="men-ilcl">Introduciendo las colecciones locales</h3>
            
			<p>Crearemos la <b>colección local</b> <code>Errores</code> que solo existirá <b>en el navegador</b> y no se sincronizará con el servidor.</p>
			
			<p>Creamos la colección dentro del directorio <code>/client</code> y estableceremos el nombre de la colección a <code class="kd">null</code> para que no se almacene en el servidor:</p>
			
			<pre><span class="line c1">// Colección local (Solo para el cliente)</span><span class="line">Errores = <span class="kd">new</span> Mongo.Collection(<span class="kd">null</span>);</span></pre>
			<div class="caption">/client/colecciones/errores.js</div>
			
			<p>Añadimos la funcion <code>mostrarError</code>. Como es una colección local no serán necesarios los bloques <code>allow</code>, <code>deny</code> u otros mecanismos de seguridad por que es para el usuario actual.</p>
			
			<pre><span class="line c1">// Colección local (Solo para el cliente)</span><span class="line">Errores = <span class="kd">new</span> Mongo.Collection(<span class="kd">null</span>);</span>
<span class="line added"><span class="kd">var</span> numErrores = <span class="nb">1</span>;</span><span class="line added">mostrarError = <span class="kd">function</span>(<span class="ss">mensaje</span>){</span><span class="line added">  Errores.insert({</span><span class="line added">    <span class="na">numero</span> : numErrores++,</span><span class="line added">    <span class="na">mensaje</span>: <span class="ss">mensaje</span></span><span class="line added">  });</span><span class="line added">}</span></pre>
			<div class="caption">/client/colecciones/errores.js</div>
			
			<p>Recuerda que sigue siendo una colección aun no estando en el servidor por lo que seguirá siendo reactiva como cualquier otra colección.</p>
			
			<h3 id="men-me">Mostrando Errores</h3>
			
			<p>Mostraremos los errores en la parte de arriba de nuestro diseño:</p>
			
			<pre><span class="line"><span class="nt">&lt;template</span> <span class="na">name</span>=<span class="s1">"diseño"</span><span class="nt">&gt;</span></span><span class="line">  <span class="nt">&lt;div</span> <span class="na">class</span>=<span class="s1">"container"</span><span class="nt">&gt;</span></span><span class="line">    {{&gt; cabecera}}</span><span class="line added">    {{&gt; errores}}</span><span class="line">    <span class="nt">&lt;div</span> <span class="na">id</span>=<span class="s1">"main"</span><span class="nt">&gt;</span></span><span class="line">      {{&gt; yield}}</span><span class="line nt">    &lt;/div&gt;</span><span class="line nt">  &lt;/div&gt;</span><span class="line nt">&lt;/template&gt;</span></pre>
            <div class="caption">/client/plantillas/aplicacion/diseño.html</div>
			
			<p>Ahora vamos a crear la plantilla de error en <code>errores.html</code>:</p>
			
			<pre><span class="line c1">&lt;!--[ Lista de errores ]--&gt;</span><span class="line"><span class="nt">&lt;template</span> <span class="na">name</span>=<span class="s1">"errores"</span><span class="nt">&gt;</span></span><span class="line">  <span class="nt">&lt;div</span> <span class="na">class</span>=<span class="s1">"errores"</span><span class="nt">&gt;</span></span><span class="line">    {{#each errores}}</span><span class="line">      {{&gt; error}}</span><span class="line">    {{/each}}</span><span class="line nt">  &lt;/div&gt;</span><span class="line nt">&lt;/template&gt;</span>
<span class="line c1">&lt;!--[ 1 Error ]--&gt;</span><span class="line"><span class="nt">&lt;template</span> <span class="na">name</span>=<span class="s1">"error"</span><span class="nt">&gt;</span></span><span class="line">  <span class="nt">&lt;div</span> <span class="na">class</span>=<span class="s1">"alert alert-danger"</span> <span class="na">role</span>=<span class="s1">"alert"</span><span class="nt">&gt;</span></span><span class="line">    <span class="nt">&lt;button</span> <span class="na">type</span>=<span class="s1">"button"</span> <span class="na">class</span>=<span class="s1">"close"</span> <span class="na">data-dismiss</span>=<span class="s1">"alert"</span><span class="nt">&gt;</span><span>&</span>times<span>;</span><span class="nt">&lt;/button&gt;</span></span><span class="line">    [{{numero}}] {{mensaje}}</span><span class="line nt">  &lt;/div&gt;</span><span class="line nt">&lt;/template&gt;</span></pre>
			<div class="caption">/client/plantillas/errores/errores.html</div>
			
			<p>Solo nos falta integrar el ayudante de plantilla y ¡Estará listo!</p>
			
			<pre><span class="line">Template.errores.helpers({</span><span class="line">  <span class="s1">"errores"</span>: <span class="kd">function</span>(){</span><span class="line">    <span class="kd">return</span> Errores.find({}, {<span class="na">sort</span>: {<span class="na">numero</span>: <span class="nb">-1</span>}});</span><span class="line">  }</span><span class="line">});</span>
<span class="line">Template.error.onRendered(<span class="kd">function</span>(){</span><span class="line">  <span class="kd">var</span> idError = <span class="kd">this</span>.data._id;</span>
<span class="line">  <span class="kd">this</span>.$(<span class="s1">"[role=alert]"</span>)</span><span class="line">    .hide().slideDown(<span class="nb">800</span>)</span><span class="line">    .delay(<span class="nb">3000</span>).slideUp(<span class="nb">500</span>, <span class="kd">function</span>(){</span><span class="line">      Errores.remove({<span class="na">_id</span>: idError});</span><span class="line">  });</span><span class="line">});</span></pre>
			<div class="caption">/client/plantillas/errores/errores.js</div>
			
			<p>Lo primero, el ayudante <code class="s1">"errores"</code> obtiene los errores pero además mostrará los errores en orden desdendiente mediante el <code class="nb">-1</code>. De esta forma los mensajes más recientes aparecerán arriba por que son los últimos en añadirse a la lista.</p>
			
			<p>Después <code>onRendered</code> se ejecutará una vez que el mensaje se haya creado en el html.</p>
			
			<p>Dentro de <code>onRendered</code>:</p>
			<ol><span style="font-size:1.2em;">Dentro de onRendered</span>
				<li>Obtendrá el <code>_id</code> del error.</li>
				<li>Nada más crearse el error se ocultará.</li>
				<li>Aparecerá el error en <span class="nb">800</span> milisegundos (<span class="nb">0.8</span> segundos).</li>
				<li>El error se mostrará en <span class="nb">3 000</span> milisegundos (<span class="nb">3</span> segundos).</li>
				<li>El error desaparecerá visualmente en <span class="nb">500</span> milisegundos (<span class="nb">0.5</span> segundos).</li>
				<li>Y cuando el error haya desaparecido se ejecutará la función que eliminará el error.</li>
			</ol>
			
			<p>Ya puedes probar nuestros mensajes de error manualmente. Abre una consola en el navegador y escribe:</p>
			
			<pre><span class="line"><span class="kd browser-prompt">></span> mostrarError(<span class="s1">"¡Soy un error!"</span>);</span><span class="line"><span class="kd browser-prompt">></span> mostrarError(<span class="s1">"¡Soy un segundo error!"</span>);</span></pre>
			<div class="caption">Consola del navegador</div>
			
			<p>Si lanzas varios errores consecutivos verás que se añaden uno encima del otro:</p>
			
			<figure class="screenshot"><img src="./Errores_files/9-1.png" alt="Mostrando un error."><figcaption>Mostrando un error.</figcaption></figure>
			
            <h3 id="men-ce">Creando errores</h3>
			
			<p>Sustituyamos los alerts de los eventos en <code>publicaciones_nueva.js</code>:</p>
            
			<pre><span class="line">Template.publicacionesNueva.events({</span><span class="line">  <span class="s1">"submit form"</span>: <span class="kd">function</span>(<span class="ss">e</span>){</span><span class="line">    <span class="ss">e</span>.preventDefault();</span>
<span class="line">    <span class="kd">var</span> publicacionForm = {</span><span class="line">      <span class="na">titulo</span> : $(<span class="ss">e</span>.target).find(<span class="s1">"[name=titulo]"</span>).val(),</span><span class="line">      <span class="na">url</span>    : $(<span class="ss">e</span>.target).find(<span class="s1">"[name=url]"</span>).val()</span><span class="line">    }</span>
<span class="line">    Meteor.call(<span class="s1">"publicacionesInsertar"</span>, publicacionForm, <span class="kd">function</span>(<span class="ss">error</span>, <span class="ss">resultado</span>){</span><span class="line c1">      // Mostrar el error al usuario y abortar</span><span class="line">      <span class="kd">if</span>( <span class="ss">error</span> ){</span><span class="line added">        <span class="kd">return</span> mostrarError(<span class="s1">"Error al enviar la publicación: "</span>+ <span class="ss">error</span>.reason);</span>
<span class="line">      } <span class="kd">else if</span>( <span class="ss">resultado</span>.error == <span class="s1">"datosErroneos"</span> ){</span><span class="line added">        <span class="kd">return</span> mostrarError(<span class="s1">"Error: Algún dato del formulario es incorrecto."</span>);</span>
<span class="line">      } <span class="kd">else if</span>( <span class="ss">resultado</span>.error == <span class="s1">"publicacionExistente"</span> ){</span><span class="line added">        mostrarError(<span class="s1">"Error: Ya existe una publicación con esta dirección web."</span>);</span><span class="line">      }</span>
<span class="line">      Router.go(<span class="s1">"publicacionesPagina"</span>, {<span class="na">_id</span>: <span class="ss">resultado</span>._id});</span><span class="line">    });</span><span class="line">  }</span><span class="line">});</span></pre>
			<div class="caption">/client/plantillas/publicaciones/publicaciones_nueva.js</div>
			
			<p>Ya que estamos, hacemos lo mismo con el ayudante de <code>publicaciones_modificar.js</code>:</p>
			
			<pre><span class="line">Template.publicacionesModificar.events({</span><span class="line">  <span class="s1">"submit form"</span>: <span class="kd">function</span>(<span class="ss">e</span>){</span><span class="line">    <span class="ss">e</span>.preventDefault();</span>
<span class="line">    <span class="kd">var</span> publicacionModificada = {</span><span class="line">      <span class="s1">"_id"</span>    : <span class="kd">this</span>._id,</span><span class="line">      <span class="s1">"titulo"</span> : $(<span class="ss">e</span>.target).find(<span class="s1">"[name=titulo]"</span>).val(),</span><span class="line">      <span class="s1">"url"</span>    : $(<span class="ss">e</span>.target).find(<span class="s1">"[name=url]"</span>).val()</span><span class="line">    };</span>
<span class="line">    Meteor.call(<span class="s1">"publicacionesModificar"</span>, publicacionModificada, <span class="kd">function</span>(<span class="ss">error</span>, <span class="ss">resultado</span>){</span><span class="line">      <span class="kd">if</span>( <span class="ss">error</span> ){</span><span class="line added">        mostrarError(<span class="s1">"Error: No se ha podido modificar la publicación: "</span>+ <span class="ss">error</span>.reason);</span>
<span class="line">      } <span class="kd">else if</span>( <span class="ss">resultado</span>.error == <span class="s1">"datosErroneos"</span> ){</span><span class="line added">        <span class="kd">return</span> mostrarError(<span class="s1">"Error: El tipo de datos es incorrecto."</span>);</span>
<span class="line">      } <span class="kd">else if</span>( <span class="ss">resultado</span>.error == <span class="s1">"publicacionExistente"</span> ){</span><span class="line added">        mostrarError(<span class="s1">"Error: Ya existe una publicación con esta dirección web."</span>);</span>
<span class="line">      } <span class="kd">else</span> {</span><span class="line">        Router.go(<span class="s1">"publicacionesPagina"</span>, {<span class="s1">"_id"</span>: <span class="ss">resultado</span>._id});</span><span class="line">      }</span><span class="line">    });</span><span class="line">  },</span>
<span class="line">  <span class="s1">"click .eliminar"</span>: <span class="kd">function</span>(<span class="ss">e</span>){</span><span class="line">    <span class="ss">e</span>.preventDefault();</span>
<span class="line">    <span class="kd">if</span>( confirm(<span class="s1">"¿Eliminar esta publicación?"</span>) ){</span><span class="line">      Meteor.call(<span class="s1">"publicacionesEliminar"</span>, {<span class="na">_id</span>: <span class="kd">this</span>._id}, <span class="kd">function</span>(<span class="ss">error</span>, <span class="ss">resultado</span>){</span><span class="line">        <span class="kd">if</span>( <span class="ss">error</span> ){</span><span class="line added">          mostrarError(<span class="s1">"Error: No se ha podido eliminar la publicación: "</span>+ <span class="ss">error</span>.reason);</span><span class="line">        } <span class="kd">else</span> {</span><span class="line">          Router.go(<span class="s1">"publicacionesLista"</span>);</span><span class="line">        }</span><span class="line">      });</span><span class="line">    }</span><span class="line">  }</span><span class="line">});</span></pre>
			<div class="caption">/client/plantillas/publicaciones/publicaciones_modificar.js</div>
			
			<p>Vamos a probar: Intenta crear o modificar una publicación e introduce la URL <code>http://www.meteor.com</code>. Como esta URL ya existe en una publicación en nuestros datos de ejemplo, deberíamos ver:</p>
			
			<figure class="screenshot"><img src="./Errores_files/9-2.png" alt="Disparando un error."><figcaption>Disparando un error.</figcaption></figure>
			
			<p>Lo mismo deberíamos ver si modificamos una publicación y modificamos título o URL. Pero debería dejarnos modificar la publicación si cambiamos la URL por otra que <span class="kd">no</span> exista.</p>
			
			<h3 id="men-ebdlv">En busca de las validaciones</h3>
            
			<p>Prepararemos al formulario para recibir errores mediante ayudantes que se activarán cuando haya algún error en el formulario.</p>
			
			<pre><span class="line"><span class="nt">&lt;template</span> <span class="na">name</span>=<span class="s1">"publicacionesNueva"</span><span class="nt">&gt;</span></span><span class="line">  <span class="nt">&lt;form</span> <span class="na">class</span>=<span class="s1">"main form pagina"</span><span class="nt">&gt;</span></span><span class="line added">    <span class="nt">&lt;div</span> <span class="na">class</span>=<span class="s1">"form-group {{errorClase 'url'}}"</span><span class="nt">&gt;</span></span><span class="line">      <span class="nt">&lt;label</span> <span class="na">class</span>=<span class="s1">"control-label"</span> <span class="na">for</span>=<span class="s1">"url"</span><span class="nt">&gt;</span>URL<span class="nt">&lt;/label&gt;</span></span><span class="line">      <span class="nt">&lt;div</span> <span class="na">class</span>=<span class="s1">"controls"</span><span class="nt">&gt;</span></span><span class="line">        <span class="nt">&lt;input</span> <span class="na">autofocus</span> <span class="na">name</span>=<span class="s1">"url"</span> <span class="na">id</span>=<span class="s1">"url"</span> <span class="na">type</span>=<span class="s1">"text"</span> <span class="na">value</span>=<span class="s1">""</span> <span class="na">placeholder</span>=<span class="s1">"Dirección web"</span> <span class="na">class</span>=<span class="s1">"form-control"</span><span class="nt">/&gt;</span></span><span class="line added">        <span class="nt">&lt;span</span> <span class="na">class</span>=<span class="s1">"help-block"</span><span class="nt">&gt;</span>{{errorPublicacion "url"}}<span class="nt">&lt;/span&gt;</span></span><span class="line nt">      &lt;/div&gt;</span><span class="line nt">    &lt;/div&gt;</span><span class="line added">    <span class="nt">&lt;div</span> <span class="na">class</span>=<span class="s1">"form-group {{errorClase 'titulo'}}"</span><span class="nt">&gt;</span></span><span class="line">      <span class="nt">&lt;label</span> <span class="na">class</span>=<span class="s1">"control-label"</span> <span class="na">for</span>=<span class="s1">"titulo"</span><span class="nt">&gt;</span>Título<span class="nt">&lt;/label&gt;</span></span><span class="line">      <span class="nt">&lt;div</span> <span class="na">class</span>=<span class="s1">"controls"</span><span class="nt">&gt;</span></span><span class="line">        <span class="nt">&lt;input</span> <span class="na">name</span>=<span class="s1">"titulo"</span> <span class="na">id</span>=<span class="s1">"titulo"</span> <span class="na">type</span>=<span class="s1">"text"</span> <span class="na">value</span>=<span class="s1">""</span> <span class="na">placeholder</span>=<span class="s1">"Título de su publicación"</span> <span class="na">class</span>=<span class="s1">"form-control"</span><span class="nt">/&gt;</span></span><span class="line added">        <span class="nt">&lt;span</span> <span class="na">class</span>=<span class="s1">"help-block"</span><span class="nt">&gt;</span>{{errorPublicacion "titulo"}}<span class="nt">&lt;/span&gt;</span></span><span class="line nt">      &lt;/div&gt;</span><span class="line nt">    &lt;/div&gt;</span><span class="line">    <span class="nt">&lt;input</span> <span class="na">type</span>=<span class="s1">"submit"</span> <span class="na">value</span>=<span class="s1">"Enviar"</span> <span class="na">class</span>=<span class="s1">"btn btn-primary"</span><span class="nt">/&gt;</span></span><span class="line nt">  &lt;/form&gt;</span><span class="line nt">&lt;/template&gt;</span></pre>
			<div class="caption">/client/plantillas/publicaciones/publicaciones_nueva.html</div>
			
			<p>Usaremos una variable de <b>Session</b> (<code>publicacionesNueva_errores</code>) para almacenar un objeto que contendrá los mensajes de error del formulario.</p>
			
			<p>Para usar <b>Session</b> primero debemos añadir el paquete <code>session</code>:</p>
			
			<pre><span class="line"><span class="kd browser-prompt">></span> <span class="kd">meteor</span> add session</span></pre>
			<div class="caption">Terminal</div>
			
			<p>Mientras que <code>errorPublicacion</code> solo devuelve el mensaje en sí mismo, <code>errorClase</code> comprueba la <b>presencia</b> de una publicación.</p>
			
			<pre><span class="line">Template.publicacionesNueva.onCreated(<span class="kd">function</span>(){</span><span class="line">  Session.set(<span class="s1">"publicacionesNueva_errores"</span>, {});</span><span class="line">});</span>
<span class="line">Template.publicacionesNueva.helpers({</span><span class="line">  <span class="s1">"errorPublicacion"</span>: <span class="kd">function</span>(<span class="ss">campo</span>){</span><span class="line">    <span class="kd">return</span> Session.get(<span class="s1">"publicacionesNueva_errores"</span>)[<span class="ss">campo</span>];</span><span class="line">  },</span>
<span class="line">  <span class="s1">"errorClase"</span>: <span class="kd">function</span>(<span class="ss">campo</span>){</span><span class="line c1">    // Si hay error añade la clase "has-error"</span><span class="line">    <span class="kd">return !!</span> Session.get(<span class="s1">"publicacionesNueva_errores"</span>)[<span class="ss">campo</span>] ?<span class="s1">"has-error"</span> :<span class="s1">""</span>;</span><span class="line">  }</span><span class="line">});</span>
<span class="line c1">// •••</span></pre>
			<div class="caption">/client/plantillas/publicaciones/publicaciones_nueva.js</div>
			
			<p>Comprueba que funcionen los ayudantes escribiendo el siguiente código por consola del navegador web:</p>
			
			<p>▼▼▼ Continuar: Se han creado de nuevo las publicaciones. Debes continuar mirando si se ve el autor en las capturas (_usuario.autor) ▼▼▼</p>
			
			<pre><span class="line"><span class="kd browser-prompt">></span> Session.set(<span class="s1">"publicacionesNueva_errores"</span>, {<span class="na">titulo</span>: <span class="s1">"¡Peligro! Intruso detectado. desplegando a los robo-perros."</span>});</span></pre>
			<div class="caption">Consola del navegador</div>
			
			<figure class="screenshot"><img src="./Errores_files/9-3.png" alt="¡Alerta roja! ¡Alerta roja!"><figcaption>¡Alerta roja! ¡Alerta roja!</figcaption></figure>
			
			<p>Antes de enganchar el objeto de sesión <code>publicacionesNueva_errores</code> al formulario crearemos una función para validar las publicaciones.</p>
			
			<pre><span class="line">Publicaciones = <span class="kd">new</span> Mongo.Collection(<span class="s1">"publicaciones"</span>);</span>
<span class="line added">validarPublicaciones = <span class="kd">function</span>(<span class="ss">publicacion</span>){</span><span class="line added">  <span class="kd">var</span> errores = {};</span>
<span class="line added">  <span class="kd">if</span>( <span class="kd">!</span> <span class="ss">publicacion</span>.titulo ){ errores.titulo = <span class="s1">"▲ Por favor, rellene este campo."</span> }</span>
<span class="line added">  <span class="kd">if</span>( <span class="kd">!</span> <span class="ss">publicacion</span>.url )   { errores.url    = <span class="s1">"▲ Por favor, rellene este campo."</span> }</span>
<span class="line added">  <span class="kd">return</span> errores;</span><span class="line added">}</span>
<span class="line">Meteor.methods({</span><span class="line c1">  // •••</span><span class="line">})</span></pre>
			<div class="caption">/lib/colecciones/publicaciones.js</div>
			
			<p>Llamaremos a esta función desde el ayudante de eventos de <code>publicaciones_nueva.js</code>:</p>
			
			<pre><span class="line c1">// •••</span>
<span class="line">Template.publicacionesNueva.events({</span><span class="line">  <span class="s1">"submit form"</span>: <span class="kd">function</span>(<span class="ss">e</span>){</span><span class="line">    <span class="ss">e</span>.preventDefault();</span>
<span class="line">    <span class="kd">var</span> publicacionForm = {</span><span class="line">      <span class="na">titulo</span> : $(<span class="ss">e</span>.target).find(<span class="s1">"[name=titulo]"</span>).val(),</span><span class="line">      <span class="na">url</span>    : $(<span class="ss">e</span>.target).find(<span class="s1">"[name=url]"</span>).val()</span><span class="line">    }</span>
<span class="line c1 added">    // Si existen errores muestra los y detén el código mediante el return</span><span class="line added">    <span class="kd">var</span> errores = validarPublicaciones(publicacionForm);</span><span class="line added">    <span class="kd">if</span>( errores.titulo <span class="kd">||</span> errores.url ){ <span class="kd">return</span> Session.set(<span class="s1">"publicacionesNueva_errores"</span>, errores); }</span>
<span class="line">    Meteor.call(<span class="s1">"publicacionesInsertar"</span>, publicacionForm, <span class="kd">function</span>(<span class="ss">error</span>, <span class="ss">resultado</span>){</span><span class="line c1">      // Mostrar el error al usuario y abortar</span><span class="line">      <span class="kd">if</span>( <span class="ss">error</span> ){</span><span class="line">        <span class="kd">return</span> mostrarError(<span class="s1">"Error al enviar la publicación: "</span>+ <span class="ss">error</span>.reason);</span>
<span class="line">      } <span class="kd">else if</span>( <span class="ss">resultado</span>.error == <span class="s1">"datosErroneos"</span> ){</span><span class="line">        <span class="kd">return</span> mostrarError(<span class="s1">"Error: El tipo de datos es incorrecto."</span>);</span>
<span class="line">      } <span class="kd">else if</span>( <span class="ss">resultado</span>.error == <span class="s1">"publicacionExistente"</span> ){</span><span class="line">        mostrarError(<span class="s1">"Error: Ya existe una publicación con esta dirección web."</span>);</span><span class="line">      }</span>
<span class="line">      Router.go(<span class="s1">"publicacionesPagina"</span>, {<span class="na">_id</span>: <span class="ss">resultado</span>._id});</span><span class="line">    });</span><span class="line">  }</span><span class="line">});</span></pre>
			<div class="caption">/client/plantillas/publicaciones/publicaciones_nueva.js</div>
			
			<p>Fíjate que estamos usando <code class="kd">return</code> para abortar la ejecución del ayudante si hay errores.</p>
			
			<figure class="screenshot"><img src="./Errores_files/9-4.png" alt="Enviando una publicación sin los campos rellenados."><figcaption>Enviando una publicación sin los campos rellenados.</figcaption></figure>
			
			<h3 id="men-veelds">Validaciones en el lado del servidor</h3>
			
			<p>Como hemos puesto la función <code>validarPublicaciones</code> en el directorio <code>/lib</code> podremos validar campos vacíos en el servidor:</p>
			
			<pre><span class="line">Meteor.methods({</span><span class="line">  <span class="s1">"publicacionesInsertar"</span>: <span class="kd">function</span>(<span class="ss">nuevaPublicacion</span>){</span><span class="line c1">    // Comprobar los datos.</span><span class="line">    <span class="kd">if</span>(  <span class="kd">typeof</span> <span class="ss">nuevaPublicacion</span>.url    <span class="kd">!=</span> <span class="s1">"string"</span></span><span class="line">      <span class="kd">|| typeof</span> <span class="ss">nuevaPublicacion</span>.titulo <span class="kd">!=</span> <span class="s1">"string"</span></span><span class="line">      <span class="kd">|| typeof</span> Meteor.userId()         <span class="kd">!=</span> <span class="s1">"string"</span></span><span class="line">    ){</span><span class="line">      <span class="kd">return</span> {<span class="na">error</span>: <span class="s1">"datosErroneos"</span>}</span><span class="line">    }</span>
<span class="line added">    <span class="kd">var</span> errores = validarPublicaciones(<span class="ss">nuevaPublicacion</span>);</span><span class="line added">    <span class="kd">if</span>( errores.titulo <span class="kd">||</span> errores.url ){</span><span class="line added">      <span class="kd">throw</span> console.error(<span class="s1">"Publicación inválida:<span class="kd">\n</span>Debes establecer un título y una dirección web a tu publicación."</span>);</span><span class="line added">    }</span>
<span class="line c1">    // Comprobar si existe la dirección web</span><span class="line">    <span class="kd">if</span>( Publicaciones.findOne({<span class="s1">"url"</span>: <span class="ss">nuevaPublicacion</span>.url}) ){</span><span class="line">      <span class="kd">return</span> {</span><span class="line">        <span class="na">error</span>: <span class="s1">"publicacionExistente"</span>,</span><span class="line">        <span class="na">_id</span>  : Publicaciones.findOne({<span class="s1">"url"</span>: <span class="ss">nuevaPublicacion</span>.url})._id</span><span class="line">      };</span><span class="line">    }</span>
<span class="line c1">    // Añadir los datos del usuario actual: Meteor.user()</span><span class="line">    <span class="kd">var</span> usuarioActual = Meteor.user();</span><span class="line">    <span class="ss">nuevaPublicacion</span>._usuario = {</span><span class="line">      <span class="na">_id</span>  : usuarioActual._id,</span><span class="line">      <span class="na">autor</span>: usuarioActual.username</span><span class="line">    };</span><span class="line">    <span class="ss">nuevaPublicacion</span>.fecha = {<span class="na">insercion</span>: <span class="kd">new</span> <span class="nb">Date</span>()};</span>
<span class="line c1">    // Inserción de la publicación nueva a la vez que devuelve el id de la publicación creada.</span><span class="line">    <span class="kd">return</span> {<span class="na">_id</span>: Publicaciones.insert(<span class="ss">nuevaPublicacion</span>)};</span><span class="line">  },</span>
<span class="line">  <span class="s1">"publicacionesModificar"</span>: <span class="kd">function</span>(<span class="ss">publicacionModificada</span>){</span><span class="line c1">    // Comprobar los datos</span><span class="line">    <span class="kd">if</span>(  <span class="kd">typeof</span> <span class="ss">publicacionModificada</span>.url    <span class="kd">!=</span> <span class="s1">"string"</span></span><span class="line">      <span class="kd">|| typeof</span> <span class="ss">publicacionModificada</span>.titulo <span class="kd">!=</span> <span class="s1">"string"</span></span><span class="line">      <span class="kd">|| typeof</span> Meteor.userId()              <span class="kd">!=</span> <span class="s1">"string"</span> ){</span><span class="line">      <span class="kd">return</span> {<span class="na">error</span>: <span class="s1">"datosErroneos"</span>};</span>
<span class="line c1">    // Comprobar si existe la dirección web</span><span class="line c1">      // Si existe solo puede modificar la publicación si contiene el mismo _id</span><span class="line">    } <span class="kd">else if</span>( Publicaciones.findOne({<span class="na">url</span>: <span class="ss">publicacionModificada</span>.url})</span><span class="line">        && Publicaciones.findOne({<span class="na">url</span>: <span class="ss">publicacionModificada</span>.url})._id <span class="kd">!=</span> <span class="ss">publicacionModificada</span>._id ){</span><span class="line">      <span class="kd">return</span> {</span><span class="line">        <span class="na">error</span>: <span class="s1">"publicacionExistente"</span>,</span><span class="line">        <span class="na">_id</span>  : <span class="ss">publicacionModificada</span>._id</span><span class="line">      }</span><span class="line">    }</span>
<span class="line added">    <span class="kd">var</span> errores = validarPublicaciones(<span class="ss">publicacionModificada</span>);</span><span class="line added">    <span class="kd">if</span>( errores.titulo <span class="kd">||</span> errores.url ){</span><span class="line added">      <span class="kd">throw</span> console.error(<span class="s1">"Publicación inválida:<span class="kd">\n</span>Debes establecer un título y una dirección web a tu publicación."</span>);</span><span class="line added">    }</span>
<span class="line c1">    // Añadir la fecha de actualización a la publicación</span><span class="line">    <span class="ss">publicacionModificada</span>.fecha.actualizacion = <span class="kd">new</span> <span class="nb">Date</span>();</span>
<span class="line c1">    // Actualizar la publicación</span><span class="line">    Publicaciones.update(<span class="ss">publicacionModificada</span>._id, {$<span class="na">set</span>: <span class="ss">publicacionModificada</span>});</span>
<span class="line c1">    // Devolver el id de la publicación</span><span class="line">    <span class="kd">return</span> {<span class="na">_id</span>: <span class="ss">publicacionModificada</span>._id};</span><span class="line">  },</span>
<span class="line">  <span class="s1">"publicacionesEliminar"</span>: <span class="kd">function</span>(<span class="ss">publicacionMoribunda</span>){</span><span class="line c1">    // Simplemente elimina la publicación</span><span class="line">    Publicaciones.remove({<span class="na">_id</span>: <span class="ss">publicacionMoribunda</span>._id});</span><span class="line">  }</span><span class="line">});</span></pre>
			<div class="caption">/lib/colecciones/publicaciones.js</div>
			
			<p>De nuevo, los usuarios no deberían nunca ver este mensaje <em>"Debes establecer un título y una dirección web a tu publicación"</em>. Sólo se mostrará si alguien quiere saltarse los controles que hemos dispuesto concienzudamente, y usa la consola del navegador.</p>
			
			<p>Para probarlo, abre una consola del navegador y prueba a enviar una publicación sin URL:</p>
			
			<pre><span class="line">Meteor.call(<span class="s1">"publicacionesInsertar"</span>, {<span class="na">titulo</span>: <span class="s1">"¡No hay URL aquí!"</span>, <span class="na">url</span>: <span class="s1">""</span>});</span></pre>
			<div class="caption">Consola del navegador</div>
			
			<p>Si hemos hecho bien nuestro trabajo, obtendrás un mensaje por consola: <em>"Debes establecer un título y una dirección web a tu publicación"</em>.</p>
			
			<figure class="screenshot"><img src="./Errores_files/9-5.png" alt="Error por consola del navegador."><figcaption>Error por consola del navegador.</figcaption></figure>
			
			<p>También hemos añadido el código para <code>publicacionesModificar</code> y si ejecutas un código similar podrás ver el mismo efecto en la consola del navegador.</p>
			
			<p>Como estamos en la carpeta <code>/lib</code> podremos ver también el código de error en la terminar del servidor.</p>
			
			<figure class="screenshot"><img src="./Errores_files/9-6.png" alt="Error en la terminal."><figcaption>Error en la terminal.</figcaption></figure>
			
            <p>Por último solo resta el formulario de <code>publicacionesModificar</code>:</p>
			
			<p>Comencemos primero por el html <code>publicaciones_modificar.html</code>:</p>
			
			<pre><span class="line"><span class="nt">&lt;template</span> <span class="na">name</span>=<span class="s1">"publicacionesModificar"</span><span class="nt">&gt;</span></span><span class="line">  <span class="nt">&lt;form</span> <span class="na">class</span>=<span class="s1">"main form pagina"</span><span class="nt">&gt;</span></span><span class="line added">    <span class="nt">&lt;div</span> <span class="na">class</span>=<span class="s1">"form-group {{errorClase 'url'}}"</span><span class="nt">&gt;</span></span><span class="line">      <span class="nt">&lt;label</span> <span class="na">class</span>=<span class="s1">"control-label"</span> <span class="na">for</span>=<span class="s1">"url"</span><span class="nt">&gt;</span>URL<span class="nt">&lt;/label&gt;</span></span><span class="line">      <span class="nt">&lt;div</span> <span class="na">class</span>=<span class="s1">"controls"</span><span class="nt">&gt;</span></span><span class="line added">        <span class="nt">&lt;input</span> <span class="na">autofocus</span> <span class="na">name</span>=<span class="s1">"url"</span> <span class="na">id</span>=<span class="s1">"url"</span> <span class="na">type</span>=<span class="s1">"text"</span> <span class="na">value</span>=<span class="s1">"{{url}}"</span> <span class="na">placeholder</span>=<span class="s1">"Dirección web"</span> <span class="na">class</span>=<span class="s1">"form-control"</span><span class="nt">/&gt;</span></span><span class="line added">        <span class="nt">&lt;span</span> <span class="na">class</span>=<span class="s1">"help-block"</span><span class="nt">&gt;</span>{{errorPublicacion <span class="s1">"url"</span>}}<span class="nt">&lt;/span&gt;</span></span><span class="line nt">      &lt;/div&gt;</span><span class="line nt">    &lt;/div&gt;</span><span class="line added">    <span class="nt">&lt;div</span> <span class="na">class</span>=<span class="s1">"form-group {{errorClase 'titulo'}}"</span><span class="nt">&gt;</span></span><span class="line">      <span class="nt">&lt;label</span> <span class="na">class</span>=<span class="s1">"control-label"</span> <span class="na">for</span>=<span class="s1">"titulo"</span><span class="nt">&gt;</span>Título<span class="nt">&lt;/label&gt;</span></span><span class="line">      <span class="nt">&lt;div</span> <span class="na">class</span>=<span class="s1">"controls"</span><span class="nt">&gt;</span></span><span class="line">        <span class="nt">&lt;input</span> <span class="na">name</span>=<span class="s1">"titulo"</span> <span class="na">id</span>=<span class="s1">"titulo"</span> <span class="na">type</span>=<span class="s1">"text"</span> <span class="na">value</span>=<span class="s1">"{{titulo}}"</span> <span class="na">placeholder</span>=<span class="s1">"Título de su publicación"</span> <span class="na">class</span>=<span class="s1">"form-control"</span><span class="nt">/&gt;</span></span><span class="line added">        <span class="nt">&lt;span</span> <span class="na">class</span>=<span class="s1">"help-block"</span><span class="nt">&gt;</span>{{errorPublicacion <span class="s1">"titulo"</span>}}<span class="nt">&lt;/span&gt;</span></span><span class="line nt">      &lt;/div&gt;</span><span class="line nt">    &lt;/div&gt;</span><span class="line">    <span class="nt">&lt;input</span> <span class="na">type</span>=<span class="s1">"submit"</span> <span class="na">value</span>=<span class="s1">"Modificar"</span> <span class="na">class</span>=<span class="s1">"btn btn-primary submit"</span><span class="nt">/&gt;</span></span><span class="line nt">    &lt;hr/&gt;</span><span class="line">    <span class="nt">&lt;a</span> <span class="na">class</span>=<span class="s1">"btn btn-danger eliminar"</span> <span class="na">href</span>=<span class="s1">"#"</span><span class="nt">&gt;</span>Eliminar publicación<span class="nt">&lt;/a&gt;</span></span><span class="line nt">  &lt;/form&gt;</span><span class="line nt">&lt;/template&gt;</span></pre>
			<div class="caption">/client/plantillas/publicaciones/publicaciones_modificar.html</div>
			
			<p>De paso añadimos el atributo <code class="na">autofocus</code> al primer <code class="nt">&lt;input/&gt;</code>.</p>
			
			<p>Como podrías imaginar el siguiente paso es en <code>publicaciones_modificar.js</code>:</p>
			
			<pre><span class="line added">Template.publicacionesModificar.onCreated(<span class="kd">function</span>(){</span><span class="line added">  Session.set(<span class="s1">"publicacionesModificar_errores"</span>, {});</span><span class="line added">});</span>
<span class="line added">Template.publicacionesModificar.helpers({</span><span class="line added">  <span class="s1">"errorPublicacion"</span>: <span class="kd">function</span>(<span class="ss">campo</span>){</span><span class="line added">    <span class="kd">return</span> Session.get(<span class="s1">"publicacionesModificar_errores"</span>)[<span class="ss">campo</span>];</span><span class="line added">  },</span>
<span class="line added">  <span class="s1">"errorClase"</span>: <span class="kd">function</span>(<span class="ss">campo</span>){</span><span class="line added c1">    // Si hay error añade la clase "has-error"</span><span class="line added">    <span class="kd">return !!</span> Session.get(<span class="s1">"publicacionesModificar_errores"</span>)[<span class="ss">campo</span>] ?<span class="s1">"has-error"</span> :<span class="s1">""</span>;</span><span class="line added">  }</span><span class="line added">});</span>
<span class="line">Template.publicacionesModificar.events({</span><span class="line">  <span class="s1">"submit form"</span>: <span class="kd">function</span>(<span class="ss">e</span>){</span><span class="line">    <span class="ss">e</span>.preventDefault();</span>
<span class="line">    <span class="kd">var</span> publicacionModificada = {</span><span class="line">      <span class="na">_id</span>   : <span class="kd">this</span>._id,</span><span class="line">      <span class="na">titulo</span>: $(<span class="ss">e</span>.target).find(<span class="s1">"[name=titulo]"</span>).val(),</span><span class="line">      <span class="na">url</span>   : $(<span class="ss">e</span>.target).find(<span class="s1">"[name=url]"</span>).val()</span><span class="line">    };</span>
<span class="line added c1">    // Si existen errores muestra los y detén el código mediante el return</span><span class="line added">    <span class="kd">var</span> errores = validarPublicaciones(publicacionModificada);</span><span class="line added">    <span class="kd">if</span>( errores.titulo <span class="kd">||</span> errores.url ){ <span class="kd">return</span> Session.set(<span class="s1">"publicacionesModificar_errores"</span>, errores); }</span>
<span class="line">    Meteor.call(<span class="s1">"publicacionesModificar"</span>, publicacionModificada, <span class="kd">function</span>(<span class="ss">error</span>, <span class="ss">resultado</span>){</span><span class="line c1">      // •••</span><span class="line">    });</span><span class="line">  },</span>
<span class="line">  <span class="s1">"click .eliminar"</span>: <span class="kd">function</span>(<span class="ss">e</span>){</span><span class="line c1">    // •••</span><span class="line">  }</span><span class="line">});</span></pre>
			<div class="caption">/client/plantillas/publicaciones/publicaciones_modificar.js</div>
			
			<p>Comprovemos que funcionen las sessiones:</p>
			
			<pre><span class="line"><span class="kd browser-prompt">></span> Session.set(<span class="s1">"publicacionesModificar_errores"</span>, {<span class="na">titulo</span>: <span class="s1">"¡Peligro! Intruso detectado. desplegando a los robo-perros."</span>});</span></pre>
			<div class="caption">Consola del navegador</div>
			
			<figure class="screenshot"><img src="./Errores_files/9-7.png" alt="Errores en el formulario de sesión controlados."><figcaption>Errores en el formulario de sesión controlados.</figcaption></figure>
			
			<p>No hará falta modificar el servidor <code>Meteor.Methods</code> por que ya lo hicimos en anteriores pasos. Pero confirmaremos si funciona:</p>
			
			<pre><span class="line">Meteor.call(<span class="s1">"publicacionesModificar"</span>, {<span class="na">titulo</span>: <span class="s1">"¡No hay URL aquí!"</span>, <span class="na">url</span>: <span class="s1">""</span>});</span></pre>
			<div class="caption">Consola del navegador</div>
			
			<figure class="screenshot"><img src="./Errores_files/9-8.png" alt="Errores por consola del navegador."><figcaption>Errores por consola del navegador.</figcaption></figure>
          </div>
          <div class="bottom-nav">
            <div class="post-nav">
              <a class="prev" href="http://es.discovermeteor.com/chapters/allow-and-deny/" title="Previous Post: Permitir y Denegar">
                «
                Permitir y Denegar
              </a>
              <a class="next" href="http://es.discovermeteor.com/chapters/creating-a-meteor-package/" title="next Post: Creando un paquete Meteor">
                Creando un paquete Meteor
                »
              </a>
            </div>
          </div>
        </div>
        <div class="comments sidebar">
          <a class="sidebar-toggle" data-disqus-identifier="errors_es" href="http://es.discovermeteor.com/chapters/errors/#disqus_thread">0 Comments</a>
          <div class="sidebar-inner">
            <div class="issues">
              <a class="issue-link simple-button" href="https://github.com/DiscoverMeteor/Microscope/issues" target="_blank">Reporta un problema con el código</a>
              <a class="issue-link simple-button" href="https://github.com/DiscoverMeteor/DiscoverMeteor_es/issues" target="_blank">Reporta un problema con el libro</a>
              <hr>
              <p>O, comenta el contenido aquí:</p>
            </div>
            <div id="disqus_thread"><iframe id="dsq-app8753" name="dsq-app8753" allowtransparency="true" frameborder="0" scrolling="no" tabindex="0" title="Disqus" width="100%" src="./Errores_files/saved_resource.html" style="width: 1px !important; min-width: 100% !important; border: none !important; overflow: hidden !important; height: 468px !important;" horizontalscrolling="no" verticalscrolling="no"></iframe></div>
            <script type="text/javascript">
                /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
                var disqus_shortname = 'discovermeteores'; // required: replace example with your forum shortname
                var disqus_identifier = 'errors_es';
            
                /* * * DON'T EDIT BELOW THIS LINE * * */
                (function() {
                    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                    dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
                    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
                })();
            
                /* * * DON'T EDIT BELOW THIS LINE * * */
                (function () {
                var s = document.createElement('script'); s.async = true;
                s.type = 'text/javascript';
                s.src = 'http://' + disqus_shortname + '.disqus.com/count.js';
                (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
                }());
            
            </script>
          </div>
        </div>
      </div>
    </div>
    <footer>
      <div class="row">
        © 2014 <a href="http://tom.thesnail.org/">Tom Coleman</a> y <a href="http://sachagreif.com/">Sacha Greif</a>
      </div>
    </footer>
    <!-- %script{:src => "https://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.5.2/underscore-min.js"} -->
    <script src="./Errores_files/moment.min.js.descarga"></script>
    <script src="./Errores_files/es.js.descarga"></script>
    <script src="./Errores_files/script.js.descarga"></script>
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
      
      ga('create', 'UA-38246482-5', 'discovermeteor.com');
      ga('send', 'pageview');
    </script>
    <input id="lang" type="hidden" value="es">
  

<iframe style="display: none;" src="./Errores_files/saved_resource(1).html"></iframe></body></html>