<!DOCTYPE html>
<!-- saved from url=(0052)http://es.discovermeteor.com/chapters/editing-posts/ -->
<html class="no-js wf-klavikaweb-n3-active wf-klavikaweb-n6-active wf-sourcesanspro-n4-active wf-sourcesanspro-n7-active wf-sourcesanspro-i7-active wf-sourcesanspro-i4-active wf-sourcesanspro-n3-active wf-sourcesanspro-i3-active wf-sourcecodepro-n7-active wf-sourcecodepro-n4-active wf-active" lang="es"><!-- <![endif] --><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    
    <!-- Set the viewport width to device width for mobile -->
    <meta content="width=device-width, initial-scale=1.0" name="viewport">
    <title>Editando publicaciones - Descubriendo Meteor</title>
    <!-- Included CSS Files -->
    <link href="./Editando posts_files/screen.css" rel="stylesheet">
    <link href="./Editando posts_files/print.css" media="print" rel="stylesheet">
    <!-- %link{:href => "http://fonts.googleapis.com/css?family=Source+Sans+Pro:200,400,700,400italic", :rel => "stylesheet"} -->
    <!-- %link{:href => "http://fonts.googleapis.com/css?family=Source+Code+Pro:400,700", :rel => "stylesheet"} -->
    <link href="http://es.discovermeteor.com/images/favicon.ico" rel="shortcut icon">
    <script async="" src="./Editando posts_files/analytics.js.descarga"></script><script src="./Editando posts_files/jquery.min.js.descarga"></script><style type="text/css">
:root .adsbox
{ display: none !important; }</style>
    <script src="./Editando posts_files/rcr2ohz.js.descarga"></script>
    <style type="text/css">.tk-klavika-web{font-family:"klavika-web",sans-serif;}.tk-source-sans-pro{font-family:"source-sans-pro",sans-serif;}.tk-source-code-pro{font-family:"source-code-pro",sans-serif;}</style><style type="text/css">@font-face{font-family:klavika-web;src:url(https://use.typekit.net/af/5401fe/00000000000000003b9acdf2/27/l?subset_id=2&fvd=n3&v=3) format("woff2"),url(https://use.typekit.net/af/5401fe/00000000000000003b9acdf2/27/d?subset_id=2&fvd=n3&v=3) format("woff"),url(https://use.typekit.net/af/5401fe/00000000000000003b9acdf2/27/a?subset_id=2&fvd=n3&v=3) format("opentype");font-weight:300;font-style:normal;}@font-face{font-family:klavika-web;src:url(https://use.typekit.net/af/835e90/00000000000000003b9acdf6/27/l?subset_id=2&fvd=n6&v=3) format("woff2"),url(https://use.typekit.net/af/835e90/00000000000000003b9acdf6/27/d?subset_id=2&fvd=n6&v=3) format("woff"),url(https://use.typekit.net/af/835e90/00000000000000003b9acdf6/27/a?subset_id=2&fvd=n6&v=3) format("opentype");font-weight:600;font-style:normal;}@font-face{font-family:source-sans-pro;src:url(https://use.typekit.net/af/b0088d/00000000000000003b9acb59/27/l?subset_id=2&fvd=n4&v=3) format("woff2"),url(https://use.typekit.net/af/b0088d/00000000000000003b9acb59/27/d?subset_id=2&fvd=n4&v=3) format("woff"),url(https://use.typekit.net/af/b0088d/00000000000000003b9acb59/27/a?subset_id=2&fvd=n4&v=3) format("opentype");font-weight:400;font-style:normal;}@font-face{font-family:source-sans-pro;src:url(https://use.typekit.net/af/c55ca5/00000000000000003b9acb5c/27/l?subset_id=2&fvd=n7&v=3) format("woff2"),url(https://use.typekit.net/af/c55ca5/00000000000000003b9acb5c/27/d?subset_id=2&fvd=n7&v=3) format("woff"),url(https://use.typekit.net/af/c55ca5/00000000000000003b9acb5c/27/a?subset_id=2&fvd=n7&v=3) format("opentype");font-weight:700;font-style:normal;}@font-face{font-family:source-sans-pro;src:url(https://use.typekit.net/af/7e0c18/00000000000000003b9acb5d/27/l?subset_id=2&fvd=i7&v=3) format("woff2"),url(https://use.typekit.net/af/7e0c18/00000000000000003b9acb5d/27/d?subset_id=2&fvd=i7&v=3) format("woff"),url(https://use.typekit.net/af/7e0c18/00000000000000003b9acb5d/27/a?subset_id=2&fvd=i7&v=3) format("opentype");font-weight:700;font-style:italic;}@font-face{font-family:source-sans-pro;src:url(https://use.typekit.net/af/c42064/00000000000000003b9acb58/27/l?subset_id=2&fvd=i4&v=3) format("woff2"),url(https://use.typekit.net/af/c42064/00000000000000003b9acb58/27/d?subset_id=2&fvd=i4&v=3) format("woff"),url(https://use.typekit.net/af/c42064/00000000000000003b9acb58/27/a?subset_id=2&fvd=i4&v=3) format("opentype");font-weight:400;font-style:italic;}@font-face{font-family:source-sans-pro;src:url(https://use.typekit.net/af/b35fa2/00000000000000003b9acb56/27/l?subset_id=2&fvd=n3&v=3) format("woff2"),url(https://use.typekit.net/af/b35fa2/00000000000000003b9acb56/27/d?subset_id=2&fvd=n3&v=3) format("woff"),url(https://use.typekit.net/af/b35fa2/00000000000000003b9acb56/27/a?subset_id=2&fvd=n3&v=3) format("opentype");font-weight:300;font-style:normal;}@font-face{font-family:source-sans-pro;src:url(https://use.typekit.net/af/a6c785/00000000000000003b9acb57/27/l?subset_id=2&fvd=i3&v=3) format("woff2"),url(https://use.typekit.net/af/a6c785/00000000000000003b9acb57/27/d?subset_id=2&fvd=i3&v=3) format("woff"),url(https://use.typekit.net/af/a6c785/00000000000000003b9acb57/27/a?subset_id=2&fvd=i3&v=3) format("opentype");font-weight:300;font-style:italic;}@font-face{font-family:source-code-pro;src:url(https://use.typekit.net/af/b8b49b/0000000000000000000179d5/27/l?subset_id=2&fvd=n7&v=3) format("woff2"),url(https://use.typekit.net/af/b8b49b/0000000000000000000179d5/27/d?subset_id=2&fvd=n7&v=3) format("woff"),url(https://use.typekit.net/af/b8b49b/0000000000000000000179d5/27/a?subset_id=2&fvd=n7&v=3) format("opentype");font-weight:700;font-style:normal;}@font-face{font-family:source-code-pro;src:url(https://use.typekit.net/af/953e9e/0000000000000000000179cf/27/l?subset_id=2&fvd=n4&v=3) format("woff2"),url(https://use.typekit.net/af/953e9e/0000000000000000000179cf/27/d?subset_id=2&fvd=n4&v=3) format("woff"),url(https://use.typekit.net/af/953e9e/0000000000000000000179cf/27/a?subset_id=2&fvd=n4&v=3) format("opentype");font-weight:400;font-style:normal;}</style><script>
      try{Typekit.load();}catch(e){}
    </script>
  <script type="text/javascript" async="" src="./Editando posts_files/embed.js.descarga"></script><script async="" type="text/javascript" src="./Editando posts_files/count.js.descarga"></script><style type="text/css">
:root *[tqqn06q][hidden] { display: none !important; }</style><script src="./Editando posts_files/count-data.js.descarga"></script><link rel="preload" as="style" href="https://c.disquscdn.com/next/embed/styles/lounge.2d848eddee1b8c12749b72a04b2b33dc.css"><link rel="preload" as="script" href="https://c.disquscdn.com/next/embed/common.bundle.845ead53749f15d0bd8a5ee344c8f06e.js"><link rel="preload" as="script" href="https://c.disquscdn.com/next/embed/lounge.bundle.8241ae5fc761eb94635acdc63f5fd29f.js"><link rel="preload" as="script" href="https://disqus.com/next/config.js"><script src="./Editando posts_files/alfie.f51946af45e0b561c60f768335c9eb79.js.descarga" async="" charset="UTF-8"></script></head>
  <body style="zoom: 1;" cz-shortcut-listen="true">
    <header>
      <h1>
        <a href="http://es.discovermeteor.com/">
          <span>Descubriendo</span>
          <strong>Meteor</strong>
        </a>
      </h1>
    </header>
    <div class="main">
      <div class="row">
        <div class="toc sidebar">
          <a class="sidebar-toggle" href="javascript:void(0)">Toggle Table of Contents</a>
          <div class="sidebar-inner">
            <ul>
              <li>
                <span class="number">
                  1
                </span>
                <a href="http://es.discovermeteor.com/chapters/introduction/">
                  Introducción
                </a>
              </li>
              <li>
                <span class="number">
                  2
                </span>
                <a href="http://es.discovermeteor.com/chapters/getting-started/">
                  Empezando
                </a>
              </li>
              <li class="sidebar-chapter">
                <span class="number">
                  2.5
                </span>
                <a href="http://es.discovermeteor.com/chapters/deploying/">
                  Despliegue
                </a>
              </li>
              <li>
                <span class="number">
                  3
                </span>
                <a href="http://es.discovermeteor.com/chapters/templates/">
                  Plantillas
                </a>
              </li>
              <li class="sidebar-chapter">
                <span class="number">
                  3.5
                </span>
                <a href="http://es.discovermeteor.com/chapters/github/">
                  Usando Git y GitHub
                </a>
              </li>
              <li>
                <span class="number">
                  4
                </span>
                <a href="http://es.discovermeteor.com/chapters/collections/">
                  Colecciones
                </a>
              </li>
              <li class="sidebar-chapter">
                <span class="number">
                  4.5
                </span>
                <a href="http://es.discovermeteor.com/chapters/publications-and-subscriptions/">
                  Publicaciones y suscripciones
                </a>
              </li>
              <li>
                <span class="number">
                  5
                </span>
                <a href="http://es.discovermeteor.com/chapters/routing/">
                  Enrutando
                </a>
              </li>
              <li class="sidebar-chapter">
                <span class="number">
                  5.5
                </span>
                <a href="http://es.discovermeteor.com/chapters/the-session/">
                  La sesión
                </a>
              </li>
              <li>
                <span class="number">
                  6
                </span>
                <a href="http://es.discovermeteor.com/chapters/adding-users/">
                  Añadiendo usuarios
                </a>
              </li>
              <li class="sidebar-chapter">
                <span class="number">
                  6.5
                </span>
                <a href="http://es.discovermeteor.com/chapters/reactivity/">
                  Reactividad
                </a>
              </li>
              <li>
                <span class="number">
                  7
                </span>
                <a href="http://es.discovermeteor.com/chapters/creating-posts/">
                  Creando posts
                </a>
              </li>
              <li class="sidebar-chapter">
                <span class="number">
                  7.5
                </span>
                <a href="http://es.discovermeteor.com/chapters/latency-compensation/">
                  Compensación de la latencia
                </a>
              </li>
              <li class="active">
                <span class="number">
                  8
                </span>
                <a href="http://es.discovermeteor.com/chapters/editing-posts/">
                  Editando posts
                </a>
              </li>
              <li class="sidebar-chapter">
                <span class="number">
                  8.5
                </span>
                <a href="http://es.discovermeteor.com/chapters/allow-and-deny/">
                  Permitir y Denegar
                </a>
              </li>
              <li>
                <span class="number">
                  9
                </span>
                <a href="http://es.discovermeteor.com/chapters/errors/">
                  Errores
                </a>
              </li>
              <li class="sidebar-chapter">
                <span class="number">
                  9.5
                </span>
                <a href="http://es.discovermeteor.com/chapters/creating-a-meteor-package/">
                  Creando un paquete Meteor
                </a>
              </li>
              <li>
                <span class="number">
                  10
                </span>
                <a href="http://es.discovermeteor.com/chapters/comments/">
                  Comentarios
                </a>
              </li>
              <li class="sidebar-chapter">
                <span class="number">
                  10.5
                </span>
                <a href="http://es.discovermeteor.com/chapters/denormalization/">
                  Denormalización
                </a>
              </li>
              <li>
                <span class="number">
                  11
                </span>
                <a href="http://es.discovermeteor.com/chapters/notifications/">
                  Notificaciones
                </a>
              </li>
              <li class="sidebar-chapter">
                <span class="number">
                  11.5
                </span>
                <a href="http://es.discovermeteor.com/chapters/advanced-reactivity/">
                  Reactividad avanzada
                </a>
              </li>
              <li>
                <span class="number">
                  12
                </span>
                <a href="http://es.discovermeteor.com/chapters/pagination/">
                  Paginación
                </a>
              </li>
              <li>
                <span class="number">
                  13
                </span>
                <a href="http://es.discovermeteor.com/chapters/voting/">
                  Votos
                </a>
              </li>
              <li class="sidebar-chapter">
                <span class="number">
                  13.5
                </span>
                <a href="http://es.discovermeteor.com/chapters/advanced-publications/">
                  Publicaciones avanzadas
                </a>
              </li>
              <li>
                <span class="number">
                  14
                </span>
                <a href="http://es.discovermeteor.com/chapters/animations/">
                  Animaciones
                </a>
              </li>
              <li>
                <span class="number">
                  14.5
                </span>
                <a href="http://es.discovermeteor.com/chapters/going-further/">
                  Ir más lejos
                </a>
              </li>
              <li>
                <span class="number">
                  14.5
                </span>
                <a href="http://es.discovermeteor.com/chapters/meteor-vocabulary/">
                  Vocabulario
                </a>
              </li>
              <li>
                <span class="number">
                  99
                </span>
                <a href="http://es.discovermeteor.com/chapters/changelog/">
                  Changelog
                </a>
              </li>
            </ul>
          </div>
        </div>
        <div class="vocabulary sidebar">
          <a class="sidebar-toggle" href="http://es.discovermeteor.com/chapters/editing-posts/#">Toggle Vocabulary</a>
          <div class="sidebar-inner">
            <div class="sidebar-content">
              <h3>Vocabulary</h3>
              <h4>Cliente</h4>
              
              <p style="display: none;">Cuando hablamos del Cliente, nos referimos al código que se ejecuta en el navegador de los usuarios, ya sea uno tradicional, como Firefox o Safari, o algo tan complejo como un UIWebView en una aplicación nativa para el iPhone.</p>
              
              <h4>Colección</h4>
              
              <p style="display: none;">Una colección es el almacén de datos que se sincroniza automáticamente entre el cliente y el servidor. Las colecciones tienen un nombre (como <code>posts</code>), y por lo general existen tanto en el cliente como en el servidor. Si bien se comportan de forma distinta, tienen una API común basada en la API de Mongo.</p>
              
              <h4>Computación</h4>
              
              <p style="display: none;">Una computación es un bloque de código que se ejecuta cada vez que cambia una de las fuentes de datos reactivos de las que depende. Si tienes una fuente reactiva (por ejemplo, una variable de sesión) y quieres responder reactivamente a ella, tendrás que crear una computación.</p>
              
              <h4>Cursor</h4>
              
              <p style="display: none;">Un cursor es el resultado de ejecutar una consulta en una colección Mongo. En el lado del cliente, un cursor no es tan sólo un conjunto de resultados, sino que es un objeto <em>reactivo</em> desde el que se puede observar (con <code>observe()</code>) los cambios (añadir, eliminar o actualizar) en la colección correspondiente.</p>
              
              <h4>DDP</h4>
              
              <p style="display: none;">El DDP es el Protocolo de Datos Distribuidos que utiliza Meteor para sincronizar colecciones y efectuar llamadas a métodos. DDP pretende ser un protocolo genérico, que toma el relevo a HTTP para aplicaciones en tiempo real con gran carga de datos.</p>
              
              <h4>Deps</h4>
              
              <p style="display: none;">Deps es el sistema reactivo de Meteor. Deps se utiliza entre bastidores para sincronizar automáticamente el  HTML con el modelo de datos subyacente.</p>
              
              <h4>Documento</h4>
              
              <p style="display: none;">Mongo es un almacén de datos basado en documentos y a los objetos que salen de las colecciones se les llama “documentos”. Son objetos JavaScript sin formato (aunque no pueden contener funciones) con una única propiedad especial, el ’_id’, que Meteor utiliza para realizar un seguimiento de sus propiedades en el DDP.</p>
              
              <h4>Ayudantes</h4>
              
              <p style="display: none;">Cuando una plantilla necesita mostrar cosas más complejas que una simple propiedad de un documento, ésta puede hacer uso de su ayudante, una función que se utiliza para procesar los datos que se muestran en ella.</p>
              
              <h4>Compensación de la latencia</h4>
              
              <p style="display: none;">Es una técnica que permite simular llamadas a métodos en el cliente para evitar retrasos mientras se espera la respuesta del servidor.</p>
              
              <h4>Meteor Development Group (MDG)</h4>
              
              <p style="display: none;">La empresa que desarrolla Meteor.</p>
              
              <h4>Método</h4>
              
              <p style="display: none;">Un método en Meteor es una llamada desde el cliente, a un procedimiento remoto en el servidor, con un poco de lógica añadida que permite realizar un seguimiento de los cambios en los datos además de compensar la latencia de la llamada.</p>
              
              <h4>MiniMongo</h4>
              
              <p style="display: none;">La colección del lado del cliente es un almacén de datos en memoria que ofrece una API tipo Mongo. La librería que se utiliza se llama “MiniMongo”, para indicar que es una versión más pequeña de Mongo que se ejecuta por completo en la memoria del navegador.</p>
              
              <h4>Paquete</h4>
              
              <p style="display: none;">Un paquete Meteor puede ser: código JavaScript que se ejecuta en el servidor, código JavaScript que se ejecuta en el cliente, instrucciones para procesar recursos (como SASS a CSS), o recursos que deben ser  procesados​​. <br> Un paquete es como una librería con superpoderes. Meteor incluye una gran cantidad de paquetes (<code>meteor list</code>). También existe <a href="http://atmosphere.meteor.com/">Atmosphere</a>, que es una colección de paquetes de terceros mantenida por la comunidad (<code>mrt add ...</code>).</p>
              
              <h4>Publicación</h4>
              
              <p style="display: none;">Una publicación es un conjunto de datos con nombre que se personaliza para cada usuario que se suscribe a ella. Se configuran en el servidor.</p>
              
              <h4>Servidor</h4>
              
              <p style="display: none;">El servidor Meteor es un servidor HTTP y DDP ejecutados vía Node.js. Se compone de todas las librerías y del código JavaScript del lado del servidor. Cuando se inicia el servidor, se conecta a una base de datos Mongo (que configura por si mismo en el primer arranque).</p>
              
              <h4>Sesión</h4>
              
              <p style="display: none;">La sesión en Meteor es una fuente de datos reactiva que usa tu aplicación para hacer un seguimiento del estado del usuario.</p>
              
              <h4>Suscripción</h4>
              
              <p style="display: none;">Una suscripción es una conexión a una publicación desde un cliente específico. La suscripción es el código que ejecuta el navegador y que utiliza para comunicarse con una publicación del servidor y que, además, mantiene los datos sincronizados.</p>
              
              <h4>Plantilla</h4>
              
              <p style="display: none;">Una plantilla es una forma de generar código HTML desde JavaScript. Por defecto, Meteor sólo soporta el sistema Spacebars, pero hay planes para incluir más.</p>
              
              <h4>Contexto de datos de una plantilla</h4>
              
              <p style="display: none;">Cuando se muestra un plantilla, lo que se representa es un objeto JavaScript que proporciona datos específicos para esta representación en particular. Por lo general, este tipo de objetos son, de tipo POJO (plain-old-JavaScript-objects), a menudo son documentos de una colección, aunque pueden ser más complejos e incluir funciones.</p>
            </div>
          </div>
        </div>
        <div class="post">
          <div class="top-nav">
            <div class="post-nav">
              <a class="prev" href="http://es.discovermeteor.com/chapters/latency-compensation/" title="Previous Post: Compensación de la latencia">
                «
                Compensación de la latencia
              </a>
              <a class="next" href="http://es.discovermeteor.com/chapters/allow-and-deny/" title="next Post: Permitir y Denegar">
                Permitir y Denegar
                »
              </a>
            </div>
          </div>
          <div class="post-content">
            <div class="chapter-heading">
              <h2 class="chapter-title">Editando publicaciones</h2>
              <span class="chapter-number">8</span>
            </div>
            <input id="paragraphs" type="hidden" value="29">
            <div class="chapter-summary note chapter">
			  <a href="#men" style="position:fixed;bottom:0px;left:0px;margin:2px;padding:2px 7px;background-color:rgba(64, 64, 64, 0.2);border-radius:50%;box-shadow:0px 0px 5px rgba(0, 0, 0, 0.4);">▲</a>
			  <h3 id="men">En este capítulo:</h3>
              <ul>
			    <li><a href="#men-lpdedp">La plantilla de edición de publicaciones</a></li>
			    <li><a href="#men-ae">Añadiendo enlaces</a></li>
			    <li><a href="#men-clp">Configurando los permisos</a></li>
			    <li><a href="#men-eed">Evitar enlaces duplicados</a></li>
			  </ul>
            </div>
			
            <p>Siguiente paso: Editar y borrar publicaciones. Necesitaremos gestionar permisos para los usuarios.</p>
            
            <p>Primero crearemos un lugar para la página de edición:</p>

			<pre><span class="line">Router.configure({</span><span class="line">  <span class="na">layoutTemplate</span>  : <span class="s1">"diseño"</span>,</span><span class="line">  <span class="na">waitOn</span>          : <span class="kd">function</span>(){ <span class="kd">return</span> Meteor.subscribe(<span class="s1">"publicaciones"</span>); },</span><span class="line">  <span class="na">loadingTemplate</span> : <span class="s1">"cargando"</span>,</span><span class="line">  <span class="na">notFoundTemplate</span>: <span class="s1">"noEncontrado"</span></span><span class="line">});</span>
<span class="line">Router.route(<span class="s1">"/"</span>,      {<span class="na">name</span>: <span class="s1">"publicacionesLista"</span>});</span><span class="line">Router.route(<span class="s1">"/nueva"</span>, {<span class="na">name</span>: <span class="s1">"publicacionesNueva"</span>});</span>
<span class="line">Router.route(<span class="s1">"/publicacion/<span class="ss">:_id</span><span class="s1">"</span>, {</span></span><span class="line">  <span class="na">name</span>: <span class="s1">"publicacionesPagina"</span>,</span><span class="line">  <span class="na">data</span>: <span class="kd">function</span>(){ <span class="kd">return</span> Publicaciones.findOne(<span class="kd">this</span>.params.<span class="ss">_id</span>); }</span><span class="line">});</span><span class="line added">Router.route(<span class="s1">"/publicacion/</span><span class="ss">:_id</span><span class="s1">/modificar"</span>, {</span><span class="line added">  <span class="na">name</span>: <span class="s1">"publicacionesModificar"</span>,</span><span class="line added">  <span class="na">data</span>: <span class="kd">function</span>(){ <span class="kd">return</span> Publicaciones.findOne(<span class="kd">this</span>.params.<span class="ss">_id</span>); }</span><span class="line added">});</span>
<span class="line"><span class="kd">var</span> necesarioSesion = <span class="kd">function</span>(){</span><span class="line">  <span class="kd">if</span>( <span class="kd">!</span> Meteor.user() ){</span><span class="line">    <span class="kd">if</span>( Meteor.loggingIn() ){</span><span class="line">      <span class="kd">this</span>.render(<span class="kd">this</span>.loadingTemplate);</span><span class="line">    } <span class="kd">else</span> {</span><span class="line">      <span class="kd">this</span>.render(<span class="s1">"accesoDenegado"</span>);</span><span class="line">    }</span><span class="line">  } <span class="kd">else</span> {</span><span class="line">    <span class="kd">this</span>.next();</span><span class="line">  }</span><span class="line">}</span>
<span class="line">Router.onBeforeAction(<span class="s1">"dataNotFound"</span>,  {<span class="na">only</span>: <span class="s1">"publicacionesPagina"</span>});</span><span class="line">Router.onBeforeAction(necesarioSesion, {<span class="na">only</span>: <span class="s1">"publicacionesNueva"</span>});</span></pre>
            <div class="caption">/lib/router.js</div>
            
            <h3 id="men-lpdedp">La plantilla de edición de publicaciones</h3>
            
            <p>Crea la plantilla <code>publicacionesModificar</code>:</p>
            
			<pre><span class="line"><span class="nt">&lt;template</span> <span class="na">name</span>=<span class="s1">"publicacionesModificar"</span><span class="nt">&gt;</span></span><span class="line">  <span class="nt">&lt;form</span> <span class="na">class</span>=<span class="s1">"main form pagina"</span><span class="nt">&gt;</span></span><span class="line">    <span class="nt">&lt;div</span> <span class="na">class</span>=<span class="s1">"form-group"</span><span class="nt">&gt;</span></span><span class="line">      <span class="nt">&lt;label</span> <span class="na">class</span>=<span class="s1">"control-label"</span> <span class="na">for</span>=<span class="s1">"url"</span><span class="nt">&gt;</span>URL<span class="nt">&lt;/label&gt;</span></span><span class="line">      <span class="nt">&lt;div</span> <span class="na">class</span>=<span class="s1">"controls"</span><span class="nt">&gt;</span></span><span class="line">        <span class="nt">&lt;input</span> <span class="na">name</span>=<span class="s1">"url"</span> <span class="na">id</span>=<span class="s1">"url"</span> <span class="na">type</span>=<span class="s1">"text"</span> <span class="na">value</span>=<span class="s1">"{{url}}"</span> <span class="na">placeholder</span>=<span class="s1">"Dirección web"</span> <span class="na">class</span>=<span class="s1">"form-control"</span><span class="nt">/&gt;</span></span><span class="line">      <span class="nt">&lt;/div&gt;</span></span><span class="line">    <span class="nt">&lt;/div&gt;</span></span><span class="line">    <span class="nt">&lt;div</span> <span class="na">class</span>=<span class="s1">"form-group"</span><span class="nt">&gt;</span></span><span class="line">      <span class="nt">&lt;label</span> <span class="na">class</span>=<span class="s1">"control-label"</span> <span class="na">for</span>=<span class="s1">"titulo"</span><span class="nt">&gt;</span>Título<span class="nt">&lt;/label&gt;</span></span><span class="line">      <span class="nt">&lt;div</span> <span class="na">class</span>=<span class="s1">"controls"</span><span class="nt">&gt;</span></span><span class="line">        <span class="nt">&lt;input</span> <span class="na">name</span>=<span class="s1">"titulo"</span> <span class="na">id</span>=<span class="s1">"titulo"</span> <span class="na">type</span>=<span class="s1">"text"</span> <span class="na">value</span>=<span class="s1">"{{titulo}}"</span> <span class="na">placeholder</span>=<span class="s1">"Título de su publicación"</span> <span class="na">class</span>=<span class="s1">"form-control"</span><span class="nt">/&gt;</span></span><span class="line">      <span class="nt">&lt;/div&gt;</span></span><span class="line">    <span class="nt">&lt;/div&gt;</span></span><span class="line">    <span class="nt">&lt;input</span> <span class="na">type</span>=<span class="s1">"submit"</span> <span class="na">value</span>=<span class="s1">"Modificar"</span> <span class="na">class</span>=<span class="s1">"btn btn-primary submit"</span><span class="nt">/&gt;</span></span><span class="line nt">    &lt;hr/&gt;</span><span class="line">    <span class="nt">&lt;a</span> <span class="na">class</span>=<span class="s1">"btn btn-danger eliminar"</span> <span class="na">href</span>=<span class="s1">"#"</span><span class="nt">&gt;</span>Eliminar publicación<span class="nt">&lt;/a&gt;</span></span><span class="line">  <span class="nt">&lt;/form&gt;</span></span><span class="line"><span class="nt">&lt;/template&gt;</span></span></pre>
			<div class="caption">/client/plantillas/publicaciones/publicaciones_modificar.html</div>
            
            <p>Y crea también el archivo <code>publicaciones_modificar.js</code>:</p>
            
			<pre><span class="line">Template.publicacionesModificar.events({</span><span class="line">  <span class="s1">"submit form"</span>: <span class="kd">function</span>(<span class="ss">e</span>){</span><span class="line">    <span class="ss">e</span>.preventDefault();</span>
<span class="line">    <span class="kd">var</span> publicacionModificada = {</span><span class="line">      <span class="na">_id</span>   : <span class="kd">this</span>._id,</span><span class="line">      <span class="na">titulo</span>: $(<span class="ss">e</span>.target).find(<span class="s1">"[name=titulo]"</span>).val(),</span><span class="line">      <span class="na">url</span>   : $(<span class="ss">e</span>.target).find(<span class="s1">"[name=url]"</span>).val()</span><span class="line">    };</span>
<span class="line">    Meteor.call(<span class="s1">"publicacionesModificar"</span>, publicacionModificada, <span class="kd">function</span>(<span class="ss">error</span>, <span class="ss">resultado</span>){</span><span class="line">      <span class="kd">if</span>( <span class="ss">error</span> ){</span><span class="line">        alert(<span class="s1">"Error: No se ha podido modificar la publicación: "</span>+ <span class="ss">error</span>.reason);</span>
<span class="line">      } <span class="kd">else if</span>( <span class="ss">resultado</span>.error == <span class="s1">"datosErroneos"</span> ){</span><span class="line">        <span class="kd">return</span> alert(<span class="s1">"Error: El tipo de datos es incorrecto."</span>);</span>
<span class="line">      } <span class="kd">else</span> {</span><span class="line">        Router.go(<span class="s1">"publicacionesPagina"</span>, {<span class="na">_id</span>: <span class="ss">resultado</span>._id});</span><span class="line">      }</span><span class="line">    });</span><span class="line">  },</span>
<span class="line">  <span class="s1">"click .eliminar"</span>: <span class="kd">function</span>(<span class="ss">e</span>){</span><span class="line">    <span class="ss">e</span>.preventDefault();</span>
<span class="line">    <span class="kd">if</span>( confirm(<span class="s1">"¿Eliminar esta publicación?"</span>) ){</span><span class="line">      Meteor.call(<span class="s1">"publicacionesEliminar"</span>, {<span class="na">_id</span>: <span class="kd">this</span>._id}, <span class="kd">function</span>(<span class="ss">error</span>, <span class="ss">resultado</span>){</span><span class="line">        <span class="kd">if</span>( <span class="ss">error</span> ){</span><span class="line">          alert(<span class="s1">"Error: No se ha podido eliminar la publicación: "</span>+ <span class="ss">error</span>.reason);</span><span class="line">        } <span class="kd">else</span> {</span><span class="line">          Router.go(<span class="s1">"publicacionesLista"</span>);</span><span class="line">        }</span><span class="line">      });</span><span class="line">    }</span><span class="line">  }</span><span class="line">});</span></pre>
			<div class="caption">/client/plantillas/publicaciones/publicaciones_modificar.js</div>
			
			<p>Y por último las acciones en el servidor:</p>
			
			<pre><span class="line">Publicaciones = <span class="kd">new</span> Mongo.Collection(<span class="s1">"publicaciones"</span>);</span>
<span class="line">Meteor.methods({</span><span class="line">  <span class="s1">"publicacionesInsertar"</span>: <span class="kd">function</span>(<span class="ss">nuevaPublicacion</span>){</span><span class="line c1">    // •••</span><span class="line added">  },</span>
<span class="line added">  <span class="s1">"publicacionesModificar"</span>: <span class="kd">function</span>(<span class="ss">publicacionModificada</span>){</span><span class="line added c1">    // Comprobar los datos</span><span class="line added">    <span class="kd">if</span>(  <span class="kd">typeof</span> <span class="ss">publicacionModificada</span>.url    <span class="kd">!=</span> <span class="s1">"string"</span></span><span class="line added">      <span class="kd">|| typeof</span> <span class="ss">publicacionModificada</span>.titulo <span class="kd">!=</span> <span class="s1">"string"</span></span><span class="line added">      <span class="kd">|| typeof</span> Meteor.userId()              <span class="kd">!=</span> <span class="s1">"string"</span> ){</span><span class="line added">      <span class="kd">return</span> {<span class="na">error</span>: <span class="s1">"datosErroneos"</span>};</span><span class="line added">    }</span>
<span class="line added c1">    // Añadir la fecha de actualización a la publicación</span><span class="line added">    <span class="kd">var</span> fechaPublicacion = Publicaciones.findOne({<span class="s1">"_id"</span>: <span class="ss">publicacionModificada</span>._id}).fecha;</span><span class="line added">    fechaPublicacion.actualizacion = <span class="kd">new</span> <span class="nb">Date</span>();</span>
<span class="line added">    <span class="ss">publicacionModificada</span>.fecha = fechaPublicacion;</span>
<span class="line added c1">    // Actualizar la publicación</span><span class="line added">    Publicaciones.update(<span class="ss">publicacionModificada</span>._id, {$<span class="na">set</span>: <span class="ss">publicacionModificada</span>});</span>
<span class="line added c1">    // Devolver el id de la publicación</span><span class="line added">    <span class="kd">return</span> {<span class="na">_id</span>: <span class="ss">publicacionModificada</span>._id};</span><span class="line added">  },</span>
<span class="line added">  <span class="s1">"publicacionesEliminar"</span>: <span class="kd">function</span>(<span class="ss">publicacionMoribunda</span>){</span><span class="line added c1">    // Simplemente elimina la publicación</span><span class="line added">    Publicaciones.remove({<span class="na">_id</span>: <span class="ss">publicacionMoribunda</span>._id});</span><span class="line added">  }</span><span class="line">});</span></pre>
            <div class="caption">/lib/colecciones/publicaciones.js</div>
			
			<p>El formulario ya está listo para usarse.</p>
			
			<h3 id="men-ae">Añadiendo enlaces</h3>
            
            <p>Añade los enlaces para que los usuarios puedan navegar al nuevo formulario:</p>
            
			<pre><span class="line"><span class="nt">&lt;template</span> <span class="na">name</span>=<span class="s1">"publicacionesObjeto"</span><span class="nt">&gt;</span></span><span class="line">  <span class="nt">&lt;div</span> <span class="na">class</span>=<span class="s1">"publicacion"</span><span class="nt">&gt;</span></span><span class="line">    <span class="nt">&lt;div</span> <span class="na">class</span>=<span class="s1">"publicacion-contenido"</span><span class="nt">&gt;</span></span><span class="line">      <span class="nt">&lt;h3&gt;&lt;a</span> <span class="na">href</span>=<span class="s1">"{{url}}"</span><span class="nt">&gt;</span>{{titulo}}<span class="nt">&lt;/a&gt;&lt;span&gt;</span>{{dominio}}<span class="nt">&lt;/span&gt;&lt;/h3&gt;</span></span><span class="line added nt">      &lt;p&gt;</span><span class="line added">        {{#if _usuario.autor}}{{_usuario.autor}}{{/if}}</span><span class="line added">        {{#if publicacionPropia}}<span class="nt">&lt;a</span> <span class="na">href</span>=<span class="s1">"{{pathFor 'publicacionesModificar'}}"</span><span class="nt">&gt;</span>Modificar<span class="nt">&lt;/a&gt;</span>{{/if}}</span><span class="line added nt">      &lt;/p&gt;</span><span class="line nt">    &lt;/div&gt;</span><span class="line">    <span class="nt">&lt;a</span> <span class="na">href</span>=<span class="s1">"{{pathFor 'publicacionesPagina'}}"</span> <span class="na">class</span>=<span class="s1">"debatir btn btn-default"</span><span class="nt">&gt;</span>Debatir<span class="nt">&lt;/a&gt;</span></span><span class="line nt">  &lt;/div&gt;</span><span class="line nt">&lt;/template&gt;</span></pre>
            <div class="caption">/client/plantillas/publicaciones/publicaciones_objeto.html</div>
            
            <p>Añadimos la lógica para comprobar si es el autor de la publicación<code>publicacionPropia</code>:</p>
            
			<pre><span class="line">Template.publicacionesObjeto.helpers({</span><span class="line">  <span class="s1">"dominio"</span>: <span class="kd">function</span>(){</span><span class="line">    <span class="kd">var</span> a  = document.createElement(<span class="s1">"a"</span>);</span><span class="line">    a.href = <span class="kd">this</span>.url;</span><span class="line">    <span class="kd">return</span> (a.hostname.substr(<span class="nb">0</span>,<span class="nb">4</span>) == <span class="s1">"www."</span>)</span><span class="line">      <span class="kd">?</span> a.hostname.substr(<span class="nb">4</span>)</span><span class="line">      <span class="kd">:</span> a.hostname</span><span class="line">    ;</span><span class="line added">  },</span>
<span class="line added">  <span class="s1">"publicacionPropia"</span>: <span class="kd">function</span>(){</span><span class="line added">    <span class="kd">return this</span>._usuario._id === Meteor.userId();</span><span class="line added">  }</span><span class="line">});</span></pre>
            <div class="caption">/client/plantillas/publicaciones/publicaciones_objeto.js</div>
            
			<h3 id="men-clp">Configurando los permisos</h3>
			
			<p>Todos los usuarios incluidos los <em>no registrados</em> pueden ver el formulario si navegan a la dirección <code>http://localhost:3000/publicacion/•••/modificar</code></p>
            
            <figure class="screenshot "><img src="./Editando posts_files/8-1.png" alt="Formulario de edición."><figcaption>Formulario de edición.</figcaption></figure>
            
            <p>Ocultaremos el formulario como la otra vez exceptuando que solo podrá entrar el usuario con que tenga permiso:</p>
			
			<p style="font-size:0.9em;">NOTA: <em>Si aún no lo has hecho crea un segundo usuario y crea un mensaje con cada usuario. En mi caso los 2 usuarios se llamarán: <code>Pruebas 1</code> y <code>Pruebas 2</code></em></p>
			
            <figure class="screenshot "><img src="./Editando posts_files/8-2.png" alt="Publicaciones de diferentes usuarios."><figcaption>Publicaciones de diferentes usuarios.</figcaption></figure>
			
			<p>Primero ocultaremos el formulario mediante la plantilla <code>accesoDenegado</code> para que solo los usuarios registrados puedan acceder al formulario.</p>
            
			<pre><span class="line c1">// •••</span>
<span class="line"><span class="kd">var</span> necesarioSesion = <span class="kd">function</span>(){</span><span class="line">  <span class="kd">if</span>( <span class="kd">!</span> Meteor.user() ){</span><span class="line">    <span class="kd">if</span>( Meteor.loggingIn() ){</span><span class="line">      <span class="kd">this</span>.render(<span class="kd">this</span>.loadingTemplate);</span><span class="line">    } <span class="kd">else</span> {</span><span class="line">      <span class="kd">this</span>.render(<span class="s1">"accesoDenegado"</span>);</span><span class="line">    }</span><span class="line">  } <span class="kd">else</span> {</span><span class="line">    <span class="kd">this</span>.next();</span><span class="line">  }</span><span class="line">}</span>
<span class="line">Router.onBeforeAction(<span class="s1">"dataNotFound"</span>,  {<span class="na">only</span>: <span class="s1">"publicacionesPagina"</span>});</span><span class="line added">Router.onBeforeAction(necesarioSesion, {<span class="na">only</span>: [<span class="s1">"publicacionesNueva"</span>, <span class="s1">"publicacionesModificar"</span>]});</span></pre>
            <div class="caption">/lib/router.js</div>
			
			<p>Pasamos un array al atributo <code class="na">only</code> para indicar a que plantillas se debe ejecutar <code>necesarioSesion</code>.</p>
			
			<p>Si vas a una publicación sin estar registrado deberías ver algo como esto:</p>
            
			<figure class="screenshot"><img src="./Editando posts_files/8-3.png" alt="Modificar la publicación sin usuario."><figcaption>Modificar la publicación sin usuario.</figcaption></figure>
			
			<p style="font-size:0.9em;">NOTA: <em>Puedes navegar rápidamente si pulsas al botón <code>Debatir</code> de una publicación y luego en la dirección web añade <code>/modificar</code>.</em></p>
			
			<p>Si inicias sesión con cualquier usuario te mostrará el formulario.</p>
			
			<p>Le diremos al Router nos muestre la plantilla <code>accesoDenegadoUsuario</code> cuando un usuario intente modificar la publicación de otro usuario.</p>
			
			<pre><span class="line c1">// •••</span><span class="line">Router.route(<span class="s1">"/publicacion/</span><span class="ss">:_id</span><span class="s1">/modificar"</span>, {</span><span class="line">  <span class="na">name</span>: <span class="s1">"publicacionesModificar"</span>,</span><span class="line added">  <span class="na">data</span>: <span class="kd">function</span>(){ <span class="kd">return</span> Publicaciones.findOne(<span class="kd">this</span>.params.<span class="ss">_id</span>); }<span class="added">,</span></span><span class="line added">  <span class="na">onBeforeAction</span>: <span class="kd">function</span>(){</span><span class="line added">    <span class="kd">if</span>( <span class="kd">!</span> Meteor.user() ){</span><span class="line added">      <span class="kd">if</span>( Meteor.loggingIn() ){</span><span class="line added">        <span class="kd">this</span>.render(<span class="kd">this</span>.loadingTemplate);</span><span class="line added">      } <span class="kd">else</span> {</span><span class="line added">        <span class="kd">this</span>.render(<span class="s1">"accesoDenegado"</span>);</span><span class="line added">      }</span><span class="line added">    } <span class="kd">else</span> {</span><span class="line added">      if( Publicaciones.findOne(<span class="kd">this</span>.params._id)._usuario._id <span class="kd">!==</span> Meteor.userId() ){</span><span class="line added">        <span class="kd">this</span>.render(<span class="s1">"accesoDenegadoUsuario"</span>);</span><span class="line added">      } <span class="kd">else</span> {</span><span class="line added">        <span class="kd">this</span>.next();</span><span class="line added">      }</span><span class="line added">    }</span><span class="line added">  }</span><span class="line">});</span>
<span class="line"><span class="kd">var</span> necesarioSesion = <span class="kd">function</span>(){</span><span class="line">  <span class="kd">if</span>( <span class="kd">!</span> Meteor.user() ){</span><span class="line">    <span class="kd">if</span>( Meteor.loggingIn() ){</span><span class="line">      <span class="kd">this</span>.render(<span class="kd">this</span>.loadingTemplate);</span><span class="line">    } <span class="kd">else</span> {</span><span class="line">      <span class="kd">this</span>.render(<span class="s1">"accesoDenegado"</span>);</span><span class="line">    }</span><span class="line">  } <span class="kd">else</span> {</span><span class="line">    <span class="kd">this</span>.next();</span><span class="line">  }</span><span class="line">}</span>
<span class="line">Router.onBeforeAction(<span class="s1">"dataNotFound"</span>,  {<span class="na">only</span>: <span class="s1">"mensajesPagina"</span>});</span><span class="line">Router.onBeforeAction(necesarioSesion, {<span class="na">only</span>: [<span class="s1">"mensajesNuevo"</span>, <span class="s1">"mensajesModificar"</span>]});</span></pre>
            <div class="caption">/lib/router.js</div>
			
			<p>Por último solo queda crear la plantilla <code>accesoDenegadoUsuario</code>:</p>
			
			<pre><span class="line"><span class="nt">&lt;template</span> <span class="na">name</span>=<span class="s1">"accesoDenegadoUsuario"</span><span class="nt">&gt;</span></span><span class="line">  <span class="nt">&lt;div</span> <span class="na">class</span>=<span class="s1">"access-denied pagina jumbotron"</span><span class="nt">&gt;</span></span><span class="line">    <span class="nt">&lt;h2&gt;</span>Acceso Denegado<span class="nt">&lt;/h2&gt;</span></span><span class="line nt">    &lt;p&gt;</span><span class="line">      Solo el autor de la publicación puede ver esta página.</span><span class="line nt">    &lt;/p&gt;</span><span class="line">    <span class="nt">&lt;p</span> <span class="na">class</span>=<span class="s1">"solo-autor"</span><span class="nt">&gt;</span></span><span class="line">      Autor de la publicación: <span class="nt">&lt;span</span> <span class="na">class</span>=<span class="s1">"negrita"</span><span class="nt">&gt;</span>{{_usuario.autor}}<span class="nt">&lt;/span&gt;</span>.</span><span class="line nt">    &lt;/p&gt;</span><span class="line nt">  &lt;/div&gt;</span><span class="line nt">&lt;/template&gt;</span></pre>
			<div class="caption">/client/plantillas/extras/acceso_denegado_usuario.html</div>
			
			<p>Como <code>_usuario.autor</code> no es un ayudante Meteor busca en el lugar más lógico, el contexto de datos que en este caso es el autor de la publicación a la que intentamos acceder.</p>
			
			<p>Ya deberías poder ver:</p>
			
			<p>Si el usuario no ha iniciado la sesión: <code>accesoDenegado</code>.</p>
			
			<figure class="screenshot "><img src="./Editando posts_files/8-3.png" alt="Acceso denegado (1/3)."><figcaption>Acceso denegado (1/3).</figcaption></figure>
			
			<p>Si el usuario no es el autor: <code>accesoDenegadoUsuario</code>.</p>
			
			<figure class="screenshot "><img src="./Editando posts_files/8-4.png" alt="Acceso denegado mediente usuario (2/3)."><figcaption>Acceso denegado mediente usuario (2/3).</figcaption></figure>
			
			<p>Si el usuario es el autor: <code>publicacionesModificar</code>.</p>
			
			<figure class="screenshot "><img src="./Editando posts_files/8-5.png" alt="Autor de la publicación (3/3)."><figcaption>Autor de la publicación (3/3).</figcaption></figure>
			
			<h3 id="men-eed">Evitar enlaces duplicados</h3>
            
			<p>Te habrás dado cuenta que evitamos la duplicidad al crear las publicaciones pero no al modificarlas por lo que un usuario puede crear una publicación y luego cambiar la URL para que coincida con otra publicación.</p>
			
			<p>Para evitar lo, primero añadiremos la excepción en <code>publicaciones.js</code>.</p>
			
			<pre><span class=" c1">// •••</span><span class="line">  <span class="s1">"publicacionesModificar"</span>: <span class="kd">function</span>(<span class="ss">publicacionModificada</span>){</span><span class="line c1">    // Comprobar los datos</span><span class="line">    <span class="kd">if</span>(  <span class="kd">typeof</span> <span class="ss">publicacionModificada</span>.url    <span class="kd">!=</span> <span class="s1">"string"</span></span><span class="line">      <span class="kd">|| typeof</span> <span class="ss">publicacionModificada</span>.titulo <span class="kd">!=</span> <span class="s1">"string"</span></span><span class="line">      <span class="kd">|| typeof</span> Meteor.userId()              <span class="kd">!=</span> <span class="s1">"string"</span> ){</span><span class="line">      <span class="kd">return</span> {<span class="na">error</span>: <span class="s1">"datosErroneos"</span>};</span>
<span class="line added c1">    // Comprobar si existe la dirección web</span><span class="line added c1">      // Si existe solo puede modificar la publicación si contiene el mismo _id</span><span class="line added">    } <span class="kd">else if</span>( Publicaciones.findOne({<span class="na">url</span>: <span class="ss">publicacionModificada</span>.url})</span><span class="line added">        <span class="kd">&&</span> Publicaciones.findOne({<span class="na">url</span>: <span class="ss">publicacionModificada</span>.url})._id <span class="kd">!=</span> <span class="ss">publicacionModificada</span>._id ){</span><span class="line added">      <span class="kd">return</span> {</span><span class="line added">        <span class="na">error</span>: <span class="s1">"publicacionExistente"</span>,</span><span class="line added">        <span class="na">_id</span>  : <span class="ss">publicacionModificada</span>._id</span><span class="line added">      }</span><span class="line">    }</span>
<span class="line c1">    // Añadir la fecha de actualización a la publicación</span><span class="line">    <span class="kd">var</span> fechaPublicacion = Publicaciones.findOne({<span class="s1">"_id"</span>: <span class="ss">publicacionModificada</span>._id}).fecha;</span><span class="line">    fechaPublicacion.actualizacion = <span class="kd">new</span> <span class="nb">Date</span>();</span>
<span class="line">    <span class="ss">publicacionModificada</span>.fecha = fechaPublicacion;</span>
<span class="line c1">    // Actualizar la publicación</span><span class="line">    Publicaciones.update(<span class="ss">publicacionModificada</span>._id, {$<span class="na">set</span>: <span class="ss">publicacionModificada</span>});</span>
<span class="line c1">    // Devolver el id de la publicación</span><span class="line">    <span class="kd">return</span> {<span class="na">_id</span>: <span class="ss">publicacionModificada</span>._id};</span><span class="line">  },</span>
<span class="line">  <span class="s1">"publicacionesEliminar"</span>: <span class="kd">function</span>(<span class="ss">publicacionMoribunda</span>){</span><span class="line c1">    // Simplemente elimina la publicación</span><span class="line">    Publicaciones.remove({<span class="na">_id</span>: <span class="ss">publicacionMoribunda</span>._id});</span><span class="line">  }</span><span class="line">});</span></pre>
			<div class="caption">/lib/colecciones/publicaciones.js</div>
			
			<p>Si encuentra una <code>URL</code> coincidente comprobará si se trata de otra publicación con un <code>_id</code> diferente. Si encuentra una <code>URL</code> con el mismo <code>_id</code> quiere decir que está modificando la misma publicación sin cambiar la dirección web.</p>
			
			<p>Por último solo queda añadir el mensaje de error si intenta poner una <code>url</code> de otra publicación.</p>
			
			<pre><span class="line">Template.publicacionesModificar.events({</span><span class="line">  <span class="s1">"submit form"</span>: <span class="kd">function</span>(<span class="ss">e</span>){</span><span class="line">    <span class="ss">e</span>.preventDefault();</span>
<span class="line">    <span class="kd">var</span> publicacionModificada = {</span><span class="line">      <span class="na">_id</span>   : <span class="kd">this</span>._id,</span><span class="line">      <span class="na">titulo</span>: $(<span class="ss">e</span>.target).find(<span class="s1">"[name=titulo]"</span>).val(),</span><span class="line">      <span class="na">url</span>   : $(<span class="ss">e</span>.target).find(<span class="s1">"[name=url]"</span>).val()</span><span class="line">    };</span>
<span class="line">    Meteor.call(<span class="s1">"publicacionesModificar"</span>, publicacionModificada, <span class="kd">function</span>(<span class="ss">error</span>, <span class="ss">resultado</span>){</span><span class="line">      if( <span class="ss">error</span> ){</span><span class="line">        alert(<span class="s1">"Error: No se ha podido modificar la publicación: "</span>+ <span class="ss">error</span>.reason);</span>
<span class="line">      } <span class="kd">else if</span>( <span class="ss">resultado</span>.error == <span class="s1">"datosErroneos"</span> ){</span><span class="line">        <span class="kd">return</span> alert(<span class="s1">"Error: El tipo de datos es incorrecto."</span>);</span>
<span class="line added">      } <span class="kd">else if</span>( <span class="kd">resultado</span>.error == <span class="s1">"publicacionExistente"</span> ){</span><span class="line added">        alert(<span class="s1">"Error: Ya existe una publicación con esta dirección web."</span>);</span>
<span class="line">      } <span class="kd">else</span> {</span><span class="line">        Router.go(<span class="s1">"publicacionesPagina"</span>, {<span class="na">_id</span>: <span class="ss">resultado</span>._id});</span><span class="line">      }</span><span class="line">    });</span><span class="line">  },</span><span class="line c1">  // •••</span><span class="line">});</span></pre>
			<div class="caption">/client/plantillas/publicaciones/publicaciones_modificar.js</div>
			
          </div>
          <div class="bottom-nav">
            <div class="post-nav">
              <a class="prev" href="http://es.discovermeteor.com/chapters/latency-compensation/" title="Previous Post: Compensación de la latencia">
                «
                Compensación de la latencia
              </a>
              <a class="next" href="http://es.discovermeteor.com/chapters/allow-and-deny/" title="next Post: Permitir y Denegar">
                Permitir y Denegar
                »
              </a>
            </div>
          </div>
        </div>
        <div class="comments sidebar">
          <a class="sidebar-toggle" data-disqus-identifier="editing-posts_es" href="http://es.discovermeteor.com/chapters/editing-posts/#disqus_thread">0 Comments</a>
          <div class="sidebar-inner">
            <div class="issues">
              <a class="issue-link simple-button" href="https://github.com/DiscoverMeteor/Microscope/issues" target="_blank">Reporta un problema con el código</a>
              <a class="issue-link simple-button" href="https://github.com/DiscoverMeteor/DiscoverMeteor_es/issues" target="_blank">Reporta un problema con el libro</a>
              <hr>
              <p>O, comenta el contenido aquí:</p>
            </div>
            <div id="disqus_thread"><iframe id="dsq-app8541" name="dsq-app8541" allowtransparency="true" frameborder="0" scrolling="no" tabindex="0" title="Disqus" width="100%" src="./Editando posts_files/saved_resource.html" style="width: 1px !important; min-width: 100% !important; border: none !important; overflow: hidden !important; height: 468px !important;" horizontalscrolling="no" verticalscrolling="no"></iframe></div>
            <script type="text/javascript">
                /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
                var disqus_shortname = 'discovermeteores'; // required: replace example with your forum shortname
                var disqus_identifier = 'editing-posts_es';
            
                /* * * DON'T EDIT BELOW THIS LINE * * */
                (function() {
                    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                    dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
                    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
                })();
            
                /* * * DON'T EDIT BELOW THIS LINE * * */
                (function () {
                var s = document.createElement('script'); s.async = true;
                s.type = 'text/javascript';
                s.src = 'http://' + disqus_shortname + '.disqus.com/count.js';
                (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
                }());
            
            </script>
          </div>
        </div>
      </div>
    </div>
    <footer>
      <div class="row">
        © 2014 <a href="http://tom.thesnail.org/">Tom Coleman</a> y <a href="http://sachagreif.com/">Sacha Greif</a>
      </div>
    </footer>
    <!-- %script{:src => "https://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.5.2/underscore-min.js"} -->
    <script src="./Editando posts_files/moment.min.js.descarga"></script>
    <script src="./Editando posts_files/es.js.descarga"></script>
    <script src="./Editando posts_files/script.js.descarga"></script>
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
      
      ga('create', 'UA-38246482-5', 'discovermeteor.com');
      ga('send', 'pageview');
    </script>
    <input id="lang" type="hidden" value="es">
  

<iframe style="display: none;" src="./Editando posts_files/saved_resource(1).html"></iframe></body></html>