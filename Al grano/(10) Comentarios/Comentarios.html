<!DOCTYPE html>
<!-- saved from url=(0047)http://es.discovermeteor.com/chapters/comments/ -->
<html class="no-js wf-klavikaweb-n3-active wf-klavikaweb-n6-active wf-sourcesanspro-n4-active wf-sourcesanspro-n7-active wf-sourcesanspro-i7-active wf-sourcesanspro-i4-active wf-sourcesanspro-n3-active wf-sourcesanspro-i3-active wf-sourcecodepro-n7-active wf-sourcecodepro-n4-active wf-active" lang="es"><!-- <![endif] --><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    
    <!-- Set the viewport width to device width for mobile -->
    <meta content="width=device-width, initial-scale=1.0" name="viewport">
    <title>Comentarios - Descubriendo Meteor</title>
    <!-- Included CSS Files -->
    <link href="./Comentarios_files/screen.css" rel="stylesheet">
    <link href="./Comentarios_files/print.css" media="print" rel="stylesheet">
    <!-- %link{:href => "http://fonts.googleapis.com/css?family=Source+Sans+Pro:200,400,700,400italic", :rel => "stylesheet"} -->
    <!-- %link{:href => "http://fonts.googleapis.com/css?family=Source+Code+Pro:400,700", :rel => "stylesheet"} -->
    <link href="http://es.discovermeteor.com/images/favicon.ico" rel="shortcut icon">
    <script async="" src="./Comentarios_files/analytics.js.descarga"></script><script src="./Comentarios_files/jquery.min.js.descarga"></script><style type="text/css">
:root .adsbox
{ display: none !important; }</style>
    <script src="./Comentarios_files/rcr2ohz.js.descarga"></script>
    <style type="text/css">.tk-klavika-web{font-family:"klavika-web",sans-serif;}.tk-source-sans-pro{font-family:"source-sans-pro",sans-serif;}.tk-source-code-pro{font-family:"source-code-pro",sans-serif;}</style><style type="text/css">@font-face{font-family:klavika-web;src:url(https://use.typekit.net/af/5401fe/00000000000000003b9acdf2/27/l?subset_id=2&fvd=n3&v=3) format("woff2"),url(https://use.typekit.net/af/5401fe/00000000000000003b9acdf2/27/d?subset_id=2&fvd=n3&v=3) format("woff"),url(https://use.typekit.net/af/5401fe/00000000000000003b9acdf2/27/a?subset_id=2&fvd=n3&v=3) format("opentype");font-weight:300;font-style:normal;}@font-face{font-family:klavika-web;src:url(https://use.typekit.net/af/835e90/00000000000000003b9acdf6/27/l?subset_id=2&fvd=n6&v=3) format("woff2"),url(https://use.typekit.net/af/835e90/00000000000000003b9acdf6/27/d?subset_id=2&fvd=n6&v=3) format("woff"),url(https://use.typekit.net/af/835e90/00000000000000003b9acdf6/27/a?subset_id=2&fvd=n6&v=3) format("opentype");font-weight:600;font-style:normal;}@font-face{font-family:source-sans-pro;src:url(https://use.typekit.net/af/b0088d/00000000000000003b9acb59/27/l?subset_id=2&fvd=n4&v=3) format("woff2"),url(https://use.typekit.net/af/b0088d/00000000000000003b9acb59/27/d?subset_id=2&fvd=n4&v=3) format("woff"),url(https://use.typekit.net/af/b0088d/00000000000000003b9acb59/27/a?subset_id=2&fvd=n4&v=3) format("opentype");font-weight:400;font-style:normal;}@font-face{font-family:source-sans-pro;src:url(https://use.typekit.net/af/c55ca5/00000000000000003b9acb5c/27/l?subset_id=2&fvd=n7&v=3) format("woff2"),url(https://use.typekit.net/af/c55ca5/00000000000000003b9acb5c/27/d?subset_id=2&fvd=n7&v=3) format("woff"),url(https://use.typekit.net/af/c55ca5/00000000000000003b9acb5c/27/a?subset_id=2&fvd=n7&v=3) format("opentype");font-weight:700;font-style:normal;}@font-face{font-family:source-sans-pro;src:url(https://use.typekit.net/af/7e0c18/00000000000000003b9acb5d/27/l?subset_id=2&fvd=i7&v=3) format("woff2"),url(https://use.typekit.net/af/7e0c18/00000000000000003b9acb5d/27/d?subset_id=2&fvd=i7&v=3) format("woff"),url(https://use.typekit.net/af/7e0c18/00000000000000003b9acb5d/27/a?subset_id=2&fvd=i7&v=3) format("opentype");font-weight:700;font-style:italic;}@font-face{font-family:source-sans-pro;src:url(https://use.typekit.net/af/c42064/00000000000000003b9acb58/27/l?subset_id=2&fvd=i4&v=3) format("woff2"),url(https://use.typekit.net/af/c42064/00000000000000003b9acb58/27/d?subset_id=2&fvd=i4&v=3) format("woff"),url(https://use.typekit.net/af/c42064/00000000000000003b9acb58/27/a?subset_id=2&fvd=i4&v=3) format("opentype");font-weight:400;font-style:italic;}@font-face{font-family:source-sans-pro;src:url(https://use.typekit.net/af/b35fa2/00000000000000003b9acb56/27/l?subset_id=2&fvd=n3&v=3) format("woff2"),url(https://use.typekit.net/af/b35fa2/00000000000000003b9acb56/27/d?subset_id=2&fvd=n3&v=3) format("woff"),url(https://use.typekit.net/af/b35fa2/00000000000000003b9acb56/27/a?subset_id=2&fvd=n3&v=3) format("opentype");font-weight:300;font-style:normal;}@font-face{font-family:source-sans-pro;src:url(https://use.typekit.net/af/a6c785/00000000000000003b9acb57/27/l?subset_id=2&fvd=i3&v=3) format("woff2"),url(https://use.typekit.net/af/a6c785/00000000000000003b9acb57/27/d?subset_id=2&fvd=i3&v=3) format("woff"),url(https://use.typekit.net/af/a6c785/00000000000000003b9acb57/27/a?subset_id=2&fvd=i3&v=3) format("opentype");font-weight:300;font-style:italic;}@font-face{font-family:source-code-pro;src:url(https://use.typekit.net/af/b8b49b/0000000000000000000179d5/27/l?subset_id=2&fvd=n7&v=3) format("woff2"),url(https://use.typekit.net/af/b8b49b/0000000000000000000179d5/27/d?subset_id=2&fvd=n7&v=3) format("woff"),url(https://use.typekit.net/af/b8b49b/0000000000000000000179d5/27/a?subset_id=2&fvd=n7&v=3) format("opentype");font-weight:700;font-style:normal;}@font-face{font-family:source-code-pro;src:url(https://use.typekit.net/af/953e9e/0000000000000000000179cf/27/l?subset_id=2&fvd=n4&v=3) format("woff2"),url(https://use.typekit.net/af/953e9e/0000000000000000000179cf/27/d?subset_id=2&fvd=n4&v=3) format("woff"),url(https://use.typekit.net/af/953e9e/0000000000000000000179cf/27/a?subset_id=2&fvd=n4&v=3) format("opentype");font-weight:400;font-style:normal;}</style><script>
      try{Typekit.load();}catch(e){}
    </script>
  <script type="text/javascript" async="" src="./Comentarios_files/embed.js.descarga"></script><script async="" type="text/javascript" src="./Comentarios_files/count.js.descarga"></script><style type="text/css">
:root *[pwcj4gk][hidden] { display: none !important; }</style><script src="./Comentarios_files/count-data.js.descarga"></script><link rel="preload" as="style" href="https://c.disquscdn.com/next/embed/styles/lounge.2d848eddee1b8c12749b72a04b2b33dc.css"><link rel="preload" as="script" href="https://c.disquscdn.com/next/embed/common.bundle.845ead53749f15d0bd8a5ee344c8f06e.js"><link rel="preload" as="script" href="https://c.disquscdn.com/next/embed/lounge.bundle.8241ae5fc761eb94635acdc63f5fd29f.js"><link rel="preload" as="script" href="https://disqus.com/next/config.js"><script src="./Comentarios_files/alfie.f51946af45e0b561c60f768335c9eb79.js.descarga" async="" charset="UTF-8"></script></head>
  <body style="zoom: 1;" cz-shortcut-listen="true">
    <header>
      <h1>
        <a href="http://es.discovermeteor.com/">
          <span>Descubriendo</span>
          <strong>Meteor</strong>
        </a>
      </h1>
    </header>
    <div class="main">
      <div class="row">
        <div class="toc sidebar">
          <a class="sidebar-toggle" href="javascript:void(0)">Toggle Table of Contents</a>
          <div class="sidebar-inner">
            <ul>
              <li>
                <span class="number">
                  1
                </span>
                <a href="http://es.discovermeteor.com/chapters/introduction/">
                  Introducción
                </a>
              </li>
              <li>
                <span class="number">
                  2
                </span>
                <a href="http://es.discovermeteor.com/chapters/getting-started/">
                  Empezando
                </a>
              </li>
              <li class="sidebar-chapter">
                <span class="number">
                  2.5
                </span>
                <a href="http://es.discovermeteor.com/chapters/deploying/">
                  Despliegue
                </a>
              </li>
              <li>
                <span class="number">
                  3
                </span>
                <a href="http://es.discovermeteor.com/chapters/templates/">
                  Plantillas
                </a>
              </li>
              <li class="sidebar-chapter">
                <span class="number">
                  3.5
                </span>
                <a href="http://es.discovermeteor.com/chapters/github/">
                  Usando Git y GitHub
                </a>
              </li>
              <li>
                <span class="number">
                  4
                </span>
                <a href="http://es.discovermeteor.com/chapters/collections/">
                  Colecciones
                </a>
              </li>
              <li class="sidebar-chapter">
                <span class="number">
                  4.5
                </span>
                <a href="http://es.discovermeteor.com/chapters/publications-and-subscriptions/">
                  Publicaciones y suscripciones
                </a>
              </li>
              <li>
                <span class="number">
                  5
                </span>
                <a href="http://es.discovermeteor.com/chapters/routing/">
                  Enrutando
                </a>
              </li>
              <li class="sidebar-chapter">
                <span class="number">
                  5.5
                </span>
                <a href="http://es.discovermeteor.com/chapters/the-session/">
                  La sesión
                </a>
              </li>
              <li>
                <span class="number">
                  6
                </span>
                <a href="http://es.discovermeteor.com/chapters/adding-users/">
                  Añadiendo usuarios
                </a>
              </li>
              <li class="sidebar-chapter">
                <span class="number">
                  6.5
                </span>
                <a href="http://es.discovermeteor.com/chapters/reactivity/">
                  Reactividad
                </a>
              </li>
              <li>
                <span class="number">
                  7
                </span>
                <a href="http://es.discovermeteor.com/chapters/creating-posts/">
                  Creando posts
                </a>
              </li>
              <li class="sidebar-chapter">
                <span class="number">
                  7.5
                </span>
                <a href="http://es.discovermeteor.com/chapters/latency-compensation/">
                  Compensación de la latencia
                </a>
              </li>
              <li>
                <span class="number">
                  8
                </span>
                <a href="http://es.discovermeteor.com/chapters/editing-posts/">
                  Editando posts
                </a>
              </li>
              <li class="sidebar-chapter">
                <span class="number">
                  8.5
                </span>
                <a href="http://es.discovermeteor.com/chapters/allow-and-deny/">
                  Permitir y Denegar
                </a>
              </li>
              <li>
                <span class="number">
                  9
                </span>
                <a href="http://es.discovermeteor.com/chapters/errors/">
                  Errores
                </a>
              </li>
              <li class="sidebar-chapter">
                <span class="number">
                  9.5
                </span>
                <a href="http://es.discovermeteor.com/chapters/creating-a-meteor-package/">
                  Creando un paquete Meteor
                </a>
              </li>
              <li class="active">
                <span class="number">
                  10
                </span>
                <a href="http://es.discovermeteor.com/chapters/comments/">
                  Comentarios
                </a>
              </li>
              <li class="sidebar-chapter">
                <span class="number">
                  10.5
                </span>
                <a href="http://es.discovermeteor.com/chapters/denormalization/">
                  Denormalización
                </a>
              </li>
              <li>
                <span class="number">
                  11
                </span>
                <a href="http://es.discovermeteor.com/chapters/notifications/">
                  Notificaciones
                </a>
              </li>
              <li class="sidebar-chapter">
                <span class="number">
                  11.5
                </span>
                <a href="http://es.discovermeteor.com/chapters/advanced-reactivity/">
                  Reactividad avanzada
                </a>
              </li>
              <li>
                <span class="number">
                  12
                </span>
                <a href="http://es.discovermeteor.com/chapters/pagination/">
                  Paginación
                </a>
              </li>
              <li>
                <span class="number">
                  13
                </span>
                <a href="http://es.discovermeteor.com/chapters/voting/">
                  Votos
                </a>
              </li>
              <li class="sidebar-chapter">
                <span class="number">
                  13.5
                </span>
                <a href="http://es.discovermeteor.com/chapters/advanced-publications/">
                  Publicaciones avanzadas
                </a>
              </li>
              <li>
                <span class="number">
                  14
                </span>
                <a href="http://es.discovermeteor.com/chapters/animations/">
                  Animaciones
                </a>
              </li>
              <li>
                <span class="number">
                  14.5
                </span>
                <a href="http://es.discovermeteor.com/chapters/going-further/">
                  Ir más lejos
                </a>
              </li>
              <li>
                <span class="number">
                  14.5
                </span>
                <a href="http://es.discovermeteor.com/chapters/meteor-vocabulary/">
                  Vocabulario
                </a>
              </li>
              <li>
                <span class="number">
                  99
                </span>
                <a href="http://es.discovermeteor.com/chapters/changelog/">
                  Changelog
                </a>
              </li>
            </ul>
          </div>
        </div>
        <div class="vocabulary sidebar">
          <a class="sidebar-toggle" href="http://es.discovermeteor.com/chapters/comments/#">Toggle Vocabulary</a>
          <div class="sidebar-inner">
            <div class="sidebar-content">
              <h3>Vocabulary</h3>
              <h4>Cliente</h4>
              
              <p style="display: none;">Cuando hablamos del Cliente, nos referimos al código que se ejecuta en el navegador de los usuarios, ya sea uno tradicional, como Firefox o Safari, o algo tan complejo como un UIWebView en una aplicación nativa para el iPhone.</p>
              
              <h4>Colección</h4>
              
              <p style="display: none;">Una colección es el almacén de datos que se sincroniza automáticamente entre el cliente y el servidor. Las colecciones tienen un nombre (como <code>posts</code>), y por lo general existen tanto en el cliente como en el servidor. Si bien se comportan de forma distinta, tienen una API común basada en la API de Mongo.</p>
              
              <h4>Computación</h4>
              
              <p style="display: none;">Una computación es un bloque de código que se ejecuta cada vez que cambia una de las fuentes de datos reactivos de las que depende. Si tienes una fuente reactiva (por ejemplo, una variable de sesión) y quieres responder reactivamente a ella, tendrás que crear una computación.</p>
              
              <h4>Cursor</h4>
              
              <p style="display: none;">Un cursor es el resultado de ejecutar una consulta en una colección Mongo. En el lado del cliente, un cursor no es tan sólo un conjunto de resultados, sino que es un objeto <em>reactivo</em> desde el que se puede observar (con <code>observe()</code>) los cambios (añadir, eliminar o actualizar) en la colección correspondiente.</p>
              
              <h4>DDP</h4>
              
              <p style="display: none;">El DDP es el Protocolo de Datos Distribuidos que utiliza Meteor para sincronizar colecciones y efectuar llamadas a métodos. DDP pretende ser un protocolo genérico, que toma el relevo a HTTP para aplicaciones en tiempo real con gran carga de datos.</p>
              
              <h4>Deps</h4>
              
              <p style="display: none;">Deps es el sistema reactivo de Meteor. Deps se utiliza entre bastidores para sincronizar automáticamente el  HTML con el modelo de datos subyacente.</p>
              
              <h4>Documento</h4>
              
              <p style="display: none;">Mongo es un almacén de datos basado en documentos y a los objetos que salen de las colecciones se les llama “documentos”. Son objetos JavaScript sin formato (aunque no pueden contener funciones) con una única propiedad especial, el ’_id’, que Meteor utiliza para realizar un seguimiento de sus propiedades en el DDP.</p>
              
              <h4>Ayudantes</h4>
              
              <p style="display: none;">Cuando una plantilla necesita mostrar cosas más complejas que una simple propiedad de un documento, ésta puede hacer uso de su ayudante, una función que se utiliza para procesar los datos que se muestran en ella.</p>
              
              <h4>Compensación de la latencia</h4>
              
              <p style="display: none;">Es una técnica que permite simular llamadas a métodos en el cliente para evitar retrasos mientras se espera la respuesta del servidor.</p>
              
              <h4>Meteor Development Group (MDG)</h4>
              
              <p style="display: none;">La empresa que desarrolla Meteor.</p>
              
              <h4>Método</h4>
              
              <p style="display: none;">Un método en Meteor es una llamada desde el cliente, a un procedimiento remoto en el servidor, con un poco de lógica añadida que permite realizar un seguimiento de los cambios en los datos además de compensar la latencia de la llamada.</p>
              
              <h4>MiniMongo</h4>
              
              <p style="display: none;">La colección del lado del cliente es un almacén de datos en memoria que ofrece una API tipo Mongo. La librería que se utiliza se llama “MiniMongo”, para indicar que es una versión más pequeña de Mongo que se ejecuta por completo en la memoria del navegador.</p>
              
              <h4>Paquete</h4>
              
              <p style="display: none;">Un paquete Meteor puede ser: código JavaScript que se ejecuta en el servidor, código JavaScript que se ejecuta en el cliente, instrucciones para procesar recursos (como SASS a CSS), o recursos que deben ser  procesados​​. <br> Un paquete es como una librería con superpoderes. Meteor incluye una gran cantidad de paquetes (<code>meteor list</code>). También existe <a href="http://atmosphere.meteor.com/">Atmosphere</a>, que es una colección de paquetes de terceros mantenida por la comunidad (<code>mrt add ...</code>).</p>
              
              <h4>Publicación</h4>
              
              <p style="display: none;">Una publicación es un conjunto de datos con nombre que se personaliza para cada usuario que se suscribe a ella. Se configuran en el servidor.</p>
              
              <h4>Servidor</h4>
              
              <p style="display: none;">El servidor Meteor es un servidor HTTP y DDP ejecutados vía Node.js. Se compone de todas las librerías y del código JavaScript del lado del servidor. Cuando se inicia el servidor, se conecta a una base de datos Mongo (que configura por si mismo en el primer arranque).</p>
              
              <h4>Sesión</h4>
              
              <p style="display: none;">La sesión en Meteor es una fuente de datos reactiva que usa tu aplicación para hacer un seguimiento del estado del usuario.</p>
              
              <h4>Suscripción</h4>
              
              <p style="display: none;">Una suscripción es una conexión a una publicación desde un cliente específico. La suscripción es el código que ejecuta el navegador y que utiliza para comunicarse con una publicación del servidor y que, además, mantiene los datos sincronizados.</p>
              
              <h4>Plantilla</h4>
              
              <p style="display: none;">Una plantilla es una forma de generar código HTML desde JavaScript. Por defecto, Meteor sólo soporta el sistema Spacebars, pero hay planes para incluir más.</p>
              
              <h4>Contexto de datos de una plantilla</h4>
              
              <p style="display: none;">Cuando se muestra un plantilla, lo que se representa es un objeto JavaScript que proporciona datos específicos para esta representación en particular. Por lo general, este tipo de objetos son, de tipo POJO (plain-old-JavaScript-objects), a menudo son documentos de una colección, aunque pueden ser más complejos e incluir funciones.</p>
            </div>
          </div>
        </div>
        <div class="post">
          <div class="top-nav">
            <div class="post-nav">
              <a class="prev" href="http://es.discovermeteor.com/chapters/creating-a-meteor-package/" title="Previous Post: Creando un paquete Meteor">
                «
                Creando un paquete Meteor
              </a>
              <a class="next" href="http://es.discovermeteor.com/chapters/denormalization/" title="next Post: Denormalización">
                Denormalización
                »
              </a>
            </div>
          </div>
          <div class="post-content">
            <div class="chapter-heading">
              <h2 class="chapter-title">Comentarios</h2>
              <span class="chapter-number">10</span>
            </div>
            <input id="paragraphs" type="hidden" value="34">
            <div class="chapter-summary note chapter">
				<style>
					*{transition:ease all 0.1s;}
					.arriba{position:fixed;bottom:0px;left:0px;margin:2px;padding:2px 7px;background-color:rgba(64, 64, 64, 0.2);border-radius:50%;box-shadow:0px 0px 5px rgba(0, 0, 0, 0.4);}
				</style>
				<a href="#men" class="arriba">▲</a>
				
				<h3 id="men">En este capítulo:</h3>
				<ul>
					<li><a href="#men-mlce">Mostraremos los comentarios existentes.</a></li>
					<li><a href="#men-ec">Enviando comentarios.</a></li>
					<li><a href="#men-clsalc">Controlando la suscripción a los comentarios.</a></li>
				</ul>
            </div>
            <p>En este capítulo añadiremos los comentarios.</p>
			
			<p>Empezaremos creando una nueva colección para almacenar los comentarios.</p>
			
			<pre><span class="line">Comentarios = <span class="kd">new</span> Mongo.Collection(<span class="s1">"comentarios"</span>);</span></pre>
            <div class="caption">/lib/colecciones/comentarios.js</div>
            
			<p>Al igual que las publicaciones crearemos reglas cuando la base de datos no contenga publicaciones pero un tanto diferente <code>extras.js</code>:</p>
			
			<pre><span class="line"><span class="kd">if</span>( Publicaciones.find().count() <span class="kd">===</span> <span class="nb">0</span> ){</span><span class="line added c1">  // Fecha actual</span><span class="line added">  <span class="kd">var</span> fechaActual = <span class="kd">new</span> <span class="nb">Date</span>().getTime();</span>
<span class="line added c1">  // Crear 2 usuarios</span><span class="line added kd">  var</span><span class="line added">    usuario1_id = Accounts.createUser({</span><span class="line added">      <span class="s1">"username"</span>: <span class="s1">"Usuario 1"</span>,</span><span class="line added">      <span class="s1">"password"</span>: <span class="s1">"usuario1"</span></span><span class="line added">    }),</span><span class="line added">    usuario2_id = Accounts.createUser({</span><span class="line added">      <span class="s1">"username"</span>: <span class="s1">"Usuario 2"</span>,</span><span class="line added">      <span class="s1">"password"</span>: <span class="s1">"usuario2"</span></span><span class="line added">    })</span><span class="line added">  ;</span>
<span class="line added c1">  // Obtener los usuarios creados</span><span class="line added kd">  var</span><span class="line added">    usuario1 = Accounts.findUserByUsername(<span class="s1">"Usuario 1"</span>),</span><span class="line added">    usuario2 = Accounts.findUserByUsername(<span class="s1">"Usuario 2"</span>)</span><span class="line added">  ;</span>
<span class="line added c1">  // Crear las publicaciones</span><span class="line">  <span class="kd">var</span> publicacionesDatos = [</span><span class="line">    {</span><span class="line">      <span class="s1">"titulo"</span>: <span class="s1">"Introducción a Telescópio"</span>,</span><span class="line added">      <span class="s1">"url"</span>   : <span class="s1">"http://www.sachagreif.com/introducing-telescope"</span>,</span><span class="line added">      <span class="s1">"_usuario"</span>: {</span><span class="line added">        <span class="s1">"_id"</span>  : usuario1_id,</span><span class="line added">        <span class="s1">"autor"</span>: usuario1.username</span><span class="line added">      },</span><span class="line added">      <span class="s1">"fecha"</span>: {</span><span class="line added">        <span class="s1">"insercion"</span>    : <span class="kd">new</span> <span class="nb">Date</span>(fechaActual - <span class="nb">5</span> * <span class="nb">3600</span> * <span class="nb">1000</span>),</span><span class="line added">        <span class="s1">"actualizacion"</span>: <span class="kd">new</span> <span class="nb">Date</span>(fechaActual - <span class="nb">5</span> * <span class="nb">3600</span> * <span class="nb">1000</span>)</span><span class="line added">      }</span><span class="line">    },{</span><span class="line">      <span class="s1">"titulo"</span>: <span class="s1">"Meteor"</span>,</span><span class="line added">      <span class="s1">"url"</span>   : <span class="s1">"http://www.meteor.com"</span>,</span><span class="line added">      <span class="s1">"_usuario"</span>: {</span><span class="line added">        <span class="s1">"_id"</span>  : usuario2_id,</span><span class="line added">        <span class="s1">"autor"</span>: usuario2.username</span><span class="line added">      },</span><span class="line added">      <span class="s1">"fecha"</span>: {</span><span class="line added">        <span class="s1">"insercion"</span>    : <span class="kd">new</span> <span class="nb">Date</span>(fechaActual - <span class="nb">4</span> * <span class="nb">3600</span> * <span class="nb">1000</span>),</span><span class="line added">        <span class="s1">"actualizacion"</span>: <span class="kd">new</span> <span class="nb">Date</span>(fechaActual - <span class="nb">4</span> * <span class="nb">3600</span> * <span class="nb">1000</span>)</span><span class="line added">      }</span><span class="line">    },{</span><span class="line">      <span class="s1">"titulo"</span>: <span class="s1">"El Libro de Meteor"</span>,</span><span class="line added">      <span class="s1">"url"</span>   : <span class="s1">"http://www.themeteorbook.com"</span>,</span><span class="line added">      <span class="s1">"_usuario"</span>: {</span><span class="line added">        <span class="s1">"_id"</span>  : usuario2_id,</span><span class="line added">        <span class="s1">"autor"</span>: usuario2.username</span><span class="line added">      },</span><span class="line added">      <span class="s1">"fecha"</span>: {</span><span class="line added">        <span class="s1">"insercion"</span>    : <span class="kd">new</span> <span class="nb">Date</span>(fechaActual - <span class="nb">2</span> * <span class="nb">3600</span> * <span class="nb">1000</span>),</span><span class="line added">        <span class="s1">"actualizacion"</span>: <span class="kd">new</span> <span class="nb">Date</span>(fechaActual - <span class="nb">2</span> * <span class="nb">3600</span> * <span class="nb">1000</span>)</span><span class="line added">      }</span><span class="line">    },{</span><span class="line">      <span class="s1">"titulo"</span>: <span class="s1">"Documentos Meteor"</span>,</span><span class="line added">      <span class="s1">"url"</span>   : <span class="s1">"http://www.docs.discovermeteor.com"</span>,</span><span class="line added">      <span class="s1">"_usuario"</span>: {</span><span class="line added">        <span class="s1">"_id"</span>  : usuario1_id,</span><span class="line added">        <span class="s1">"autor"</span>: usuario1.username</span><span class="line added">      },</span><span class="line added">      <span class="s1">"fecha"</span>: {</span><span class="line added">        <span class="s1">"insercion"</span>    : <span class="kd">new</span> <span class="nb">Date</span>(fechaActual - <span class="nb">1</span> * <span class="nb">3600</span> * <span class="nb">1000</span>),</span><span class="line added">        <span class="s1">"actualizacion"</span>: <span class="kd">new</span> <span class="nb">Date</span>(fechaActual - <span class="nb">1</span> * <span class="nb">3600</span> * <span class="nb">1000</span>)</span><span class="line added">      }</span><span class="line">    }</span><span class="line">  ];</span>
<span class="line added c1">  // Inserción de las publicaciones y se obtiene su _id</span><span class="line">  <span class="kd">for</span>( <span class="kd">var</span> <span class="ss">i</span> <span class="kd">in</span> publicacionesDatos ){</span><span class="line added">    publicacionesDatos[<span class="ss">i</span>]._id = Publicaciones.insert(publicacionesDatos[<span class="ss">i</span>]);</span><span class="line">  }</span>
<span class="line added c1">  // Crear los comentarios</span><span class="line added">  <span class="kd">var</span> comentariosDatos = [</span><span class="line added">    {</span><span class="line added">      <span class="s1">"comentario"</span>: <span class="s1">"Interesante proyecto Usuario 1, ¿Puedo involucrarme?"</span>,</span><span class="line added">      <span class="s1">"fecha"</span>: {</span><span class="line added">        <span class="s1">"insercion"</span>    : <span class="kd">new</span> <span class="nb">Date</span>(fechaActual - <span class="nb">4</span> * <span class="nb">3600</span> * <span class="nb">1000</span>),</span><span class="line added">        <span class="s1">"actualizacion"</span>: <span class="kd">new</span> <span class="nb">Date</span>(fechaActual - <span class="nb">4</span> * <span class="nb">3600</span> * <span class="nb">1000</span>)</span><span class="line added">      },</span><span class="line added">      <span class="s1">"_publicacion"</span>: {<span class="s1">"_id"</span>: publicacionesDatos[<span class="nb">0</span>]._id},</span><span class="line added">      <span class="s1">"_usuario"</span>: {</span><span class="line added">        <span class="s1">"_id"</span>  : usuario2_id,</span><span class="line added">        <span class="s1">"autor"</span>: usuario2.username</span><span class="line added">      }</span><span class="line added">    },{</span><span class="line added">      <span class="s1">"comentario"</span>: <span class="s1">"¡Por supuesto que puedes!"</span>,</span><span class="line added">      <span class="s1">"fecha"</span>: {</span><span class="line added">        <span class="s1">"insercion"</span>    : <span class="kd">new</span> <span class="nb">Date</span>(fechaActual - <span class="nb">2</span> * <span class="nb">3600</span> * <span class="nb">1000</span>),</span><span class="line added">        <span class="s1">"actualizacion"</span>: <span class="kd">new</span> <span class="nb">Date</span>(fechaActual - <span class="nb">2</span> * <span class="nb">3600</span> * <span class="nb">1000</span>)</span><span class="line added">      },</span><span class="line added">      <span class="s1">"_publicacion"</span>: {<span class="s1">"_id"</span>: publicacionesDatos[<span class="nb">0</span>]._id},</span><span class="line added">      <span class="s1">"_usuario"</span>: {</span><span class="line added">        <span class="s1">"_id"</span>  : usuario1_id,</span><span class="line added">        <span class="s1">"autor"</span>: usuario1.username</span><span class="line added">      }</span><span class="line added">    }</span><span class="line added">  ];</span>
<span class="line added c1">  // Inserción de los comentarios</span><span class="line added">  <span class="kd">for</span>( <span class="kd">var</span> <span class="ss">i</span> <span class="kd">in</span> comentariosDatos ){</span><span class="line added">    Comentarios.insert(comentariosDatos[<span class="ss">i</span>]);</span><span class="line added">  }</span><span class="line">}</span></pre>
            <div class="caption">/server/extras.js</div>
            
            <p>No olvidemos que debemos publicar y suscribir la nueva colección:</p>
            
			<pre><span class="line">Meteor.publish(<span class="s1">"publicaciones"</span>, <span class="kd">function</span>(){</span><span class="line">  <span class="kd">return</span> Publicaciones.find();</span><span class="line">});</span>
<span class="line added">Meteor.publish(<span class="s1">"comentarios"</span>, <span class="kd">function</span>(){</span><span class="line added">  <span class="kd">return</span> Comentarios.find();</span><span class="line added">});</span></pre>
			<div class="caption">/server/publications.js</div>
            <pre><span class="line">Router.configure({</span><span class="line">  <span class="na">layoutTemplate</span>  : <span class="s1">"diseño"</span>,</span><span class="line added">  <span class="na">waitOn</span>: <span class="kd">function</span>(){</span><span class="line added">    <span class="kd">return</span> [Meteor.subscribe(<span class="s1">"publicaciones"</span>), Meteor.subscribe(<span class="s1">"comentarios"</span>)];</span><span class="line added">  },</span><span class="line">  <span class="na">loadingTemplate</span> : <span class="s1">"cargando"</span>,</span><span class="line">  <span class="na">notFoundTemplate</span>: <span class="s1">"noEncontrado"</span></span><span class="line">});</span>
<span class="line c1">// •••</span></pre>
            <div class="lines-highlight" data-lines="5,6,7" data-class="added"></div>
            <div class="caption">/lib/router.js</div>
            
            <p>Bien, apagemos y reiniciemos nuestra aplicación para reiniciar la base de datos mediante <code><span class="kd">meteor</span> reset</code>.</p>
			
            <p>Hemos creado <span class="kd">2 usuarios</span> de prueba, <span class="kd">4 publicaciónes</span> que hemos añadido los campos que faltaban en las anteriores publicaciones y a una publicación le hemos añadido <span class="kd">2 comentarios</span> con los usuarios que hemos creado.</p>
            
            <p>Además, hemos publicado los comentarios.</p>
            
            <h3 id="men-mlce">Mostraremos los comentarios existentes</h3>
            
            <p>Como es lógico, mostraremos los comentarios en la página de la publicación:</p>
			
			<pre><span class="line"><span class="nt">&lt;template</span> <span class="na">name</span>=<span class="s1">"publicacionesPagina"</span><span class="nt">&gt;</span></span><span class="line">  <span class="nt">&lt;div</span> <span class="na">class</span>=<span class="s1">"publicaciones-pagina pagina"</span><span class="nt">&gt;</span></span><span class="line">    {{&gt; publicacionesObjeto}}</span><span class="line added">    <span class="nt">&lt;ul</span> <span class="na">class</span>=<span class="s1">"comentarios"</span><span class="nt">&gt;</span></span><span class="line added">      {{#each comentarios}}</span><span class="line added">        {{&gt; comentariosObjeto}}</span><span class="line added">      {{/each}}</span><span class="line added nt">    &lt;/ul&gt;</span><span class="line nt">  &lt;/div&gt;</span><span class="line nt">&lt;/template&gt;</span></pre>
            <div class="caption">/client/plantillas/publicaciones/publicaciones_pagina.html</div>
            
			<pre><span class="line">Template.publicacionesPagina.helpers({</span><span class="line">  <span class="na">comentarios</span>: <span class="kd">function</span>(){</span><span class="line">    <span class="kd">return</span> Comentarios.find({<span class="s1">"_publicacion._id"</span>: <span class="kd">this</span>._id});</span><span class="line">  }</span><span class="line">});</span></pre>
            <div class="caption">/client/plantillas/publicaciones/publicaciones_pagina.js</div>
            
            <p>Como vamos a crear la plantilla para solo un comentario crearemos un lugar para los comentarios dentro de <code>/plantillas</code>.</p>
            
			<pre><span class="line"><span class="nt">&lt;template</span> <span class="na">name</span>=<span class="s1">"comentariosObjeto"</span><span class="nt">&gt;</span></span><span class="line nt">  &lt;li&gt;</span><span class="line nt">    &lt;p&gt;</span><span class="line">      {{comentarioFormateado}}</span><span class="line nt">    &lt;/p&gt;</span><span class="line nt">    &lt;h4&gt;</span><span class="line">      <span class="nt">&lt;span</span> <span class="na">class</span>=<span class="s1">"autor"</span><span class="nt">&gt;</span>{{_usuario.autor}}<span class="nt">&lt;/span&gt;</span></span><span class="line">      <span class="nt">&lt;span</span> <span class="na">class</span>=<span class="s1">"fecha"</span><span class="nt">&gt;</span>{{fechaInsercion}}<span class="nt">&lt;/span&gt;</span></span><span class="line nt">    &lt;/h4&gt;</span><span class="line nt">  &lt;/li&gt;</span><span class="line nt">&lt;/template&gt;</span></pre>
            <div class="caption">/client/plantillas/comentarios/comentarios_objeto.html</div>
            
            <p>Vamos a crear un ayudante de plantilla para dar a nuestra fecha <code>fechaInsercion</code> un formato más amigable:</p>
            
			<pre><span class="line"> <span class="kd">var</span> meses = [<span class="s1">"Enero"</span>, <span class="s1">"Febrero"</span>, <span class="s1">"Marzo"</span>, <span class="s1">"Abril"</span>, <span class="s1">"Mayo"</span>, <span class="s1">"Junio"</span>, <span class="s1">"Julio"</span>, <span class="s1">"Agosto"</span>, <span class="s1">"Septiembre"</span>, <span class="s1">"Octubre"</span>, <span class="s1">"Noviembre"</span>, <span class="s1">"Diciembre"</span>];</span>
<span class="line">Template.comentariosObjeto.helpers({</span><span class="line">  <span class="s1">"fechaInsercion"</span>: <span class="kd">function</span>(){</span><span class="line">    <span class="kd">var</span> fecha = this.fecha.insercion;</span>
<span class="line">    <span class="kd">return</span>   fecha.getDay()</span><span class="line">      +<span class="s1">" "</span>+  meses[fecha.getMonth()]</span><span class="line">      +<span class="s1">" "</span>+  fecha.getFullYear()</span><span class="line">      +<span class="s1">" ("</span>+ fecha.getHours() +<span class="s1">":"</span>+ (</span><span class="line">        (fecha.getMinutes() < <span class="nb">10</span>)</span><span class="line">          <span class="kd">?</span><span class="s1">"0"</span>+fecha.getMinutes()</span><span class="line">          :<span class="s1">""</span>+fecha.getMinutes()</span><span class="line">      ) +<span class="s1">"h)"</span></span><span class="line">    ;</span><span class="line">  },</span><span class="line">  <span class="s1">"comentarioFormateado"</span>: <span class="kd">function</span>(){</span><span class="line c1">    // Comvertimos en array</span><span class="line">    <span class="kd">var</span> comentarioLineas = <span class="kd">this</span>.comentario.split(<span class="s1">"\n"</span>);</span><span class="line">    <span class="kd">var</span> comentario = comentarioLineas[<span class="nb">0</span>];</span>
<span class="line c1">    // Concatenamos para cambiar \n por &lt;br/&gt;</span><span class="line">    <span class="kd">for</span>( <span class="kd">var</span> <span class="ss">i</span>=<span class="nb">1</span> <span class="kd">;</span> <span class="ss">i</span>&lt;comentarioLineas.length <span class="kd">;</span> <span class="ss">i</span>++ ){</span><span class="line">      comentario += <span class="s1">"&lt;br/&gt;"</span>+ comentarioLineas[<span class="ss">i</span>];</span><span class="line">    }</span>
<span class="line">    <span class="kd">return</span> Spacebars.SafeString(comentario);</span><span class="line">  }</span><span class="line">});</span></pre>
            <div class="caption">/client/plantillas/comentarios/comentarios_objeto.js</div>
            
			<p>Mostraremos la cantidad de comentarios que contiene la publicación:</p>
            
			<pre><span class="line"><span class="nt">&lt;template</span> <span class="na">name</span>=<span class="s1">"publicacionesObjeto"</span><span class="nt">&gt;</span></span><span class="line">  <span class="nt">&lt;div</span> <span class="na">class</span>=<span class="s1">"publicacion"</span><span class="nt">&gt;</span></span><span class="line">    <span class="nt">&lt;div</span> <span class="na">class</span>=<span class="s1">"publicacion-contenido"</span><span class="nt">&gt;</span></span><span class="line">      <span class="nt">&lt;h3&gt;&lt;a</span> <span class="na">href</span>=<span class="s1">"{{url}}"</span><span class="nt">&gt;</span>{{titulo}}<span class="nt">&lt;/a&gt;&lt;span&gt;</span>{{dominio}}<span class="nt">&lt;/span&gt;&lt;/h3&gt;</span></span><span class="line nt">      &lt;p&gt;</span><span class="line">        {{#if autor}}{{autor}}{{/if}}</span><span class="line added">        <span class="nt">&lt;a</span> <span class="na">href</span>=<span class="s1">"{{pathFor 'publicacionesPagina'}}"</span><span class="nt">&gt;</span>{{comentariosContador}}<span class="nt">&lt;/a&gt;</span></span><span class="line">        {{#if publicacionPropia}}<span class="nt">&lt;a</span> <span class="na">href</span>=<span class="s1">"{{pathFor 'publicacionesModificar'}}"</span><span class="nt">&gt;</span>Modificar<span class="nt">&lt;/a&gt;</span>{{/if}}</span><span class="line nt">      &lt;/p&gt;</span><span class="line nt">    &lt;/div&gt;</span><span class="line">    <span class="nt">&lt;a</span> <span class="na">href</span>=<span class="s1">"{{pathFor 'publicacionesPagina'}}"</span> <span class="na">class</span>=<span class="s1">"debatir btn btn-default"</span><span class="nt">&gt;</span>Debatir<span class="nt">&lt;/a&gt;</span></span><span class="line nt">  &lt;/div&gt;</span><span class="line nt">&lt;/template&gt;</span></pre>
            <div class="caption">/client/plantillas/publicaciones/publicaciones_objeto.html</div>
            
            <p>Y añadimos el ayudante <code>comentariosContador</code> a <code>publicaciones_objeto.js</code>:</p>
            
			<pre><span class="line">Template.publicacionesObjeto.helpers({</span><span class="line">  <span class="s1">"dominio"</span>: <span class="kd">function</span>(){</span><span class="line">    <span class="kd">var</span> a = document.createElement(<span class="s1">"a"</span>);</span><span class="line">    a.href = <span class="kd">this</span>.url;</span><span class="line">    <span class="kd">return</span> (a.hostname.substr(<span class="nb">0</span>, <span class="nb">4</span>) == <span class="s1">"www."</span>)</span><span class="line">      <span class="kd">?</span> a.hostname.substr(<span class="nb">4</span>)</span><span class="line">      <span class="kd">:</span> a.hostname</span><span class="line">    ;</span><span class="line">  },</span>
<span class="line">  <span class="s1">"publicacionPropia"</span>: <span class="kd">function</span>(){</span><span class="line">    <span class="kd">return this</span>._usuario._id <span class="kd">===</span> Meteor.userId();</span><span class="line added">  },</span>
<span class="line added">  <span class="s1">"comentariosContador"</span>: <span class="kd">function</span>(){</span><span class="line added">    <span class="kd">var</span> numComentarios = Comentarios.find({<span class="s1">"_publicacion._id"</span>: <span class="kd">this</span>._id}).count();</span><span class="line added">    <span class="kd">return</span> ( numComentarios ) +<span class="s1">" "</span>+ ( (numComentarios <span class="kd">==</span> 1) <span class="kd">?</span><span class="s1">"comentario"</span> <span class="kd">:</span><span class="s1">"comentarios"</span> );</span><span class="line added">  }</span><span class="line">});</span></pre>
            <div class="caption">/client/plantillas/publicaciones/publicaciones_objeto.js</div>
			
            <p>Ahora deberíamos ser capaces de mostrar nuestros comentarios de prueba y ver algo como esto:</p>
            
            <figure class="screenshot "><img src="./Comentarios_files/10-1.png" alt="Displaying comments"><figcaption>Displaying comments</figcaption></figure>
            
            <h3 id="men-ec">Enviando comentarios</h3>
            
            <p>Vamos a añadir una forma de que los usuarios puedan hacer nuevos comentarios. El proceso será bastante similar a como ya hemos hecho para permitir a los usuarios crear nuevas publicaciones.</p>
            
            <p>Empezaremos añadiendo un área de envío en la parte inferior de cada publicación:</p>
            
			<pre><span class="line"><span class="nt">&lt;template</span> <span class="na">name</span>=<span class="s1">"publicacionesPagina"</span><span class="nt">&gt;</span></span><span class="line">  <span class="nt">&lt;div</span> <span class="na">class</span>=<span class="s1">"publicaciones-pagina pagina"</span><span class="nt">&gt;</span></span><span class="line">    {{&gt; publicacionesObjeto}}</span><span class="line">    <span class="nt">&lt;ul</span> <span class="na">class</span>=<span class="s1">"comentarios"</span><span class="nt">&gt;</span></span><span class="line">      {{#each comentarios}}</span><span class="line">        {{&gt; comentariosObjeto}}</span><span class="line">      {{/each}}</span><span class="line nt">    &lt;/ul&gt;</span><span class="line added">    {{#if currentUser}}</span><span class="line added">      {{&gt; comentariosNuevo}}</span><span class="line added">    {{else}}</span><span class="line added">      <span class="nt">&lt;p&gt;</span>Si quieres comentar esta publicación necesitas <span class="nt">&lt;span</span> <span class="na">class</span>=<span class="s1">"negrita"</span><span class="nt">&gt;</span>iniciar sesión<span class="nt">&lt;/span&gt;</span>.<span class="nt">&lt;/p&gt;</span></span><span class="line added">    {{/if}}</span><span class="line nt">  &lt;/div&gt;</span><span class="line nt">&lt;/template&gt;</span></pre>
            <div class="caption">/client/plantillas/publicaciones/publicaciones_pagina.html</div>
            
            <p>Y a continuación, crear la plantilla del formulario para los comentarios:</p>
            
			<pre><span class="line"><span class="nt">&lt;template</span> <span class="na">name</span>=<span class="s1">"comentariosNuevo"</span><span class="nt">&gt;</span></span><span class="line">  <span class="nt">&lt;form</span> <span class="na">name</span>=<span class="s1">"comentario"</span> <span class="na">class</span>=<span class="s1">"comentario-form form"</span><span class="nt">&gt;</span></span><span class="line">    <span class="nt">&lt;div</span> <span class="na">class</span>=<span class="s1">"form-group {{errorClase 'comentario'}}"</span><span class="nt">&gt;</span></span><span class="line">      <span class="nt">&lt;div</span> <span class="na">class</span>=<span class="s1">"controls"</span><span class="nt">&gt;</span></span><span class="line">        <span class="nt">&lt;label</span> <span class="na">for</span>=<span class="s1">"comentario"</span><span class="nt">&gt;</span>Comenta la publicación<span class="nt">&lt;/label&gt;</span></span><span class="line">        <span class="nt">&lt;textarea</span> <span class="na">name</span>=<span class="s1">"comentario"</span> <span class="na">id</span>=<span class="s1">"comentario"</span> <span class="na">class</span>=<span class="s1">"form-control"</span> <span class="na">rows</span>=<span class="s1">"3"</span> <span class="na">placeholder</span>=<span class="s1">"¿Qué piensas sobre esta publicación?"</span><span class="nt">&gt;&lt;/textarea&gt;</span></span><span class="line">        <span class="nt">&lt;span</span> <span class="na">class</span>=<span class="s1">"help-block"</span><span class="nt">&gt;</span>{{errorMensaje 'comentario'}}<span class="nt">&lt;/span&gt;</span></span><span class="line nt">      &lt;/div&gt;</span><span class="line nt">    &lt;/div&gt;</span><span class="line">    <span class="nt">&lt;button</span> <span class="na">type</span>=<span class="s1">"submit"</span> <span class="na">class</span>=<span class="s1">"btn btn-primary"</span><span class="nt">&gt;</span>Comentar<span class="nt">&lt;/button&gt;</span></span><span class="line nt">  &lt;/form&gt;</span><span class="line nt">&lt;/template&gt;</span></pre>
            <div class="caption">/client/plantillas/comentarios/comentarios_nuevo.html</div>
            
            <p>Añadiremos la parte lógica: Session, eventos, errores, comprovaciones y llamada a Meteor.call para insertar el comentario.</p>
            
			<pre><span class="line">Template.comentariosNuevo.onCreated(<span class="kd">function</span>(){</span><span class="line">  Session.set(<span class="s1">"comentariosNuevo_errores"</span>, {});</span><span class="line">});</span>
<span class="line">Template.comentariosNuevo.helpers({</span><span class="line">  <span class="s1">"errorMensaje"</span>: <span class="kd">function</span>(<span class="ss">campo</span>){</span><span class="line">    <span class="kd">return</span> Session.get(<span class="s1">"comentariosNuevo_errores"</span>)[<span class="ss">campo</span>];</span><span class="line">  },</span><span class="line">  <span class="s1">"errorClase"</span>: <span class="kd">function</span>(<span class="ss">campo</span>){</span><span class="line">    <span class="kd">return !!</span> Session.get(<span class="s1">"comentariosNuevo_errores"</span>)[<span class="ss">campo</span>] <span class="kd">?</span><span class="s1">"has-error"</span> <span class="kd">:</span><span class="s1">""</span>;</span><span class="line">  }</span><span class="line">});</span>
<span class="line">Template.comentariosNuevo.events({</span><span class="line">  <span class="s1">"submit form"</span>: <span class="kd">function</span>(<span class="ss">e</span>, <span class="ss">plantilla</span>){</span><span class="line">    <span class="ss">e</span>.preventDefault();</span>
<span class="line">    <span class="kd">var</span> comentario = $(<span class="ss">e</span>.target).find(<span class="s1">"textarea[name=comentario]"</span>);</span><span class="line">    <span class="kd">var</span> comentarioForm = {</span><span class="line">      <span class="s1">"comentario"</span>  : comentario.val(),</span><span class="line">      <span class="s1">"_publicacion"</span>: {<span class="s1">"_id"</span>: <span class="ss">plantilla</span>.data._id}</span><span class="line">    }</span>
<span class="line">    <span class="kd">if</span>( <span class="kd">!</span> comentarioForm.comentario ){</span><span class="line">      <span class="kd">return</span> Session.set(<span class="s1">"comentariosNuevo_errores"</span>, {<span class="s1">"comentario"</span>: <span class="s1">"▲ Por favor escribe tu comentario."</span>});</span><span class="line">    } <span class="kd">else</span> {</span><span class="line">      Session.set(<span class="s1">"comentariosNuevo_errores"</span>, {});</span><span class="line">    }</span>
<span class="line">    Meteor.call(<span class="s1">"comentariosInsertar"</span>, comentarioForm, <span class="kd">function</span>(<span class="ss">error</span>, <span class="ss">resultado</span>){</span><span class="line">      <span class="kd">if</span>( <span class="ss">error</span> ){</span><span class="line">        <span class="kd">return</span> mostrarError(<span class="s1">"No se ha podido comentar la publicación: "</span>+ <span class="ss">error</span>.reason);</span>
<span class="line">      } <span class="kd">else if</span>( <span class="ss">resultado</span>.error == <span class="s1">"datosErroneos"</span> ){</span><span class="line">        <span class="kd">return</span> mostrarError(<span class="s1">"Error: Algún dato del formulario es incorrecto."</span>);</span><span class="line">      } <span class="kd">else</span> {</span><span class="line">        comentario.val(<span class="s1">""</span>);</span><span class="line">      }</span><span class="line">    });</span><span class="line">  }</span><span class="line">});</span></pre>
            <div class="caption">/client/plantillas/comentarios/comentarios_nuevo.js</div>
            
            <p>Al igual que anteriormente estableceremos un metodo en el servidor para inserciones de comentarios.</p>
            
			<pre><span class="line">Comentarios = <span class="kd">new</span> Mongo.Collection(<span class="s1">"comentarios"</span>);</span>
<span class="line added">Meteor.methods({</span><span class="line added">  <span class="s1">"comentariosInsertar"</span>: <span class="kd">function</span>(<span class="ss">comentarioNuevo</span>){</span><span class="line added c1">    // Datos</span><span class="line added">    <span class="kd">if</span>(  <span class="kd">typeof</span> <span class="ss">comentarioNuevo</span>[<span class="s1">"comentario"</span>]    <span class="kd">!=</span> <span class="s1">"string"</span></span><span class="line added">      <span class="kd">|| typeof</span> <span class="ss">comentarioNuevo</span>._publicacion._id <span class="kd">!=</span> <span class="s1">"string"</span></span><span class="line added">      <span class="kd">|| typeof</span> Meteor.userId()                  <span class="kd">!=</span> <span class="s1">"string"</span></span><span class="line added">      <span class="kd">|| !</span> <span class="ss">comentarioNuevo</span>[<span class="s1">"comentario"</span>]</span><span class="line added">      <span class="kd">|| !</span> <span class="ss">comentarioNuevo</span>._publicacion._id</span><span class="line added">    ){</span><span class="line added">      <span class="kd">return</span> {<span class="s1">"error"</span>: <span class="s1">"datosErroneos"</span>}</span><span class="line added">    }</span>
<span class="line added c1">    // Publicación</span><span class="line added">    <span class="kd">if</span>( <span class="kd">!</span> Publicaciones.findOne({<span class="s1">"_id"</span>: <span class="ss">comentarioNuevo</span>._publicacion._id}) ){</span><span class="line added">      <span class="kd">throw</span> console.error(<span class="s1">"Al comentario le falta el id de la publicación."</span>);</span><span class="line added">    }</span>
<span class="line added c1">    // Usuario</span><span class="line added">    <span class="kd">var</span> usuarioActual = Meteor.user();</span><span class="line added">    <span class="ss">comentarioNuevo</span>._usuario = {</span><span class="line added">      <span class="s1">"_id"</span>  : usuarioActual._id,</span><span class="line added">      <span class="s1">"autor"</span>: usuarioActual.username</span><span class="line added">    };</span>
<span class="line added c1">    // Fecha</span><span class="line added">    <span class="ss">comentarioNuevo</span>.fecha = {<span class="s1">"insercion"</span>: <span class="kd">new</span> <span class="nb">Date</span>()};</span>
<span class="line added c1">    // Inserción</span><span class="line added">    Comentarios.insert(<span class="ss">comentarioNuevo</span>);</span><span class="line added">  }</span><span class="line added">});</span></pre>
            <div class="caption">/lib/colecciones/comentarios.js</div>
            
            <p>Comprobemos que funcionan los comentarios añadiendo nuestro primer comentario.</p>
            
            <figure class="screenshot "><img src="./Comentarios_files/10-2.png" alt="El formulario de envío de comentarios"><figcaption>El formulario de envío de comentarios</figcaption></figure>
            
            <h3 id="men-clsalc">Controlando la suscripción a los comentarios</h3>
            
            <p>Estamos cargando todos los comentarios cuando carga el router por lo que desperdiciamos recursos.</p>
            
            <p>Cargaremos los comentarios a nivel de <em>ruta</em> y no del <em>router</em> para cargar solo aquellos datos a los que queramos acceder.</p>
            
            <p>Cargaremos los datos una vez se acceda a la ruta por lo que será imposible no tener <span class="kd">tiempos de carga</span>.</p>
            
            <p>Primero dejaremos de pre-cargar los datos en el router.</p>
            
			<pre><span class="line">Router.configure({</span><span class="line">  <span class="na">layoutTemplate</span>  : <span class="s1">"diseño"</span>,</span><span class="line added">  <span class="na">waitOn</span>          : <span class="kd">function</span>(){ <span class="kd">return</span> Meteor.subscribe(<span class="s1">"publicaciones"</span>); },</span><span class="line">  <span class="na">loadingTemplate</span> : <span class="s1">"cargando"</span>,</span><span class="line">  <span class="na">notFoundTemplate</span>: <span class="s1">"noEncontrado"</span></span><span class="line">});</span>
<span class="line c1">// •••</span></pre>
            <div class="caption">/lib/router.js</div>
            
            <p>Y añadiremos una nueva función <code class="na">waitOn</code> a nivel de <em>ruta</em> en la ruta <code class="s1">publicacionesPagina</code>:</p>
            
			<pre><span class="line c1">// •••</span>
<span class="line">Router.route(<span class="s1">"/publicacion/</span><span class="ss">:_id</span><span class="s1">"</span>, {</span><span class="line">  <span class="na">name</span>  : <span class="s1">"publicacionesPagina"</span>,</span><span class="line added">  <span class="na">data</span>  : <span class="kd">function</span>(){ <span class="kd">return</span> Publicaciones.findOne(<span class="kd">this</span>.params.<span class="ss">_id</span>); },</span><span class="line added">  <span class="na">waitOn</span>: <span class="kd">function</span>(){ <span class="kd">return</span> Meteor.subscribe(<span class="s1">"comentarios_publicacion"</span>, <span class="kd">this</span>.params.<span class="ss">_id</span>); }</span><span class="line">});</span>
<span class="line c1">// •••</span></pre>
            <div class="caption">/lib/router.js</div>
            
            <p>Nos estamos suscribiendo a una nueva suscripción del servidor a los comentarios mediante el id de la publicación.</p>
            
			<pre><span class="line">Meteor.publish(<span class="s1">"publicaciones"</span>, <span class="kd">function</span>(){</span><span class="line">  <span class="kd">return</span> Publicaciones.find();</span><span class="line">});</span>
<span class="line added">Meteor.publish(<span class="s1">"comentarios_publicacion"</span>, <span class="kd">function</span>(<span class="ss">idPublicacion</span>){</span><span class="line added">  <span class="kd">if</span>( <span class="kd">typeof</span> <span class="ss">idPublicacion</span> == <span class="s1">"string"</span> <span class="kd">&&</span> <span class="ss">idPublicacion</span> ){</span><span class="line added">    <span class="kd">return</span> Comentarios.find({<span class="s1">"_publicacion._id"</span>: <span class="ss">idPublicacion</span>});</span><span class="line added">  }</span><span class="line">});</span></pre>
			<div class="caption">/server/publicaciones.js</div>
            
            <p>Solo tenemos un problema: cuando volvemos a la página principal, todos nuestros mensajes tienen 0 comentarios:</p>
            
            <figure class="screenshot "><img src="./Comentarios_files/10-3.png" alt="¡Los comentarios han desaparecido!"><figcaption>¡Los comentarios han desaparecido!</figcaption></figure>
            
            <h3>Contando comentarios</h3>
            
            <p>Solo nos hemos suscrito a los comentarios cuando entramos a una publicación pero no en el resto de páginas.</p>
            
            <p>La mejor forma de contar los es añadiendo el número de comentarios a la publicación y así evitaremos obtener todos los comentarios para contar los.</p>
            
            <p>Modificaremos el fichero donde creamos las primeras publicaciones y debemos usar <code><span class="kd">meteor</span> reset</code> para hacer efectivo los cambios:</p>
            
			<pre><span class="line"><span class="kd">if</span>( Publicaciones.find().count() <span class="kd">===</span> <span class="nb">0</span> ){</span><span class="line c1">  // Fecha actual</span><span class="line">  <span class="kd">var</span> fechaActual = <span class="kd">new</span> <span class="nb">Date</span>().getTime();</span>
<span class="line c1">  // Crear 2 usuarios</span><span class="line kd">  var</span><span class="line">    usuario1_id = Accounts.createUser({</span><span class="line">      <span class="s1">"username"</span>: <span class="s1">"Usuario 1"</span>,</span><span class="line">      <span class="s1">"password"</span>: <span class="s1">"usuario1"</span></span><span class="line">    }),</span><span class="line">    usuario2_id = Accounts.createUser({</span><span class="line">      <span class="s1">"username"</span>: <span class="s1">"Usuario 2"</span>,</span><span class="line">      <span class="s1">"password"</span>: <span class="s1">"usuario2"</span></span><span class="line">    })</span><span class="line">  ;</span>
<span class="line c1">  // Obtener los usuarios creados</span><span class="line kd">  var</span><span class="line">    usuario1 = Accounts.findUserByUsername(<span class="s1">"Usuario 1"</span>),</span><span class="line">    usuario2 = Accounts.findUserByUsername(<span class="s1">"Usuario 2"</span>)</span><span class="line">  ;</span>
<span class="line c1">  // Crear las publicaciones</span><span class="line">  <span class="kd">var</span> publicacionesDatos = [</span><span class="line">    {</span><span class="line">      <span class="s1">"titulo"</span>: <span class="s1">"Introducción a Telescópio"</span>,</span><span class="line">      <span class="s1">"url"</span>   : <span class="s1">"http://www.sachagreif.com/introducing-telescope"</span>,</span><span class="line">      <span class="s1">"_usuario"</span>: {</span><span class="line">        <span class="s1">"_id"</span>  : usuario1_id,</span><span class="line">        <span class="s1">"autor"</span>: usuario1.username</span><span class="line">      },</span><span class="line">      <span class="s1">"fecha"</span>: {</span><span class="line">        <span class="s1">"insercion"</span>    : <span class="kd">new</span> <span class="nb">Date</span>(fechaActual - <span class="nb">5</span> * <span class="nb">3600</span> * <span class="nb">1000</span>),</span><span class="line">        <span class="s1">"actualizacion"</span>: <span class="kd">new</span> <span class="nb">Date</span>(fechaActual - <span class="nb">5</span> * <span class="nb">3600</span> * <span class="nb">1000</span>)</span><span class="line added">      },</span><span class="line added">      <span class="s1">"comentariosCantidad"</span>: <span class="nb">2</span></span><span class="line">    },{</span><span class="line">      <span class="s1">"titulo"</span>: <span class="s1">"Meteor"</span>,</span><span class="line">      <span class="s1">"url"</span>   : <span class="s1">"http://www.meteor.com"</span>,</span><span class="line">      <span class="s1">"_usuario"</span>: {</span><span class="line">        <span class="s1">"_id"</span>  : usuario2_id,</span><span class="line">        <span class="s1">"autor"</span>: usuario2.username</span><span class="line">      },</span><span class="line">      <span class="s1">"fecha"</span>: {</span><span class="line">        <span class="s1">"insercion"</span>    : <span class="kd">new</span> <span class="nb">Date</span>(fechaActual - <span class="nb">4</span> * <span class="nb">3600</span> * <span class="nb">1000</span>),</span><span class="line">        <span class="s1">"actualizacion"</span>: <span class="kd">new</span> <span class="nb">Date</span>(fechaActual - <span class="nb">4</span> * <span class="nb">3600</span> * <span class="nb">1000</span>)</span><span class="line added">      },</span><span class="line added">      <span class="s1">"comentariosCantidad"</span>: <span class="nb">0</span></span><span class="line">    },{</span><span class="line">      <span class="s1">"titulo"</span>: <span class="s1">"El Libro de Meteor"</span>,</span><span class="line">      <span class="s1">"url"</span>   : <span class="s1">"http://www.themeteorbook.com"</span>,</span><span class="line">      <span class="s1">"_usuario"</span>: {</span><span class="line">        <span class="s1">"_id"</span>  : usuario2_id,</span><span class="line">        <span class="s1">"autor"</span>: usuario2.username</span><span class="line">      },</span><span class="line">      <span class="s1">"fecha"</span>: {</span><span class="line">        <span class="s1">"insercion"</span>    : <span class="kd">new</span> <span class="nb">Date</span>(fechaActual - <span class="nb">2</span> * <span class="nb">3600</span> * <span class="nb">1000</span>),</span><span class="line">        <span class="s1">"actualizacion"</span>: <span class="kd">new</span> <span class="nb">Date</span>(fechaActual - <span class="nb">2</span> * <span class="nb">3600</span> * <span class="nb">1000</span>)</span><span class="line added">      },</span><span class="line added">      <span class="s1">"comentariosCantidad"</span>: <span class="nb">0</span></span><span class="line">    },{</span><span class="line">      <span class="s1">"titulo"</span>: <span class="s1">"Documentos Meteor"</span>,</span><span class="line">      <span class="s1">"url"</span>   : <span class="s1">"http://www.docs.discovermeteor.com"</span>,</span><span class="line">      <span class="s1">"_usuario"</span>: {</span><span class="line">        <span class="s1">"_id"</span>  : usuario1_id,</span><span class="line">        <span class="s1">"autor"</span>: usuario1.username</span><span class="line">      },</span><span class="line">      <span class="s1">"fecha"</span>: {</span><span class="line">        <span class="s1">"insercion"</span>    : <span class="kd">new</span> <span class="nb">Date</span>(fechaActual - <span class="nb">1</span> * <span class="nb">3600</span> * <span class="nb">1000</span>),</span><span class="line">        <span class="s1">"actualizacion"</span>: <span class="kd">new</span> <span class="nb">Date</span>(fechaActual - <span class="nb">1</span> * <span class="nb">3600</span> * <span class="nb">1000</span>)</span><span class="line added">      },</span><span class="line added">      <span class="s1">"comentariosCantidad"</span>: <span class="nb">0</span></span><span class="line">    }</span><span class="line">  ];</span>
<span class="line c1">  // Inserción de las publicaciones y se obtiene su _id</span><span class="line">  <span class="kd">for</span>( <span class="kd">var</span> i <span class="kd">in</span> publicacionesDatos ){</span><span class="line">    publicacionesDatos[i]._id = Publicaciones.insert(publicacionesDatos[i]);</span><span class="line">  }</span>
<span class="line c1">  // Crear los comentarios</span><span class="line">  <span class="kd">var</span> comentariosDatos = [</span><span class="line">    {</span><span class="line">      <span class="s1">"comentario"</span>: <span class="s1">"Interesante proyecto Usuario 1, ¿Puedo involucrarme?"</span>,</span><span class="line">      <span class="s1">"fecha"</span>: {</span><span class="line">        <span class="s1">"insercion"</span>    : <span class="kd">new</span> <span class="nb">Date</span>(fechaActual - <span class="nb">4</span> * <span class="nb">3600</span> * <span class="nb">1000</span>),</span><span class="line">        <span class="s1">"actualizacion"</span>: <span class="kd">new</span> <span class="nb">Date</span>(fechaActual - <span class="nb">4</span> * <span class="nb">3600</span> * <span class="nb">1000</span>)</span><span class="line">      },</span><span class="line">      <span class="s1">"_publicacion"</span>: {<span class="s1">"_id"</span>: publicacionesDatos[<span class="nb">0</span>]._id},</span><span class="line">      <span class="s1">"_usuario"</span>: {</span><span class="line">        <span class="s1">"_id"</span>  : usuario2_id,</span><span class="line">        <span class="s1">"autor"</span>: usuario2.username</span><span class="line">      }</span><span class="line">    },{</span><span class="line">      <span class="s1">"comentario"</span>: <span class="s1">"¡Por supuesto que puedes!"</span>,</span><span class="line">      <span class="s1">"fecha"</span>: {</span><span class="line">        <span class="s1">"insercion"</span>    : <span class="kd">new</span> <span class="nb">Date</span>(fechaActual - <span class="nb">2</span> * <span class="nb">3600</span> * <span class="nb">1000</span>),</span><span class="line">        <span class="s1">"actualizacion"</span>: <span class="kd">new</span> <span class="nb">Date</span>(fechaActual - <span class="nb">2</span> * <span class="nb">3600</span> * <span class="nb">1000</span>)</span><span class="line">      },</span><span class="line">      <span class="s1">"_publicacion"</span>: {<span class="s1">"_id"</span>: publicacionesDatos[<span class="nb">0</span>]._id},</span><span class="line">      <span class="s1">"_usuario"</span>: {</span><span class="line">        <span class="s1">"_id"</span>  : usuario1_id,</span><span class="line">        <span class="s1">"autor"</span>: usuario1.username</span><span class="line">      }</span><span class="line">    }</span><span class="line">  ];</span>
<span class="line c1">  // Inserción de los comentarios</span><span class="line">  <span class="kd">for</span>( <span class="kd">var</span> i <span class="kd">in</span> comentariosDatos ){</span><span class="line">    Comentarios.insert(comentariosDatos[i]);</span><span class="line">  }</span><span class="line">}</span></pre>
            <div class="caption">/server/extras.js</div>
            
			<p>Nos aseguramos de que todas las <span class="kd">nuevas publicaciones</span> empiecen por <span class="nb">0</span>:</p>
            
			<pre><span class="line">Publicaciones = <span class="kd">new</span> Mongo.Collection(<span class="s1">"publicaciones"</span>);</span>
<span class="line">validarPublicaciones = <span class="kd">function</span>(<span class="ss">publicacion</span>){</span><span class="line c1">  // •••</span><span class="line">}</span>
<span class="line">Meteor.methods({</span><span class="line">  <span class="s1">"publicacionesInsertar"</span>: <span class="kd">function</span>(<span class="ss">nuevaPublicacion</span>){</span><span class="line c1">    // Comprobar los datos.</span><span class="line">    <span class="kd">if</span>(  <span class="kd">typeof</span> <span class="ss">nuevaPublicacion</span>.url    <span class="kd">!=</span> <span class="s1">"string"</span></span><span class="line">      <span class="kd">|| typeof</span> <span class="ss">nuevaPublicacion</span>.titulo <span class="kd">!=</span> <span class="s1">"string"</span></span><span class="line">      <span class="kd">|| typeof</span> Meteor.userId()         <span class="kd">!=</span> <span class="s1">"string"</span></span><span class="line">    ){</span><span class="line">      <span class="kd">return</span> {<span class="na">error</span>: <span class="s1">"datosErroneos"</span>}</span><span class="line">    }</span>
<span class="line c1">    // Comprobar si existe la dirección web</span><span class="line">    <span class="kd">if</span>( Publicaciones.findOne({<span class="s1">"url"</span>: <span class="ss">nuevaPublicacion</span>.url}) ){</span><span class="line">      <span class="kd">return</span> {</span><span class="line">        <span class="na">error</span>: <span class="s1">"publicacionExistente"</span>,</span><span class="line">        <span class="na">_id</span>  : Publicaciones.findOne({<span class="s1">"url"</span>: <span class="ss">nuevaPublicacion</span>.url})._id</span><span class="line">      };</span><span class="line">    }</span>
<span class="line">    <span class="kd">var</span> errores = validarPublicaciones(<span class="ss">nuevaPublicacion</span>);</span><span class="line">    <span class="kd">if</span>( errores.titulo <span class="kd">||</span> errores.url ){</span><span class="line">      <span class="kd">throw</span> console.error(<span class="s1">"Publicación inválida:\nDebes establecer un título y una dirección web a tu publicación."</span>);</span><span class="line">    }</span>
<span class="line c1">    // Añadir los datos del usuario actual: Meteor.user()</span><span class="line">    <span class="kd">var</span> usuarioActual = Meteor.user();</span><span class="line">    <span class="ss">nuevaPublicacion</span>._usuario = {</span><span class="line">      <span class="na">_id</span>  : usuarioActual._id,</span><span class="line">      <span class="na">autor</span>: usuarioActual.username</span><span class="line">    };</span><span class="line">    <span class="ss">nuevaPublicacion</span>.fecha = {<span class="na">insercion</span>: <span class="kd">new</span> <span class="nb">Date</span>()};</span><span class="line added">    <span class="ss">nuevaPublicacion</span>.comentariosCantidad = <span class="nb">0</span>;</span>
<span class="line c1">    // Inserción de la publicación nueva a la vez que devuelve el id de la publicación creada.</span><span class="line">    <span class="kd">return</span> {<span class="na">_id</span>: Publicaciones.insert(<span class="ss">nuevaPublicacion</span>)};</span><span class="line">  },</span>
<span class="line c1">  // •••</span><span class="line">});</span></pre>
            <div class="caption">/lib/colecciones/publicaciones.js</div>
            
            <p>Y cuando se cree un nuevo comentario se aumentará el número de comentarios de la publicación:</p>
            
			<pre><span class="line">Comentarios = <span class="kd">new</span> Mongo.Collection(<span class="s1">"comentarios"</span>);</span>
<span class="line">Meteor.methods({</span><span class="line">  <span class="s1">"comentariosInsertar"</span>: <span class="kd">function</span>(<span class="ss">comentarioNuevo</span>){</span><span class="line c1">    // •••</span>
<span class="line c1">    // Usuario</span><span class="line">    <span class="kd">var</span> usuarioActual = Meteor.user();</span><span class="line">    <span class="ss">comentarioNuevo</span>._usuario = {</span><span class="line">      <span class="s1">"_id"</span>  : usuarioActual._id,</span><span class="line">      <span class="s1">"autor"</span>: usuarioActual.username</span><span class="line">    };</span>
<span class="line c1">    // Fecha</span><span class="line">    <span class="ss">comentarioNuevo</span>.fecha = {<span class="s1">"insercion"</span>: <span class="kd">new</span> <span class="nb">Date</span>()};</span>
<span class="line added c1">    // Incrementar el número de comentarios en la publicación</span><span class="line added">    Publicaciones.update(<span class="ss">comentarioNuevo</span>._publicacion._id, {$<span class="na">inc</span>: {<span class="s1">"comentariosCantidad"</span>: <span class="nb">1</span>}});</span>
<span class="line c1">    // Inserción</span><span class="line">    Comentarios.insert(<span class="ss">comentarioNuevo</span>);</span><span class="line">    <span class="kd">return</span> {<span class="s1">"resultado"</span>: <span class="s1">"completado"</span>};</span><span class="line">  }</span><span class="line">});</span></pre>
            <div class="caption">/lib/colecciones/comentarios.js </div>
            
            <p>Finalmente, debemos cambiar el ayudante <code>comentariosContador</code> de <code>publicaciones_objeto.js</code> debido a que la publicación tiene el campo directamente.</p>
			
			<p>Ahora los usuario pueden hablar entre si mediante las publicaciones.<p>
			
			<pre><span class="line">Template.publicacionesObjeto.helpers({</span><span class="line">  <span class="s1">"dominio"</span>: <span class="kd">function</span>(){</span><span class="line">    <span class="kd">var</span> a = document.createElement(<span class="s1">"a"</span>);</span><span class="line">    a.href = this.url;</span><span class="line">    <span class="kd">return</span> (a.hostname.substr(<span class="nb">0</span>, <span class="nb">4</span>) <span class="kd">==</span> <span class="s1">"www."</span>)</span><span class="line">      <span class="kd">?</span> a.hostname.substr(<span class="nb">4</span>)</span><span class="line">      <span class="kd">:</span> a.hostname</span><span class="line">    ;</span><span class="line">  },</span>
<span class="line">  <span class="s1">"publicacionPropia"</span>: <span class="kd">function</span>(){</span><span class="line">    <span class="kd">return this</span>._usuario._id <span class="kd">===</span> Meteor.userId();</span><span class="line">  },</span>
<span class="line">  <span class="s1">"comentariosCantidad_ayudante"</span>: <span class="kd">function</span>(){</span><span class="line added">    <span class="kd">return</span> ( <span class="kd">this</span>.comentariosCantidad <span class="kd">==</span> <span class="nb">1</span> )<span class="kd">?</span> <span class="s1">"comentario"</span> <span class="kd">:</span> <span class="s1">"comentarios"</span>;</span><span class="line">  }</span><span class="line">});</span></pre>
			
			<p>Y por último <code>publicaciones_objeto.html</code></p>
			
			<pre><span class="line"><span class="nt">&lt;template</span> <span class="na">name</span>=<span class="s1">"publicacionesObjeto"</span><span class="nt">&gt;</span></span><span class="line">  <span class="nt">&lt;div</span> <span class="na">class</span>=<span class="s1">"publicacion"</span><span class="nt">&gt;</span></span><span class="line">    <span class="nt">&lt;div</span> <span class="na">class</span>=<span class="s1">"publicacion-contenido"</span><span class="nt">&gt;</span></span><span class="line">      <span class="nt">&lt;h3&gt;&lt;a</span> <span class="na">href</span>=<span class="s1">"{{url}}"</span><span class="nt">&gt;</span>{{titulo}}<span class="nt">&lt;/a&gt;&lt;span&gt;</span>{{dominio}}<span class="nt">&lt;/span&gt;&lt;/h3&gt;</span></span><span class="line nt">      &lt;p&gt;</span><span class="line">        {{#if _usuario.autor}}{{_usuario.autor}}{{/if}}</span><span class="line added">        <span class="nt">&lt;a</span> <span class="na">href</span>=<span class="s1">"{{pathFor 'publicacionesPagina'}}"</span><span class="nt">&gt;</span>{{comentariosCantidad}} {{comentariosCantidad_ayudante}}<span class="nt">&lt;/a&gt;</span></span><span class="line">        {{#if publicacionPropia}}<span class="nt">&lt;a</span> <span class="na">href</span>=<span class="s1">"{{pathFor 'publicacionesModificar'}}"</span><span class="nt">&gt;</span>Modificar<span class="nt">&lt;/a&gt;</span>{{/if}}</span><span class="line nt">      &lt;/p&gt;</span><span class="line nt">    &lt;/div&gt;</span><span class="line">    <span class="nt">&lt;a</span> <span class="na">href</span>=<span class="s1">"{{pathFor 'publicacionesPagina'}}"</span> <span class="na">class</span>=<span class="s1">"debatir btn btn-default"</span><span class="nt">&gt;</span>Debatir<span class="nt">&lt;/a&gt;</span></span><span class="line nt">  &lt;/div&gt;</span><span class="line nt">&lt;/template&gt;</span></pre>
            <div class="caption">/lib/colecciones/publicaciones_objeto.html </div>
			
			<p>NOTA: <em>Cuando un comentario se añade aumenta la cantidad de comentarios de la própia publicación, pero si se elimina el comentario de la base de datos segirá estando la cantidad de comentarios igual a menos que la modifiques manualmente</em>.</p>
			
			<p>Los usuarios se pierden las conversaciones por lo que en el siguiente capítulo veremos como implementar las notificaciones.<p>
		  </div>
          <div class="bottom-nav">
            <div class="post-nav">
              <a class="prev" href="http://es.discovermeteor.com/chapters/creating-a-meteor-package/" title="Previous Post: Creando un paquete Meteor">
                «
                Creando un paquete Meteor
              </a>
              <a class="next" href="http://es.discovermeteor.com/chapters/denormalization/" title="next Post: Denormalización">
                Denormalización
                »
              </a>
            </div>
          </div>
        </div>
        <div class="comments sidebar">
          <a class="sidebar-toggle" data-disqus-identifier="comments_es" href="http://es.discovermeteor.com/chapters/comments/#disqus_thread">3 Comments</a>
          <div class="sidebar-inner">
            <div class="issues">
              <a class="issue-link simple-button" href="https://github.com/DiscoverMeteor/Microscope/issues" target="_blank">Reporta un problema con el código</a>
              <a class="issue-link simple-button" href="https://github.com/DiscoverMeteor/DiscoverMeteor_es/issues" target="_blank">Reporta un problema con el libro</a>
              <hr>
              <p>O, comenta el contenido aquí:</p>
            </div>
            <div id="disqus_thread"><iframe id="dsq-app704" name="dsq-app704" allowtransparency="true" frameborder="0" scrolling="no" tabindex="0" title="Disqus" width="100%" src="./Comentarios_files/saved_resource.html" style="width: 1px !important; min-width: 100% !important; border: none !important; overflow: hidden !important; height: 980px !important;" horizontalscrolling="no" verticalscrolling="no"></iframe></div>
            <script type="text/javascript">
                /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
                var disqus_shortname = 'discovermeteores'; // required: replace example with your forum shortname
                var disqus_identifier = 'comments_es';
            
                /* * * DON'T EDIT BELOW THIS LINE * * */
                (function() {
                    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                    dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
                    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
                })();
            
                /* * * DON'T EDIT BELOW THIS LINE * * */
                (function () {
                var s = document.createElement('script'); s.async = true;
                s.type = 'text/javascript';
                s.src = 'http://' + disqus_shortname + '.disqus.com/count.js';
                (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
                }());
            
            </script>
          </div>
        </div>
      </div>
    </div>
    <footer>
      <div class="row">
        © 2014 <a href="http://tom.thesnail.org/">Tom Coleman</a> y <a href="http://sachagreif.com/">Sacha Greif</a>
      </div>
    </footer>
    <!-- %script{:src => "https://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.5.2/underscore-min.js"} -->
    <script src="./Comentarios_files/moment.min.js.descarga"></script>
    <script src="./Comentarios_files/es.js.descarga"></script>
    <script src="./Comentarios_files/script.js.descarga"></script>
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
      
      ga('create', 'UA-38246482-5', 'discovermeteor.com');
      ga('send', 'pageview');
    </script>
    <input id="lang" type="hidden" value="es">
  

<iframe style="display: none;" src="./Comentarios_files/saved_resource(1).html"></iframe></body></html>