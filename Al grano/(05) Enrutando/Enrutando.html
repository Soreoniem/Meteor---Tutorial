<!DOCTYPE html>
<!-- saved from url=(0046)http://es.discovermeteor.com/chapters/routing/ -->
<html class="no-js wf-klavikaweb-n3-active wf-klavikaweb-n6-active wf-sourcesanspro-n4-active wf-sourcesanspro-n7-active wf-sourcesanspro-i7-active wf-sourcesanspro-i4-active wf-sourcesanspro-n3-active wf-sourcesanspro-i3-active wf-sourcecodepro-n7-active wf-sourcecodepro-n4-active wf-active" lang="es"><!-- <![endif] --><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    
    <!-- Set the viewport width to device width for mobile -->
    <meta content="width=device-width, initial-scale=1.0" name="viewport">
    <title>Enrutando - Descubriendo Meteor</title>
    <!-- Included CSS Files -->
    <link href="./Enrutando_files/screen.css" rel="stylesheet">
    <link href="./Enrutando_files/print.css" media="print" rel="stylesheet">
    <!-- %link{:href => "http://fonts.googleapis.com/css?family=Source+Sans+Pro:200,400,700,400italic", :rel => "stylesheet"} -->
    <!-- %link{:href => "http://fonts.googleapis.com/css?family=Source+Code+Pro:400,700", :rel => "stylesheet"} -->
    <link href="http://es.discovermeteor.com/images/favicon.ico" rel="shortcut icon">
    <script async="" src="./Enrutando_files/analytics.js.descarga"></script><script src="./Enrutando_files/jquery.min.js.descarga"></script><style type="text/css">
:root .adsbox
{ display: none !important; }</style>
    <script src="./Enrutando_files/rcr2ohz.js.descarga"></script>
    <style type="text/css">.tk-klavika-web{font-family:"klavika-web",sans-serif;}.tk-source-sans-pro{font-family:"source-sans-pro",sans-serif;}.tk-source-code-pro{font-family:"source-code-pro",sans-serif;}</style><style type="text/css">@font-face{font-family:klavika-web;src:url(https://use.typekit.net/af/5401fe/00000000000000003b9acdf2/27/l?subset_id=2&fvd=n3&v=3) format("woff2"),url(https://use.typekit.net/af/5401fe/00000000000000003b9acdf2/27/d?subset_id=2&fvd=n3&v=3) format("woff"),url(https://use.typekit.net/af/5401fe/00000000000000003b9acdf2/27/a?subset_id=2&fvd=n3&v=3) format("opentype");font-weight:300;font-style:normal;}@font-face{font-family:klavika-web;src:url(https://use.typekit.net/af/835e90/00000000000000003b9acdf6/27/l?subset_id=2&fvd=n6&v=3) format("woff2"),url(https://use.typekit.net/af/835e90/00000000000000003b9acdf6/27/d?subset_id=2&fvd=n6&v=3) format("woff"),url(https://use.typekit.net/af/835e90/00000000000000003b9acdf6/27/a?subset_id=2&fvd=n6&v=3) format("opentype");font-weight:600;font-style:normal;}@font-face{font-family:source-sans-pro;src:url(https://use.typekit.net/af/b0088d/00000000000000003b9acb59/27/l?subset_id=2&fvd=n4&v=3) format("woff2"),url(https://use.typekit.net/af/b0088d/00000000000000003b9acb59/27/d?subset_id=2&fvd=n4&v=3) format("woff"),url(https://use.typekit.net/af/b0088d/00000000000000003b9acb59/27/a?subset_id=2&fvd=n4&v=3) format("opentype");font-weight:400;font-style:normal;}@font-face{font-family:source-sans-pro;src:url(https://use.typekit.net/af/c55ca5/00000000000000003b9acb5c/27/l?subset_id=2&fvd=n7&v=3) format("woff2"),url(https://use.typekit.net/af/c55ca5/00000000000000003b9acb5c/27/d?subset_id=2&fvd=n7&v=3) format("woff"),url(https://use.typekit.net/af/c55ca5/00000000000000003b9acb5c/27/a?subset_id=2&fvd=n7&v=3) format("opentype");font-weight:700;font-style:normal;}@font-face{font-family:source-sans-pro;src:url(https://use.typekit.net/af/7e0c18/00000000000000003b9acb5d/27/l?subset_id=2&fvd=i7&v=3) format("woff2"),url(https://use.typekit.net/af/7e0c18/00000000000000003b9acb5d/27/d?subset_id=2&fvd=i7&v=3) format("woff"),url(https://use.typekit.net/af/7e0c18/00000000000000003b9acb5d/27/a?subset_id=2&fvd=i7&v=3) format("opentype");font-weight:700;font-style:italic;}@font-face{font-family:source-sans-pro;src:url(https://use.typekit.net/af/c42064/00000000000000003b9acb58/27/l?subset_id=2&fvd=i4&v=3) format("woff2"),url(https://use.typekit.net/af/c42064/00000000000000003b9acb58/27/d?subset_id=2&fvd=i4&v=3) format("woff"),url(https://use.typekit.net/af/c42064/00000000000000003b9acb58/27/a?subset_id=2&fvd=i4&v=3) format("opentype");font-weight:400;font-style:italic;}@font-face{font-family:source-sans-pro;src:url(https://use.typekit.net/af/b35fa2/00000000000000003b9acb56/27/l?subset_id=2&fvd=n3&v=3) format("woff2"),url(https://use.typekit.net/af/b35fa2/00000000000000003b9acb56/27/d?subset_id=2&fvd=n3&v=3) format("woff"),url(https://use.typekit.net/af/b35fa2/00000000000000003b9acb56/27/a?subset_id=2&fvd=n3&v=3) format("opentype");font-weight:300;font-style:normal;}@font-face{font-family:source-sans-pro;src:url(https://use.typekit.net/af/a6c785/00000000000000003b9acb57/27/l?subset_id=2&fvd=i3&v=3) format("woff2"),url(https://use.typekit.net/af/a6c785/00000000000000003b9acb57/27/d?subset_id=2&fvd=i3&v=3) format("woff"),url(https://use.typekit.net/af/a6c785/00000000000000003b9acb57/27/a?subset_id=2&fvd=i3&v=3) format("opentype");font-weight:300;font-style:italic;}@font-face{font-family:source-code-pro;src:url(https://use.typekit.net/af/b8b49b/0000000000000000000179d5/27/l?subset_id=2&fvd=n7&v=3) format("woff2"),url(https://use.typekit.net/af/b8b49b/0000000000000000000179d5/27/d?subset_id=2&fvd=n7&v=3) format("woff"),url(https://use.typekit.net/af/b8b49b/0000000000000000000179d5/27/a?subset_id=2&fvd=n7&v=3) format("opentype");font-weight:700;font-style:normal;}@font-face{font-family:source-code-pro;src:url(https://use.typekit.net/af/953e9e/0000000000000000000179cf/27/l?subset_id=2&fvd=n4&v=3) format("woff2"),url(https://use.typekit.net/af/953e9e/0000000000000000000179cf/27/d?subset_id=2&fvd=n4&v=3) format("woff"),url(https://use.typekit.net/af/953e9e/0000000000000000000179cf/27/a?subset_id=2&fvd=n4&v=3) format("opentype");font-weight:400;font-style:normal;}</style><script>
      try{Typekit.load();}catch(e){}
    </script>
  <script type="text/javascript" async="" src="./Enrutando_files/embed.js.descarga"></script><script async="" type="text/javascript" src="./Enrutando_files/count.js.descarga"></script><style type="text/css">
:root *[grs7owk][hidden] { display: none !important; }</style><link rel="preload" as="style" href="https://c.disquscdn.com/next/embed/styles/lounge.2d848eddee1b8c12749b72a04b2b33dc.css"><link rel="preload" as="script" href="https://c.disquscdn.com/next/embed/common.bundle.845ead53749f15d0bd8a5ee344c8f06e.js"><link rel="preload" as="script" href="https://c.disquscdn.com/next/embed/lounge.bundle.8241ae5fc761eb94635acdc63f5fd29f.js"><link rel="preload" as="script" href="https://disqus.com/next/config.js"><script src="./Enrutando_files/count-data.js.descarga"></script><script src="./Enrutando_files/alfie.f51946af45e0b561c60f768335c9eb79.js.descarga" async="" charset="UTF-8"></script></head>
  <body style="zoom: 1;" cz-shortcut-listen="true">
    <header>
      <h1>
        <a href="http://es.discovermeteor.com/">
          <span>Descubriendo</span>
          <strong>Meteor</strong>
        </a>
      </h1>
    </header>
    <div class="main">
      <div class="row">
        <div class="toc sidebar">
          <a class="sidebar-toggle" href="javascript:void(0)">Toggle Table of Contents</a>
          <div class="sidebar-inner">
            <ul>
              <li>
                <span class="number">
                  1
                </span>
                <a href="http://es.discovermeteor.com/chapters/introduction/">
                  Introducción
                </a>
              </li>
              <li>
                <span class="number">
                  2
                </span>
                <a href="http://es.discovermeteor.com/chapters/getting-started/">
                  Empezando
                </a>
              </li>
              <li class="sidebar-chapter">
                <span class="number">
                  2.5
                </span>
                <a href="http://es.discovermeteor.com/chapters/deploying/">
                  Despliegue
                </a>
              </li>
              <li>
                <span class="number">
                  3
                </span>
                <a href="http://es.discovermeteor.com/chapters/templates/">
                  Plantillas
                </a>
              </li>
              <li class="sidebar-chapter">
                <span class="number">
                  3.5
                </span>
                <a href="http://es.discovermeteor.com/chapters/github/">
                  Usando Git y GitHub
                </a>
              </li>
              <li>
                <span class="number">
                  4
                </span>
                <a href="http://es.discovermeteor.com/chapters/collections/">
                  Colecciones
                </a>
              </li>
              <li class="sidebar-chapter">
                <span class="number">
                  4.5
                </span>
                <a href="http://es.discovermeteor.com/chapters/publications-and-subscriptions/">
                  Publicaciones y suscripciones
                </a>
              </li>
              <li class="active">
                <span class="number">
                  5
                </span>
                <a href="http://es.discovermeteor.com/chapters/routing/">
                  Enrutando
                </a>
              </li>
              <li class="sidebar-chapter">
                <span class="number">
                  5.5
                </span>
                <a href="http://es.discovermeteor.com/chapters/the-session/">
                  La sesión
                </a>
              </li>
              <li>
                <span class="number">
                  6
                </span>
                <a href="http://es.discovermeteor.com/chapters/adding-users/">
                  Añadiendo usuarios
                </a>
              </li>
              <li class="sidebar-chapter">
                <span class="number">
                  6.5
                </span>
                <a href="http://es.discovermeteor.com/chapters/reactivity/">
                  Reactividad
                </a>
              </li>
              <li>
                <span class="number">
                  7
                </span>
                <a href="http://es.discovermeteor.com/chapters/creating-posts/">
                  Creando posts
                </a>
              </li>
              <li class="sidebar-chapter">
                <span class="number">
                  7.5
                </span>
                <a href="http://es.discovermeteor.com/chapters/latency-compensation/">
                  Compensación de la latencia
                </a>
              </li>
              <li>
                <span class="number">
                  8
                </span>
                <a href="http://es.discovermeteor.com/chapters/editing-posts/">
                  Editando posts
                </a>
              </li>
              <li class="sidebar-chapter">
                <span class="number">
                  8.5
                </span>
                <a href="http://es.discovermeteor.com/chapters/allow-and-deny/">
                  Permitir y Denegar
                </a>
              </li>
              <li>
                <span class="number">
                  9
                </span>
                <a href="http://es.discovermeteor.com/chapters/errors/">
                  Errores
                </a>
              </li>
              <li class="sidebar-chapter">
                <span class="number">
                  9.5
                </span>
                <a href="http://es.discovermeteor.com/chapters/creating-a-meteor-package/">
                  Creando un paquete Meteor
                </a>
              </li>
              <li>
                <span class="number">
                  10
                </span>
                <a href="http://es.discovermeteor.com/chapters/comments/">
                  Comentarios
                </a>
              </li>
              <li class="sidebar-chapter">
                <span class="number">
                  10.5
                </span>
                <a href="http://es.discovermeteor.com/chapters/denormalization/">
                  Denormalización
                </a>
              </li>
              <li>
                <span class="number">
                  11
                </span>
                <a href="http://es.discovermeteor.com/chapters/notifications/">
                  Notificaciones
                </a>
              </li>
              <li class="sidebar-chapter">
                <span class="number">
                  11.5
                </span>
                <a href="http://es.discovermeteor.com/chapters/advanced-reactivity/">
                  Reactividad avanzada
                </a>
              </li>
              <li>
                <span class="number">
                  12
                </span>
                <a href="http://es.discovermeteor.com/chapters/pagination/">
                  Paginación
                </a>
              </li>
              <li>
                <span class="number">
                  13
                </span>
                <a href="http://es.discovermeteor.com/chapters/voting/">
                  Votos
                </a>
              </li>
              <li class="sidebar-chapter">
                <span class="number">
                  13.5
                </span>
                <a href="http://es.discovermeteor.com/chapters/advanced-publications/">
                  Publicaciones avanzadas
                </a>
              </li>
              <li>
                <span class="number">
                  14
                </span>
                <a href="http://es.discovermeteor.com/chapters/animations/">
                  Animaciones
                </a>
              </li>
              <li>
                <span class="number">
                  14.5
                </span>
                <a href="http://es.discovermeteor.com/chapters/going-further/">
                  Ir más lejos
                </a>
              </li>
              <li>
                <span class="number">
                  14.5
                </span>
                <a href="http://es.discovermeteor.com/chapters/meteor-vocabulary/">
                  Vocabulario
                </a>
              </li>
              <li>
                <span class="number">
                  99
                </span>
                <a href="http://es.discovermeteor.com/chapters/changelog/">
                  Changelog
                </a>
              </li>
            </ul>
          </div>
        </div>
        <div class="vocabulary sidebar">
          <a class="sidebar-toggle" href="http://es.discovermeteor.com/chapters/routing/#">Toggle Vocabulary</a>
          <div class="sidebar-inner">
            <div class="sidebar-content">
              <h3>Vocabulary</h3>
              <h4>Cliente</h4>
              
              <p style="display: none;">Cuando hablamos del Cliente, nos referimos al código que se ejecuta en el navegador de los usuarios, ya sea uno tradicional, como Firefox o Safari, o algo tan complejo como un UIWebView en una aplicación nativa para el iPhone.</p>
              
              <h4>Colección</h4>
              
              <p style="display: none;">Una colección es el almacén de datos que se sincroniza automáticamente entre el cliente y el servidor. Las colecciones tienen un nombre (como <code>posts</code>), y por lo general existen tanto en el cliente como en el servidor. Si bien se comportan de forma distinta, tienen una API común basada en la API de Mongo.</p>
              
              <h4>Computación</h4>
              
              <p style="display: none;">Una computación es un bloque de código que se ejecuta cada vez que cambia una de las fuentes de datos reactivos de las que depende. Si tienes una fuente reactiva (por ejemplo, una variable de sesión) y quieres responder reactivamente a ella, tendrás que crear una computación.</p>
              
              <h4>Cursor</h4>
              
              <p style="display: none;">Un cursor es el resultado de ejecutar una consulta en una colección Mongo. En el lado del cliente, un cursor no es tan sólo un conjunto de resultados, sino que es un objeto <em>reactivo</em> desde el que se puede observar (con <code>observe()</code>) los cambios (añadir, eliminar o actualizar) en la colección correspondiente.</p>
              
              <h4>DDP</h4>
              
              <p style="display: none;">El DDP es el Protocolo de Datos Distribuidos que utiliza Meteor para sincronizar colecciones y efectuar llamadas a métodos. DDP pretende ser un protocolo genérico, que toma el relevo a HTTP para aplicaciones en tiempo real con gran carga de datos.</p>
              
              <h4>Deps</h4>
              
              <p style="display: none;">Deps es el sistema reactivo de Meteor. Deps se utiliza entre bastidores para sincronizar automáticamente el  HTML con el modelo de datos subyacente.</p>
              
              <h4>Documento</h4>
              
              <p style="display: none;">Mongo es un almacén de datos basado en documentos y a los objetos que salen de las colecciones se les llama “documentos”. Son objetos JavaScript sin formato (aunque no pueden contener funciones) con una única propiedad especial, el ’_id’, que Meteor utiliza para realizar un seguimiento de sus propiedades en el DDP.</p>
              
              <h4>Ayudantes</h4>
              
              <p style="display: none;">Cuando una plantilla necesita mostrar cosas más complejas que una simple propiedad de un documento, ésta puede hacer uso de su ayudante, una función que se utiliza para procesar los datos que se muestran en ella.</p>
              
              <h4>Compensación de la latencia</h4>
              
              <p style="display: none;">Es una técnica que permite simular llamadas a métodos en el cliente para evitar retrasos mientras se espera la respuesta del servidor.</p>
              
              <h4>Meteor Development Group (MDG)</h4>
              
              <p style="display: none;">La empresa que desarrolla Meteor.</p>
              
              <h4>Método</h4>
              
              <p style="display: none;">Un método en Meteor es una llamada desde el cliente, a un procedimiento remoto en el servidor, con un poco de lógica añadida que permite realizar un seguimiento de los cambios en los datos además de compensar la latencia de la llamada.</p>
              
              <h4>MiniMongo</h4>
              
              <p style="display: none;">La colección del lado del cliente es un almacén de datos en memoria que ofrece una API tipo Mongo. La librería que se utiliza se llama “MiniMongo”, para indicar que es una versión más pequeña de Mongo que se ejecuta por completo en la memoria del navegador.</p>
              
              <h4>Paquete</h4>
              
              <p style="display: none;">Un paquete Meteor puede ser: código JavaScript que se ejecuta en el servidor, código JavaScript que se ejecuta en el cliente, instrucciones para procesar recursos (como SASS a CSS), o recursos que deben ser  procesados​​. <br> Un paquete es como una librería con superpoderes. Meteor incluye una gran cantidad de paquetes (<code>meteor list</code>). También existe <a href="http://atmosphere.meteor.com/">Atmosphere</a>, que es una colección de paquetes de terceros mantenida por la comunidad (<code>mrt add ...</code>).</p>
              
              <h4>Publicación</h4>
              
              <p style="display: none;">Una publicación es un conjunto de datos con nombre que se personaliza para cada usuario que se suscribe a ella. Se configuran en el servidor.</p>
              
              <h4>Servidor</h4>
              
              <p style="display: none;">El servidor Meteor es un servidor HTTP y DDP ejecutados vía Node.js. Se compone de todas las librerías y del código JavaScript del lado del servidor. Cuando se inicia el servidor, se conecta a una base de datos Mongo (que configura por si mismo en el primer arranque).</p>
              
              <h4>Sesión</h4>
              
              <p style="display: none;">La sesión en Meteor es una fuente de datos reactiva que usa tu aplicación para hacer un seguimiento del estado del usuario.</p>
              
              <h4>Suscripción</h4>
              
              <p style="display: none;">Una suscripción es una conexión a una publicación desde un cliente específico. La suscripción es el código que ejecuta el navegador y que utiliza para comunicarse con una publicación del servidor y que, además, mantiene los datos sincronizados.</p>
              
              <h4>Plantilla</h4>
              
              <p style="display: none;">Una plantilla es una forma de generar código HTML desde JavaScript. Por defecto, Meteor sólo soporta el sistema Spacebars, pero hay planes para incluir más.</p>
              
              <h4>Contexto de datos de una plantilla</h4>
              
              <p style="display: none;">Cuando se muestra un plantilla, lo que se representa es un objeto JavaScript que proporciona datos específicos para esta representación en particular. Por lo general, este tipo de objetos son, de tipo POJO (plain-old-JavaScript-objects), a menudo son documentos de una colección, aunque pueden ser más complejos e incluir funciones.</p>
            </div>
          </div>
        </div>
        <div class="post">
          <div class="top-nav">
            <div class="post-nav">
              <a class="prev" href="http://es.discovermeteor.com/chapters/publications-and-subscriptions/" title="Previous Post: Publicaciones y suscripciones">
                «
                Publicaciones y suscripciones
              </a>
              <a class="next" href="http://es.discovermeteor.com/chapters/the-session/" title="next Post: La sesión">
                La sesión
                »
              </a>
            </div>
          </div>
          <div class="post-content">
            <div class="chapter-heading">
              <h2 class="chapter-title">Enrutando</h2>
              <span class="chapter-number">5</span>
            </div>
            <input id="paragraphs" type="hidden" value="72">
            <div class="chapter-summary note chapter">
				<a href="#men" style="position:fixed;bottom:0px;left:0px;margin:2px;padding:2px 7px;background-color:rgba(64, 64, 64, 0.2);border-radius:50%;box-shadow:0px 0px 5px rgba(0, 0, 0, 0.4);">▲</a>
              <h3 id="men">En este capítulo:</h3>
              <ul>
				  <li><a href="#men-aepir">Añadiendo el paquete Iron Router.</a></li>
				  <li><a href="#men-emuap">Enrutando: Mapeando URLs a plantillas.</a></li>
				  <li><a href="#men-rcn">Rutas con nombre.</a></li>
				  <li><a href="#men-eald">Esperando a los datos.</a></li>
				  <li><a href="#men-cc">Cargando cosas.</a></li>
				  <li><a href="#men-eaupe">Enrutando a una publicación específica.</a></li>
				  <li><a href="#men-uned">Usando nuestro enrutador dinámico.</a></li>
				  <li><a href="#men-pne">Publicación no encontrada.</a></li>
			  </ul>
            </div>
            
			<p>Vamos a crear un lugar en el cual los usuarios puedan comentar las publicaciones.</p>
            
            <p>La dirección url debería ser <code>http://myapp.com/publicacion/•••</code> (donde <code>•••</code> es un identificador <code>_id</code> de MongoDB) siendo único para cada publicación.</p>
            
            <p>Para ello necesitaremos un enrutador de direcciones web.</p>
            
            <h3 id="men-aepir">Añadiendo el paquete Iron Router</h3>
            
            <p>Usaremos <a href="https://github.com/EventedMind/iron-router" target="_blank">Iron Router</a> que es un paquete de enrutamiento mediante el siguiente comando:</p>
            
            <pre><span class="line"><span class="kd browser-prompt">></span> <span class="kd">meteor</span> add iron:router</span></pre>
            <div class="caption">Terminal</div>
            
			<p>Debería mostrarse la página de ayuda de Iron Router por el navegador web.</p>
            
            <figure class="diagram pull-center"><img src="./Enrutando_files/5-1.png" alt="Plantilla de Iron Router."><figcaption>Plantilla de Iron Router.</figcaption></figure>
			
			<h3 id="men-emuap">Enrutando: Mapeando URLs a plantillas</h3>
            
            <p>Indicaremos a Iron Router que cambiaremos nuestro diseño de una plantilla estática <code>{{> publicacionesLista}}</code>) a una dinámica que contendrá la plantilla <code>{{> yeld}}</code>.</p>
            
            <figure class="diagram pull-center"><img src="./Enrutando_files/router-diagram@2x.png" alt="Plantillas y layouts."><figcaption>Plantillas y layouts.</figcaption></figure>
            
            <p>Eliminamos la etiqueta <code class="nt">&lt;body&gt;</code> del fichero <code>main.html</code>, y movemos su contenido a su propia plantilla, <code>diseño.html</code> (que colocaremos dentro del directorio <code>/client/plantillas/aplicacion</code>).</p>
			
			<pre><span class="line"><span class="nt">&lt;head&gt;</span></span><span class="line">  <span class="nt">&lt;title&gt;</span>Microscopio<span class="nt">&lt;/title&gt;</span></span><span class="line"><span class="nt">&lt;/head&gt;</span></span></pre>
            <div class="caption">/client/main.html</div>
            
			<p>El fichero <code>diseño.html</code> contendrá lo mismo pero sustituiremos la etiqueta <code class="nt">&lt;body&gt;</code> por <code><span class="nt">&lt;template</span> <span class="na">name=</span><span class="s">"diseño"</span><span class="nt">&gt;</span></code>:</p>
            
			<pre><span class="line"><span class="nt">&lt;template</span> <span class="na">name</span>=<span class="s1">"diseño"</span><span class="nt">&gt;</span></span><span class="line">  <span class="nt">&lt;div</span> <span class="na">class</span>=<span class="s1">"container"</span><span class="nt">&gt;</span></span><span class="line">    <span class="nt">&lt;header</span> <span class="na">class</span>=<span class="s1">"navbar navbar-default"</span> <span class="na">role</span>=<span class="s1">"navigation"</span><span class="nt">&gt;</span></span><span class="line">      <span class="nt">&lt;div</span> <span class="na">class</span>=<span class="s1">"navbar-header"</span><span class="nt">&gt;</span></span><span class="line">        <span class="nt">&lt;a</span> <span class="na">class</span>=<span class="s1">"navbar-brand"</span> <span class="na">href</span>=<span class="s1">"/"</span><span class="nt">&gt;</span>Microscopio<span class="nt">&lt;/a&gt;</span></span><span class="line nt">      &lt;/div&gt;</span><span class="line nt">    &lt;/header&gt;</span><span class="line">    <span class="nt">&lt;div</span> <span class="na">id</span>=<span class="s1">"main"</span><span class="nt">&gt;</span></span><span class="line">      {{> yield}}</span><span class="line nt">    &lt;/div&gt;</span><span class="line nt">  &lt;/div&gt;</span><span class="line nt">&lt;/template&gt;</span></pre>
			<div class="caption">/client/plantillas/aplicacion/diseño.html</div>
            
			<p>Hemos cambiado de la plantilla <code>publicacionesLista</code> a <code>yield</code>.</p>
            
            <p>Indicaremos a Iron Router, mediante <code>router.js</code>, que la dirección raiz <code>/</code> sea la plantilla <code>publicacionesLista</code>:</p>
			
			<pre><span class="line">Router.configure({</span><span class="line">  <span class="na">layoutTemplate</span>: <span class="s1">"diseño"</span></span><span class="line">});</span>
<span class="line">Router.route(<span class="s1">"/"</span>, {<span class="na">name</span>: <span class="s1">"publicacionesLista"</span>});</span></pre>
            <div class="caption">/lib/router.js</div>
            
			<p>Con esto la ayuda de Iron Router ha desaparecido, mapeado la url <code>/</code> a <code>publicacionesLista</code> y añadido un diseño predeterminado a la aplicación.</p>
			
            <h3 id="men-rcn">Rutas con nombre</h3>
            
            <p>Al usar Iron Router tenemos acceso al ayudante Spacebars: <code>{{pathFor}}</code>.</p>
            
            <p>Ahora que tenemos una ruta definida en <code>/</code> cambiaremos la dirección estatica de la cabecera por la dinámica.</p>

            <pre><span class="line c1">//•••</span><span class="line">  <span class="nt">&lt;header</span> <span class="na">class</span>=<span class="s1">"navbar navbar-default"</span> <span class="na">role</span>=<span class="s1">"navigation"</span><span class="nt">&gt;</span></span><span class="line">    <span class="nt">&lt;div</span> <span class="na">class</span>=<span class="s1">"navbar-header"</span><span class="nt">&gt;</span></span><span class="line added">      <span class="nt">&lt;a</span> <span class="na">class</span>=<span class="s1">"navbar-brand"</span> <span class="na">href</span>=<span class="s1">"{{pathFor 'publicacionesLista'}}"</span><span class="nt">&gt;</span>Microscopio<span class="nt">&lt;/a&gt;</span></span><span class="line nt">    &lt;/div&gt;</span><span class="line nt">  &lt;/header&gt;</span><span class="line c1">  //•••</span></pre>
            <div class="caption">/client/plantillas/aplicacion/diseño.html</div>
            
            <div class="lines-highlight" data-lines="3" data-class="added"></div>
            
            <h3 id="men-eald">Esperando a los datos</h3>
            
            <p>Los datos no se ven hasta que cargan completamente.</p>
            
			<pre><span class="line">Router.configure({</span><span class="line added">  <span class="na">layoutTemplate</span>: <span class="s1">"diseño"</span>,</span><span class="line added">  <span class="na">waitOn</span>        : <span class="kd">function</span>(){ <span class="kd">return</span> Meteor.subscribe(<span class="s1">"publicaciones"</span>); }</span><span class="line">});</span>
<span class="line">Router.route(<span class="s1">"/"</span>, {<span class="na">name</span>: <span class="s1">"publicacionesLista"</span>});</span></pre>
            <div class="caption">/lib/router.js</div>
            
            <div class="lines-highlight" data-lines="2,3" data-class="added"></div>
            
            <p>Le estamos diciendo a Iron Router que para <em>cualquier ruta</em> del sitio queremos suscribirnos a la subscripción <code>publicaciones</code>.</p>
            
            <p>Como tenemos la suscripción en el <code>router.js</code> podemos borrar el archivo <code>/client/main.js</code>.</p>
            
            <h3 id="men-cc">Cargando cosas</h3>
            
            <p>Al cargar la web no sabemos si hay contenido hasta que se carga, por ello vamos a crear la plantilla <code>cargando</code>.</p>
			
			<p>Primero añadimos el paquete <code>spin</code> con el comando <code><span class="kd">meteor</span> add sacha:spin</code> y luego creamos la plantilla <code>cargando</code> en el directorio <code>/client/plantillas/extras</code>.</p>
			
			<pre><span class="line"><span class="kd browser-prompt">></span> <span class="kd">meteor</span> add sacha:spin</span></pre>
			<div class="caption">Terminal</div>
            
			<pre><span class="line"><span class="nt">&lt;template</span> <span class="na">name</span>=<span class="s1">"cargando"</span><span class="nt">&gt;</span></span><span class="line">  {{> spinner}}</span><span class="line nt">&lt;/template&gt;</span></pre>
			<div class="caption">/client/plantillas/extras/cargando.html</div>
			
			<p>Ahora que tenemos el paquete y la plantilla preparada solo resta decirselo a Iron Router</p>
            
			<pre><span class="line">Router.configure({</span><span class="line">  <span class="na">layoutTemplate</span> : <span class="s1">"diseño"</span>,</span><span class="line added">  <span class="na">waitOn</span>         : <span class="kd">function</span>(){ <span class="kd">return</span> Meteor.subscribe(<span class="s1">"publicaciones"</span>); },</span><span class="line added">  <span class="na">loadingTemplate</span>: <span class="s1">"cargando"</span></span><span class="line">});</span>
<span class="line">Router.route(<span class="s1">"/"</span>, {<span class="na">name</span>: <span class="s1">"publicacionesLista"</span>});</span></pre>
			<div class="caption">/lib/router.js</div>
            
            <div class="lines-highlight" data-lines="3,4" data-class="added"></div>
            
            <h3 id="men-eaupe">Enrutando a una publicación específica</h3>
            
            <p>Vamos a configurar una ruta para mostrar los detalles de una sola publicación.</p>
            
            <p>Crearemos una ruta <em>dinámica</em> para no crear una ruta por cada publicación manualmente.</p>
            
            <p>Primero crearemos la plantilla para una sola publicación:</p>
            
			<pre><span class="line"><span class="nt">&lt;template</span> <span class="na">name</span>=<span class="s1">"publicacionesPagina"</span><span class="nt">&gt;</span></span><span class="line">  <span class="nt">&lt;div</span> <span class="na">class</span>=<span class="s1">"publicaciones-pagina pagina"</span><span class="nt">&gt;</span></span><span class="line">    {{> publicacionesObjeto}}</span><span class="line nt">  &lt;/div&gt;</span><span class="line nt">&lt;/template&gt;</span></pre>
            <div class="caption">/client/plantillas/publicaciones/publicaciones_pagina.html</div>
            
            <p>De momento solo mostraremos en la página el la publicación <code>{{&gt; publicacionesOjeto}}</code>.</p>
            
            <p>Ahora mapearemos URLs de la forma <code>/publicacion/•••</code> hacia la plantilla <code>publicacionesPagina</code> donde <code>•••</code> será el <code>_id</code> de la publicación:</p>			
            
			<pre><span class="line">Router.configure({</span><span class="line">  <span class="na">layoutTemplate</span> : <span class="s1">"diseño"</span>,</span><span class="line">  <span class="na">waitOn</span>         : <span class="kd">function</span>(){ <span class="kd">return</span> Meteor.subscribe(<span class="s1">"publicaciones"</span>); },</span><span class="line">  <span class="na">loadingTemplate</span>: <span class="s1">"cargando"</span></span><span class="line">});</span>
<span class="line">Router.route(<span class="s1">"/"</span>, {<span class="na">name</span>: <span class="s1">"publicacionesLista"</span>});</span>
<span class="line added">Router.route(<span class="s1">"/publicacion/:_id"</span>, {</span><span class="line added">  <span class="na">name</span>: <span class="s1">"publicacionesPagina"</span></span><span class="line added">});</span></pre>
            <div class="caption">/lib/router.js</div>
            
            <div class="lines-highlight" data-lines="8~10" data-class="added"></div>
            
            <p>Debemos decirle a Iron Router que el contexto de datos de la nueva página es un <code>_id</code> de MongoDB.</p>
            
            <figure class="diagram pull-center"><img src="./Enrutando_files/router-diagram-2@2x.png" alt="El contexto de datos."><figcaption>El contexto de datos.</figcaption></figure>
            
			<p>Para ello le decimos a Iron Router que busque el <code>_id</code> en la URL obtenida.</p>
            
			<pre><span class="line">Router.configure({</span><span class="line">  <span class="na">layoutTemplate</span> : <span class="s1">"diseño"</span>,</span><span class="line">  <span class="na">waitOn</span>         : <span class="kd">function</span>(){ <span class="kd">return</span> Meteor.subscribe(<span class="s1">"publicaciones"</span>); },</span><span class="line">  <span class="na">loadingTemplate</span>: <span class="s1">"cargando"</span></span><span class="line">});</span>
<span class="line">Router.route(<span class="s1">"/"</span>, {<span class="na">name</span>: <span class="s1">"publicacionesLista"</span>});</span><span class="line">Router.route(<span class="s1">"/publicacion/</span><span class="ss">:_id</span><span class="s1">"</span>, {</span><span class="line added">  <span class="na">name</span>: <span class="s1">"publicacionesPagina"</span>,</span><span class="line added">  <span class="na">data</span>: <span class="kd">function</span>(){ <span class="kd">return</span> Publicaciones.findOne(<span class="kd">this</span>.params.<span class="ss">_id</span>); }</span><span class="line">});</span></pre>
            <div class="caption">/lib/router.js</div>
            
            <div class="lines-highlight" data-lines="9,10" data-class="added"></div>
            
            <h3 id="men-uned">Usando nuestro enrutador dinámico</h3>
            
            <p>Crearemos un enlace en cada publicación para enlazar a su página.</p>
            
            <pre><span class="line"><span class="nt">&lt;template</span> <span class="na">name</span>=<span class="s1">"publicacionesObjeto"</span><span class="nt">&gt;</span></span><span class="line">  <span class="nt">&lt;div</span> <span class="na">class</span>=<span class="s1">"publicacion"</span><span class="nt">&gt;</span></span><span class="line">    <span class="nt">&lt;div</span> <span class="na">class</span>=<span class="s1">"publicacion-contenido"</span><span class="nt">&gt;</span></span><span class="line">      <span class="nt">&lt;h3&gt;&lt;a</span> <span class="na">href</span>=<span class="s1">"{{url}}"</span><span class="nt">&gt;</span>{{titulo}}<span class="nt">&lt;/a&gt;&lt;span&gt;</span>{{dominio}}<span class="nt">&lt;/span&gt;&lt;/h3&gt;</span></span><span class="line nt">    &lt;/div&gt;</span><span class="line added">    <span class="nt">&lt;a</span> <span class="na">href</span>=<span class="s1">"{{pathFor 'publicacionesPagina'}}"</span> <span class="na">class</span>=<span class="s1">"debatir btn btn-default"</span><span class="nt">&gt;</span>Debatir<span class="nt">&lt;/a&gt;</span></span><span class="line nt">  &lt;/div&gt;</span><span class="line nt">&lt;/template&gt;</span></pre>
            <div class="caption">/client/plantillas/publicaciones/publicaciones_objeto.html</div>
            
            <div class="lines-highlight" data-lines="6" data-class="added"></div>
            
            <figure class="screenshot "><img src="./Enrutando_files/5-2.png" alt="La página para una sóla publicación."><figcaption>La página para una sóla publicación.</figcaption></figure>
            
            <h3 id="men-pne">Publicación no encontrada</h3>
            
            <p>Tenemos el problema si alguien introduce una URL <em>errónea</em>.</p>
            
            <p>Añadimos la configuración a Iron Router con la opción <code>notFoundTemplate</code>.</p>
            
            <p>Primero, crearemos la plantilla que será el error 404:</p>
			
            <pre><span class="line"><span class="nt">&lt;template</span> <span class="na">name</span>=<span class="s1">"noEncontrado"</span><span class="nt">&gt;</span></span><span class="line">  <span class="nt">&lt;div</span> <span class="na">class</span>=<span class="s1">"not-found pagina jumbotron"</span><span class="nt">&gt;</span></span><span class="line">    <span class="nt">&lt;h2&gt;</span>Error: 404<span class="nt">&lt;/h2&gt;</span></span><span class="line nt">    &lt;p&gt;</span><span class="line">      Esta página no existe. Por favor, revise la dirección web.</span><span class="line nt">    &lt;/p&gt;</span><span class="line nt">  &lt;/div&gt;</span><span class="line nt">&lt;/template&gt;</span></pre>
            <div class="caption">/client/plantillas/extras/no_encontrado.html</div>
            
            <p>Después, sencillamente le decimos a Iron Router que use esta plantilla:</p>
            
			<pre><span class="line">Router.configure({</span><span class="line">  <span class="na">layoutTemplate</span>  : <span class="s1">"diseño"</span>,</span><span class="line">  <span class="na">waitOn</span>          : <span class="kd">function</span>(){ <span class="kd">return</span> Meteor.subscribe(<span class="s1">"publicaciones"</span>); },</span><span class="line added">  <span class="na">loadingTemplate</span> : <span class="s1">"cargando"</span>,</span><span class="line added">  <span class="na">notFoundTemplate</span>: <span class="s1">"noEncontrado"</span></span><span class="line">});</span>
<span class="line c1">//•••</span></pre>
            <div class="caption">/lib/router.js</div>
            
            <div class="lines-highlight" data-lines="4" data-class="added"></div>
            
            <p>Para probar la nueva web abre una página donde no se haya contemplado en las rutas de Iron Router como por ejemplo: <a href="http://localhost:3000/nada-por-aqui" target="_blank">http://localhost:3000/nada-por-aqui</a>.</p>
            
            <p>El siguiente problema es este <code>http://localhost:3000/publicacion/•••</code> donde <code>•••</code> en una publicación que no existe.</p>
			
			<p>Esto quiere decir: Ruta válida pero sin datos.</p>
            
            <p>Definiremos un <em>hook</em> especial <code>dataNotFound</code> cuando no hayan datos pero solo para la plantilla <code>publicacionesPagina</code>:</p>
            
			<pre><span class="line c1">//•••</span>
<span class="line added">Router.onBeforeAction(<span class="s1">"dataNotFound"</span>, {<span class="na">only</span>: <span class="s1">"publicacionesPagina"</span>});</span></pre>
			<div class="caption">/lib/router.js</div>
            
            <div class="lines-highlight" data-lines="4" data-class="added"></div>
            
			<p>Debemos poner el nuevo contenido al final de archivo <code>router.js</code>.</p>
			
            <p>Comprueba el resultado con esta dirección de ejemplo <a href="http://localhost:3000/publicacion/sin-datos" target="_blank">http://localhost:3000/publicacion/sin-datos</a>.</p>
            </div>
          </div>
          <div class="bottom-nav">
            <div class="post-nav">
              <a class="prev" href="http://es.discovermeteor.com/chapters/publications-and-subscriptions/" title="Previous Post: Publicaciones y suscripciones">
                «
                Publicaciones y suscripciones
              </a>
              <a class="next" href="http://es.discovermeteor.com/chapters/the-session/" title="next Post: La sesión">
                La sesión
                »
              </a>
            </div>
          </div>
        </div>
        <div class="comments sidebar">
          <a class="sidebar-toggle" data-disqus-identifier="routing_es" href="http://es.discovermeteor.com/chapters/routing/#disqus_thread">5 Comments</a>
          <div class="sidebar-inner">
            <div class="issues">
              <a class="issue-link simple-button" href="https://github.com/DiscoverMeteor/Microscope/issues" target="_blank">Reporta un problema con el código</a>
              <a class="issue-link simple-button" href="https://github.com/DiscoverMeteor/DiscoverMeteor_es/issues" target="_blank">Reporta un problema con el libro</a>
              <hr>
              <p>O, comenta el contenido aquí:</p>
            </div>
            <div id="disqus_thread"><iframe id="dsq-app6552" name="dsq-app6552" allowtransparency="true" frameborder="0" scrolling="no" tabindex="0" title="Disqus" width="100%" src="./Enrutando_files/saved_resource.html" style="width: 1px !important; min-width: 100% !important; border: none !important; overflow: hidden !important; height: 1366px !important;" horizontalscrolling="no" verticalscrolling="no"></iframe></div>
            <script type="text/javascript">
                /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
                var disqus_shortname = 'discovermeteores'; // required: replace example with your forum shortname
                var disqus_identifier = 'routing_es';
            
                /* * * DON'T EDIT BELOW THIS LINE * * */
                (function() {
                    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                    dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
                    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
                })();
            
                /* * * DON'T EDIT BELOW THIS LINE * * */
                (function () {
                var s = document.createElement('script'); s.async = true;
                s.type = 'text/javascript';
                s.src = 'http://' + disqus_shortname + '.disqus.com/count.js';
                (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
                }());
            
            </script>
          </div>
        </div>
      </div>
    </div>
    <footer>
      <div class="row">
        © 2014 <a href="http://tom.thesnail.org/">Tom Coleman</a> y <a href="http://sachagreif.com/">Sacha Greif</a>
      </div>
    </footer>
    <!-- %script{:src => "https://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.5.2/underscore-min.js"} -->
    <script src="./Enrutando_files/moment.min.js.descarga"></script>
    <script src="./Enrutando_files/es.js.descarga"></script>
    <script src="./Enrutando_files/script.js.descarga"></script>
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
      
      ga('create', 'UA-38246482-5', 'discovermeteor.com');
      ga('send', 'pageview');
    </script>
    <input id="lang" type="hidden" value="es">
  

<iframe style="display: none;" src="./Enrutando_files/saved_resource(1).html"></iframe></body></html>